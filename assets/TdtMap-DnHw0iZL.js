import{$ as e,$t as t,B as n,Bt as r,C as i,Ct as a,D as o,Dt as s,E as c,F as l,G as u,H as d,I as f,It as p,J as m,K as h,L as g,Lt as _,M as v,Nt as y,On as b,Ot as x,Pt as S,Q as C,Rt as w,S as T,T as E,Tt as ee,V as D,W as te,Wt as ne,X as O,Xt as re,Y as k,Z as A,_ as ie,a as ae,an as oe,at as se,bt as ce,c as le,ct as ue,d as de,dt as fe,en as pe,et as me,ft as he,g as ge,gn as _e,gt as j,h as ve,ht as ye,in as be,j as xe,jt as Se,k as Ce,l as we,ln as Te,lt as Ee,m as De,mn as Oe,n as ke,nn as Ae,nt as M,pt as N,q as je,qt as Me,r as Ne,rn as Pe,rt as Fe,t as Ie,tn as Le,tt as Re,vt as P,w as F,wn as ze,wt as Be,x as Ve,xt as He,y as Ue,yt as We,zt as Ge}from"./css-DnECFN1P.js";import{$ as Ke,E as qe,I as Je,K as Ye,N as Xe,O as Ze,P as Qe,T as $e,U as et,V as tt,W as nt,Y as rt,Z as it,_ as at,_t as ot,c as st,f as I,ft as ct,g as L,gt as lt,h as R,ht as z,it as B,j as V,l as ut,m as H,mt as dt,n as ft,p as U,pt,s as mt,t as ht,u as gt,v as _t,y as vt}from"./index-CY-sIl4G.js";import{$t as yt,At as bt,B as xt,Bt as St,C as W,Ct,D as wt,Dt as Tt,E as Et,Et as G,F as K,Ft as Dt,Ht as Ot,It as kt,Jt as At,Kt as jt,L as Mt,Lt as Nt,M as Pt,Mt as Ft,N as It,Nt as Lt,Ot as Rt,P as zt,Pt as Bt,Rt as Vt,S as q,St as Ht,T as Ut,Tt as Wt,U as Gt,Ut as Kt,Vt as J,Wt as qt,Xt as Jt,Yt as Y,_ as Yt,_n as Xt,_t as Zt,a as Qt,b as $t,bn as en,bt as tn,c as nn,d as rn,en as an,f as on,g as sn,gt as cn,h as ln,i as un,j as dn,jt as fn,k as pn,kt as mn,l as hn,m as gn,nn as _n,o as vn,on as yn,p as bn,pn as xn,qt as Sn,r as Cn,s as wn,t as Tn,tn as En,u as Dn,v as On,vn as kn,vt as An,w as jn,wt as Mn,xt as Nn,y as Pn,yn as Fn,yt as In,z as Ln,zt as Rn}from"./css-CVDnaK-U.js";import{t as zn}from"./Vector-CCPeYE3R.js";import{t as Bn}from"./MapEventType-DywGtyw4.js";var Vn=Le({modelValue:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:void 0},loading:Boolean,size:{type:String,validator:e=>[``,...pe].includes(e)},width:{type:[String,Number],default:``},inlinePrompt:Boolean,inactiveActionIcon:{type:yn},activeActionIcon:{type:yn},activeIcon:{type:yn},inactiveIcon:{type:yn},activeText:{type:String,default:``},inactiveText:{type:String,default:``},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:``},validateEvent:{type:Boolean,default:!0},beforeChange:{type:Ae(Function)},id:String,tabindex:{type:[String,Number]},..._n([`ariaLabel`])}),Hn={[en]:e=>Oe(e)||dt(e)||_e(e),[kn]:e=>Oe(e)||dt(e)||_e(e),[Fn]:e=>Oe(e)||dt(e)||_e(e)},Un=[`id`,`aria-checked`,`aria-disabled`,`aria-label`,`name`,`true-value`,`false-value`,`disabled`,`tabindex`],Wn=[`aria-hidden`],Gn={key:1},Kn={key:1},qn=[`aria-hidden`],Jn=`ElSwitch`,Yn=Me(re(vt({name:Jn,__name:`switch`,props:Vn,emits:Hn,setup(e,{expose:t,emit:n}){let i=e,a=n,{formItem:o}=yt(),s=r(),c=ze(`switch`),{inputId:l}=an(i,{formItemContext:o}),u=Ge(I(()=>{if(i.loading)return!0})),d=it(i.modelValue!==!1),f=Ke(),p=I(()=>[c.b(),c.m(s.value),c.is(`disabled`,u.value),c.is(`checked`,v.value)]),m=I(()=>[c.e(`label`),c.em(`label`,`left`),c.is(`active`,!v.value)]),h=I(()=>[c.e(`label`),c.em(`label`,`right`),c.is(`active`,v.value)]),g=I(()=>({width:ne(i.width)}));tt(()=>i.modelValue,()=>{d.value=!0});let _=I(()=>d.value?i.modelValue:!1),v=I(()=>_.value===i.activeValue);[i.activeValue,i.inactiveValue].includes(_.value)||(a(en,i.inactiveValue),a(kn,i.inactiveValue),a(Fn,i.inactiveValue)),tt(v,e=>{var t;f.value.checked=e,i.validateEvent&&((t=o?.validate)==null||t.call(o,`change`).catch(e=>Pe(e)))});let y=()=>{let e=v.value?i.inactiveValue:i.activeValue;a(en,e),a(kn,e),a(Fn,e),$e(()=>{f.value.checked=v.value})},b=()=>{if(u.value)return;let{beforeChange:e}=i;if(!e){y();return}let t=e();[pt(t),Oe(t)].includes(!0)||be(Jn,"beforeChange must return type `Promise<boolean>` or `boolean`"),pt(t)?t.then(e=>{e&&y()}).catch(e=>{Pe(Jn,`some error occurred: ${e}`)}):t&&y()};return Ze(()=>{f.value.checked=v.value}),t({focus:()=>{var e,t;(t=(e=f.value)?.focus)==null||t.call(e)},checked:v}),(e,t)=>(V(),L(`div`,{class:z(p.value),onClick:ut(b,[`prevent`])},[U(`input`,{id:B(l),ref_key:`input`,ref:f,class:z(B(c).e(`input`)),type:`checkbox`,role:`switch`,"aria-checked":v.value,"aria-disabled":B(u),"aria-label":e.ariaLabel,name:e.name,"true-value":e.activeValue,"false-value":e.inactiveValue,disabled:B(u),tabindex:e.tabindex,onChange:y,onKeydown:st(b,[`enter`])},null,42,Un),!e.inlinePrompt&&(e.inactiveIcon||e.inactiveText||e.$slots.inactive)?(V(),L(`span`,{key:0,class:z(m.value)},[Qe(e.$slots,`inactive`,{},()=>[e.inactiveIcon?(V(),H(B(Xt),{key:0},{default:et(()=>[(V(),H(Je(e.inactiveIcon)))]),_:1})):R(`v-if`,!0),!e.inactiveIcon&&e.inactiveText?(V(),L(`span`,{key:1,"aria-hidden":v.value},ot(e.inactiveText),9,Wn)):R(`v-if`,!0)])],2)):R(`v-if`,!0),U(`span`,{class:z(B(c).e(`core`)),style:lt(g.value)},[e.inlinePrompt?(V(),L(`div`,{key:0,class:z(B(c).e(`inner`))},[v.value?(V(),L(`div`,{key:1,class:z(B(c).e(`inner-wrapper`))},[Qe(e.$slots,`active`,{},()=>[e.activeIcon?(V(),H(B(Xt),{key:0},{default:et(()=>[(V(),H(Je(e.activeIcon)))]),_:1})):R(`v-if`,!0),!e.activeIcon&&e.activeText?(V(),L(`span`,Kn,ot(e.activeText),1)):R(`v-if`,!0)])],2)):(V(),L(`div`,{key:0,class:z(B(c).e(`inner-wrapper`))},[Qe(e.$slots,`inactive`,{},()=>[e.inactiveIcon?(V(),H(B(Xt),{key:0},{default:et(()=>[(V(),H(Je(e.inactiveIcon)))]),_:1})):R(`v-if`,!0),!e.inactiveIcon&&e.inactiveText?(V(),L(`span`,Gn,ot(e.inactiveText),1)):R(`v-if`,!0)])],2))],2)):R(`v-if`,!0),U(`div`,{class:z(B(c).e(`action`))},[e.loading?(V(),H(B(Xt),{key:0,class:z(B(c).is(`loading`))},{default:et(()=>[_t(B(xn))]),_:1},8,[`class`])):v.value?Qe(e.$slots,`active-action`,{key:1},()=>[e.activeActionIcon?(V(),H(B(Xt),{key:0},{default:et(()=>[(V(),H(Je(e.activeActionIcon)))]),_:1})):R(`v-if`,!0)]):v.value?R(`v-if`,!0):Qe(e.$slots,`inactive-action`,{key:2},()=>[e.inactiveActionIcon?(V(),H(B(Xt),{key:0},{default:et(()=>[(V(),H(Je(e.inactiveActionIcon)))]),_:1})):R(`v-if`,!0)])],2)],6),!e.inlinePrompt&&(e.activeIcon||e.activeText||e.$slots.active)?(V(),L(`span`,{key:1,class:z(h.value)},[Qe(e.$slots,`active`,{},()=>[e.activeIcon?(V(),H(B(Xt),{key:0},{default:et(()=>[(V(),H(Je(e.activeIcon)))]),_:1})):R(`v-if`,!0),!e.activeIcon&&e.activeText?(V(),L(`span`,{key:1,"aria-hidden":!v.value},ot(e.activeText),9,qn)):R(`v-if`,!0)])],2)):R(`v-if`,!0)],2))}}),[[`__file`,`/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue`]])),Xn={label:`label`,value:`value`,disabled:`disabled`},Zn=Le({direction:{type:Ae(String),default:`horizontal`},options:{type:Ae(Array),default:()=>[]},modelValue:{type:[String,Number,Boolean],default:void 0},props:{type:Ae(Object),default:()=>Xn},block:Boolean,size:t,disabled:{type:Boolean,default:void 0},validateEvent:{type:Boolean,default:!0},id:String,name:String,..._n([`ariaLabel`])}),Qn={[en]:e=>dt(e)||_e(e)||Oe(e),[kn]:e=>dt(e)||_e(e)||Oe(e)},$n=[`id`,`aria-label`,`aria-labelledby`],er=[`name`,`disabled`,`checked`,`onChange`],tr=Me(re(vt({name:`ElSegmented`,__name:`segmented`,props:Zn,emits:Qn,setup(e,{emit:t}){let n=e,i=t,a=ze(`segmented`),o=En(),s=r(),c=Ge(),{formItem:l}=yt(),{inputId:u,isLabeledByFormItem:d}=an(n,{formItemContext:l}),f=it(null),p=oe(),m=rt({isInit:!1,width:0,height:0,translateX:0,translateY:0,focusVisible:!1}),h=(e,t)=>{let r=v(t);i(en,r),i(kn,r),e.target.checked=r===n.modelValue},g=I(()=>({...Xn,...n.props})),_=e=>e,v=e=>ct(e)?e[g.value.value]:e,y=e=>ct(e)?e[g.value.label]:e,b=e=>!!(c.value||ct(e)&&e[g.value.disabled]),x=e=>n.modelValue===v(e),S=e=>n.options.find(t=>v(t)===e),C=e=>[a.e(`item`),a.is(`selected`,x(e)),a.is(`disabled`,b(e))],w=()=>{if(!f.value)return;let e=f.value.querySelector(`.is-selected`),t=f.value.querySelector(`.is-selected input`);if(!e||!t){m.width=0,m.height=0,m.translateX=0,m.translateY=0,m.focusVisible=!1;return}m.isInit=!0,n.direction===`vertical`?(m.height=e.offsetHeight,m.translateY=e.offsetTop):(m.width=e.offsetWidth,m.translateX=e.offsetLeft);try{m.focusVisible=t.matches(`:focus-visible`)}catch{}},T=I(()=>[a.b(),a.m(s.value),a.is(`block`,n.block)]),E=I(()=>({width:n.direction===`vertical`?`100%`:`${m.width}px`,height:n.direction===`vertical`?`${m.height}px`:`100%`,transform:n.direction===`vertical`?`translateY(${m.translateY}px)`:`translateX(${m.translateX}px)`,display:m.isInit?`block`:`none`})),ee=I(()=>[a.e(`item-selected`),a.is(`disabled`,b(S(n.modelValue))),a.is(`focus-visible`,m.focusVisible)]),D=I(()=>n.name||o.value);return Te(f,w),tt(p,w),tt(()=>n.modelValue,()=>{var e;w(),n.validateEvent&&((e=l?.validate)==null||e.call(l,`change`).catch(e=>Pe(e)))},{flush:`post`}),(e,t)=>e.options.length?(V(),L(`div`,{key:0,id:B(u),ref_key:`segmentedRef`,ref:f,class:z(T.value),role:`radiogroup`,"aria-label":B(d)?void 0:e.ariaLabel||`segmented`,"aria-labelledby":B(d)?B(l).labelId:void 0},[U(`div`,{class:z([B(a).e(`group`),B(a).m(e.direction)])},[U(`div`,{style:lt(E.value),class:z(ee.value)},null,6),(V(!0),L(gt,null,Xe(e.options,(t,n)=>(V(),L(`label`,{key:n,class:z(C(t))},[U(`input`,{class:z(B(a).e(`item-input`)),type:`radio`,name:D.value,disabled:b(t),checked:x(t),onChange:e=>h(e,t)},null,42,er),U(`div`,{class:z(B(a).e(`item-label`))},[Qe(e.$slots,`default`,{item:_(t)},()=>[at(ot(y(t)),1)])],2)],2))),128))],2)],10,$n)):R(`v-if`,!0)}}),[[`__file`,`/home/runner/work/element-plus/element-plus/packages/components/segmented/src/segmented.vue`]])),nr=class{constructor(e){this.highWaterMark=e===void 0?2048:e,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let e=this.pop();e instanceof p&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){let n=this.entries_[e];return Y(n!==void 0,`Tried to get a value for a key that does not exist in the cache`),n===this.newest_?n.value_:(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n,n.value_)}remove(e){let t=this.entries_[e];return Y(t!==void 0,`Tried to get a value for a key that does not exist in the cache`),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){let e=Array(this.count_),t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){let e=Array(this.count_),t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){let e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Y(!(e in this.entries_),`Tried to set a value for a key that is used already`);let n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}};function rr(e,t,n,r){return r===void 0?[e,t,n]:(r[0]=e,r[1]=t,r[2]=n,r)}function ir(e,t,n){return e+`/`+t+`/`+n}function ar(e,t,n,r,i){return`${N(e)},${t},${ir(n,r,i)}`}function or(e){return sr(e[0],e[1],e[2])}function sr(e,t,n){return(t<<e)+n}function cr(e,t){let n=e[0],r=e[1],i=e[2];if(t.getMinZoom()>n||n>t.getMaxZoom())return!1;let a=t.getFullTileRange(n);return a?a.containsXY(r,i):!0}var lr=class{constructor(e,t,n,r){this.minX=e,this.maxX=t,this.minY=n,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}};function ur(e,t,n,r,i){return i===void 0?new lr(e,t,n,r):(i.minX=e,i.maxX=t,i.minY=n,i.maxY=r,i)}var dr=lr,fr=[0,0,0],pr=5,mr=class{constructor(e){this.minZoom=e.minZoom===void 0?0:e.minZoom,this.resolutions_=e.resolutions,Y(y(this.resolutions_,(e,t)=>t-e,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let e=0,n=this.resolutions_.length-1;e<n;++e)if(!t)t=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin===void 0?null:e.origin,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Y(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=me(n)),Y(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Y(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize===void 0?this.tileSizes_?null:256:e.tileSize,Y(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n===void 0?null:n,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes===void 0?n&&this.calculateTileRanges_(n):this.fullTileRanges_=e.sizes.map((e,t)=>{let r=new dr(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(n){let e=this.getTileRangeForExtentAndZ(n,t);r.minX=Math.max(e.minX,r.minX),r.maxX=Math.min(e.maxX,r.maxX),r.minY=Math.max(e.minY,r.minY),r.maxY=Math.min(e.maxY,r.maxY)}return r})}forEachTileCoord(e,t,n){let r=this.getTileRangeForExtentAndZ(e,t);for(let e=r.minX,i=r.maxX;e<=i;++e)for(let i=r.minY,a=r.maxY;i<=a;++i)n([t,e,i])}forEachTileCoordParentTileRange(e,t,n,r){let i,a,o,s=null,c=e[0]-1;for(this.zoomFactor_===2?(a=e[1],o=e[2]):s=this.getTileCoordExtent(e,r);c>=this.minZoom;){if(a!==void 0&&o!==void 0?(a=Math.floor(a/2),o=Math.floor(o/2),i=ur(a,a,o,o,n)):i=this.getTileRangeForExtentAndZ(s,c,n),t(c,i))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){let n=e[1]*2,r=e[2]*2;return ur(n,n+1,r,r+1,t)}let r=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;let r=e[0],i=e[1],a=e[2];if(t===r)return ur(i,a,i,a,n);if(this.zoomFactor_){let e=this.zoomFactor_**+(t-r),o=Math.floor(i*e),s=Math.floor(a*e);return t<r?ur(o,o,s,s,n):ur(o,Math.floor(e*(i+1))-1,s,Math.floor(e*(a+1))-1,n)}let o=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,fr);let r=fr[1],i=fr[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,fr);let a=fr[1],o=fr[2];return ur(r,a,i,o,n)}getTileCoordCenter(e){let t=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=K(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*n,t[1]-(e[2]+.5)*r[1]*n]}getTileCoordExtent(e,t){let n=this.getOrigin(e[0]),r=this.getResolution(e[0]),i=K(this.getTileSize(e[0]),this.tmpSize_),a=n[0]+e[1]*i[0]*r,o=n[1]-(e[2]+1)*i[1]*r;return f(a,o,a+i[0]*r,o+i[1]*r,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,r,i){let a=this.getZForResolution(n),o=n/this.getResolution(a),s=this.getOrigin(a),c=K(this.getTileSize(a),this.tmpSize_),l=o*(e-s[0])/n/c[0],u=o*(s[1]-t)/n/c[1];return r?(l=St(l,pr)-1,u=St(u,pr)-1):(l=Ot(l,pr),u=Ot(u,pr)),rr(a,l,u,i)}getTileCoordForXYAndZ_(e,t,n,r,i){let a=this.getOrigin(n),o=this.getResolution(n),s=K(this.getTileSize(n),this.tmpSize_),c=(e-a[0])/o/s[0],l=(a[1]-t)/o/s[1];return r?(c=St(c,pr)-1,l=St(l,pr)-1):(c=Ot(c,pr),l=Ot(l,pr)),rr(n,c,l,i)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){return J(S(this.resolutions_,e,t||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Gt(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){let t=this.resolutions_.length,n=Array(t);for(let r=this.minZoom;r<t;++r)n[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=n}},hr=class extends mr{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}};function gr(e){let t=e.getDefaultTileGrid();return t||(t=xr(e),e.setDefaultTileGrid(t)),t}function _r(e,t,n){let r=t[0],i=e.getTileCoordCenter(t),a=Sr(n);if(!xe(a,i)){let t=M(a),n=Math.ceil((a[0]-i[0])/t);return i[0]+=t*n,e.getTileCoordForCoordAndZ(i,r)}return t}function vr(e,t,n,r){r=r===void 0?`top-left`:r;let i=br(e,t,n);return new mr({extent:e,origin:k(e,r),resolutions:i,tileSize:n})}function yr(e){let t=e||{},n=t.extent||G(`EPSG:3857`).getExtent();return new mr({extent:n,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:br(n,t.maxZoom,t.tileSize,t.maxResolution)})}function br(e,t,n,r){t=t===void 0?42:t,n=K(n===void 0?256:n);let i=A(e),a=M(e);r=r>0?r:Math.max(a/n[0],i/n[1]);let o=t+1,s=Array(o);for(let e=0;e<o;++e)s[e]=r/2**e;return s}function xr(e,t,n,r){return vr(Sr(e),t,n,r)}function Sr(e){e=G(e);let t=e.getExtent();if(!t){let n=180*Bt.degrees/e.getMetersPerUnit();t=f(-n,-n,n,n)}return t}var Cr=/\{z\}/g,wr=/\{x\}/g,Tr=/\{y\}/g,Er=/\{-y\}/g;function Dr(e,t,n,r,i){return e.replace(Cr,t.toString()).replace(wr,n.toString()).replace(Tr,r.toString()).replace(Er,function(){if(i===void 0)throw Error(`If the URL template has a {-y} placeholder, the grid extent must be known`);return(i-r).toString()})}function Or(e){let t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){let r=n[1].charCodeAt(0),i=n[2].charCodeAt(0),a;for(a=r;a<=i;++a)t.push(e.replace(n[0],String.fromCharCode(a)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e),n){let r=parseInt(n[2],10);for(let i=parseInt(n[1],10);i<=r;i++)t.push(e.replace(n[0],i.toString()));return t}return t.push(e),t}function kr(e,t){return(function(n,r,i){if(!n)return;let a,o=n[0];if(t){let e=t.getFullTileRange(o);e&&(a=e.getHeight()-1)}return Dr(e,o,n[1],n[2],a)})}function Ar(e,t){let n=e.length,r=Array(n);for(let i=0;i<n;++i)r[i]=kr(e[i],t);return jr(r)}function jr(e){return e.length===1?e[0]:(function(t,n,r){if(t)return e[Kt(or(t),e.length)](t,n,r)})}var X={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Mr=class extends We{constructor(e,t,n){super(),n||={},this.tileCoord=e,this.state=t,this.key=``,this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(_.CHANGE)}release(){this.setState(X.EMPTY)}getKey(){return this.key+`/`+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==X.EMPTY){if(this.state!==X.ERROR&&this.state>e)throw Error(`Tile load sequence violation`);this.state=e,this.changed()}}load(){he()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;let r=t-n+1e3/60;return r>=this.transition_?1:Ut(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},Nr=class extends Mr{constructor(e,t,n,r,i,a){super(e,t,a),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_,F?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,r!==null&&(this.image_.crossOrigin=r)),this.unlisten_=null,this.tileLoadFunction_=i}getImage(){return this.image_}setImage(e){this.image_=e,this.state=X.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=X.ERROR,this.unlistenImage_(),this.image_=Pr(),this.changed()}handleImageLoad_(){if(F)this.state=X.LOADED;else{let e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=X.LOADED:this.state=X.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==X.ERROR&&(this.state=X.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==X.IDLE&&(this.state=X.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=pn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&=(this.unlisten_(),null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function Pr(){let e=le(1,1);return e.fillStyle=`rgba(0,0,0,0)`,e.fillRect(0,0,1,1),e.canvas}var Fr=Nr,Ir;const Lr=[];function Rr(e,t,n,r,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(r,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,r)+1,Math.max(n,i)),e.restore()}function zr(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function Br(){if(Ir===void 0){let e=le(6,6,Lr);e.globalCompositeOperation=`lighter`,e.fillStyle=`rgba(210, 0, 0, 0.75)`,Rr(e,4,5,4,0),Rr(e,4,5,0,5);let t=e.getImageData(0,0,3,3).data;Ir=zr(t,0)||zr(t,4)||zr(t,8),De(e),Lr.push(e.canvas)}return Ir}function Vr(e,t,n,r){let i=Lt(n,t,e),a=Tt(t,r,n),o=t.getMetersPerUnit();o!==void 0&&(a*=o);let s=e.getMetersPerUnit();s!==void 0&&(a/=s);let c=e.getExtent();if(!c||xe(c,i)){let t=Tt(e,a,i)/a;isFinite(t)&&t>0&&(a/=t)}return a}function Hr(e,t,n,r){let i=Vr(e,t,m(n),r);return(!isFinite(i)||i<=0)&&te(n,function(n){return i=Vr(e,t,n,r),isFinite(i)&&i>0}),i}function Ur(e,t,n,r,i,a,o,s,c,u,d,f,p,m){let h=le(Math.round(n*e),Math.round(n*t),Lr);if(f||(h.imageSmoothingEnabled=!1),c.length===0)return h.canvas;h.scale(n,n);function g(e){return Math.round(e*n)/n}h.globalCompositeOperation=`lighter`;let _=l();c.forEach(function(e,t,n){D(_,e.extent)});let v,y=n/r,b=(f?1:1+2**-24)/y;if(!p||c.length!==1||u!==0){if(v=le(Math.round(M(_)*y),Math.round(A(_)*y),Lr),f||(v.imageSmoothingEnabled=!1),i&&m){let e=(i[0]-_[0])*y,t=-(i[3]-_[3])*y,n=M(i)*y,r=A(i)*y;v.rect(e,t,n,r),v.clip()}c.forEach(function(e,t,n){if(e.image.width>0&&e.image.height>0){if(e.clipExtent){v.save();let t=(e.clipExtent[0]-_[0])*y,n=-(e.clipExtent[3]-_[3])*y,r=M(e.clipExtent)*y,i=A(e.clipExtent)*y;v.rect(f?t:Math.round(t),f?n:Math.round(n),f?r:Math.round(t+r)-Math.round(t),f?i:Math.round(n+i)-Math.round(n)),v.clip()}let t=(e.extent[0]-_[0])*y,n=-(e.extent[3]-_[3])*y,r=M(e.extent)*y,i=A(e.extent)*y;v.drawImage(e.image,u,u,e.image.width-2*u,e.image.height-2*u,f?t:Math.round(t),f?n:Math.round(n),f?r:Math.round(t+r)-Math.round(t),f?i:Math.round(n+i)-Math.round(n)),e.clipExtent&&v.restore()}})}let x=me(o);return s.getTriangles().forEach(function(e,t,n){let r=e.source,i=e.target,o=r[0][0],s=r[0][1],l=r[1][0],u=r[1][1],d=r[2][0],p=r[2][1],m=g((i[0][0]-x[0])/a),y=g(-(i[0][1]-x[1])/a),S=g((i[1][0]-x[0])/a),C=g(-(i[1][1]-x[1])/a),w=g((i[2][0]-x[0])/a),T=g(-(i[2][1]-x[1])/a),E=o,ee=s;o=0,s=0,l-=E,u-=ee,d-=E,p-=ee;let D=qt([[l,u,0,0,S-m],[d,p,0,0,w-m],[0,0,l,u,C-y],[0,0,d,p,T-y]]);if(!D)return;if(h.save(),h.beginPath(),Br()||!f){h.moveTo(S,C);let e=m-S,t=y-C;for(let n=0;n<4;n++)h.lineTo(S+g((n+1)*e/4),C+g(n*t/3)),n!=3&&h.lineTo(S+g((n+1)*e/4),C+g((n+1)*t/3));h.lineTo(w,T)}else h.moveTo(S,C),h.lineTo(m,y),h.lineTo(w,T);h.clip(),h.transform(D[0],D[2],D[1],D[3],m,y),h.translate(_[0]-E,_[3]-ee);let te;if(v)te=v.canvas,h.scale(b,-b);else{let e=c[0],t=e.extent;te=e.image,h.scale(M(t)/te.width,-A(t)/te.height)}h.drawImage(te,0,0),h.restore()}),v&&(De(v),Lr.push(v.canvas)),d&&(h.save(),h.globalCompositeOperation=`source-over`,h.strokeStyle=`black`,h.lineWidth=1,s.getTriangles().forEach(function(e,t,n){let r=e.target,i=(r[0][0]-x[0])/a,o=-(r[0][1]-x[1])/a,s=(r[1][0]-x[0])/a,c=-(r[1][1]-x[1])/a,l=(r[2][0]-x[0])/a,u=-(r[2][1]-x[1])/a;h.beginPath(),h.moveTo(s,c),h.lineTo(i,o),h.lineTo(l,u),h.closePath(),h.stroke()}),h.restore()),h.canvas}var Wr=10,Gr=.25,Kr=class{constructor(e,t,n,r,i,a,o){this.sourceProj_=e,this.targetProj_=t;let s={},c=o?Ht(e=>cn(o,Lt(e,this.targetProj_,this.sourceProj_))):Rt(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){let t=e[0]+`/`+e[1];return s[t]||(s[t]=c(e)),s[t]},this.maxSourceExtent_=r,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&M(r)>=M(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?M(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?M(this.targetProj_.getExtent()):null;let l=me(n),d=Re(n),f=je(n),p=h(n),m=this.transformInv_(l),g=this.transformInv_(d),_=this.transformInv_(f),v=this.transformInv_(p),y=Wr+(a?Math.max(0,Math.ceil(Math.log2(u(n)/(a*a*256*256)))):0);if(this.addQuad_(l,d,f,p,m,g,_,v,y),this.wrapsXInSource_){let e=1/0;this.triangles_.forEach(function(t,n,r){e=Math.min(e,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(t=>{if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){let n=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];n[0][0]-e>this.sourceWorldWidth_/2&&(n[0][0]-=this.sourceWorldWidth_),n[1][0]-e>this.sourceWorldWidth_/2&&(n[1][0]-=this.sourceWorldWidth_),n[2][0]-e>this.sourceWorldWidth_/2&&(n[2][0]-=this.sourceWorldWidth_);let r=Math.min(n[0][0],n[1][0],n[2][0]);Math.max(n[0][0],n[1][0],n[2][0])-r<this.sourceWorldWidth_/2&&(t.source=n)}})}s={}}addTriangle_(e,t,n,r,i,a){this.triangles_.push({source:[r,i,a],target:[e,t,n]})}addQuad_(e,t,n,r,i,a,s,c,l){let u=o([i,a,s,c]),d=this.sourceWorldWidth_?M(u)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&d>.5&&d<1,m=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(m=M(o([e,t,n,r]))/this.targetWorldWidth_>Gr||m),!p&&this.sourceProj_.isGlobal()&&d&&(m=d>Gr||m)),!m&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Fe(u,this.maxSourceExtent_))return;let h=0;if(!m&&(!isFinite(i[0])||!isFinite(i[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(c[0])||!isFinite(c[1]))){if(l>0)m=!0;else if(h=(!isFinite(i[0])||!isFinite(i[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(s[0])||!isFinite(s[1])?2:0)+(!isFinite(c[0])||!isFinite(c[1])?1:0),h!=1&&h!=2&&h!=4&&h!=8)return}if(l>0){if(!m){let t=[(e[0]+n[0])/2,(e[1]+n[1])/2],r=this.transformInv_(t),a;a=p?(Kt(i[0],f)+Kt(s[0],f))/2-Kt(r[0],f):(i[0]+s[0])/2-r[0];let o=(i[1]+s[1])/2-r[1];m=a*a+o*o>this.errorThresholdSquared_}if(m){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){let o=[(t[0]+n[0])/2,(t[1]+n[1])/2],u=this.transformInv_(o),d=[(r[0]+e[0])/2,(r[1]+e[1])/2],f=this.transformInv_(d);this.addQuad_(e,t,o,d,i,a,u,f,l-1),this.addQuad_(d,o,n,r,f,u,s,c,l-1)}else{let o=[(e[0]+t[0])/2,(e[1]+t[1])/2],u=this.transformInv_(o),d=[(n[0]+r[0])/2,(n[1]+r[1])/2],f=this.transformInv_(d);this.addQuad_(e,o,d,r,i,u,f,c,l-1),this.addQuad_(o,t,n,d,u,a,s,f,l-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}h&11||this.addTriangle_(e,n,r,i,s,c),h&14||this.addTriangle_(e,n,t,i,s,a),h&&(h&13||this.addTriangle_(t,r,e,a,c,i),h&7||this.addTriangle_(t,r,n,a,c,s))}calculateSourceExtent(){let e=l();return this.triangles_.forEach(function(t,n,r){let i=t.source;d(e,i[0]),d(e,i[1]),d(e,i[2])}),e}getTriangles(){return this.triangles_}},qr=class extends Mr{constructor(e,t,n,r,i,a,o,s,c,l,d,f){super(i,X.IDLE,f),this.renderEdges_=d===void 0?!1:d,this.pixelRatio_=o,this.gutter_=s,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=a||i,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;let p=r.getTileCoordExtent(this.wrappedTileCoord_),m=this.targetTileGrid_.getExtent(),h=this.sourceTileGrid_.getExtent(),g=m?C(p,m):p;if(u(g)===0){this.state=X.EMPTY;return}let _=e.getExtent();_&&(h=h?C(h,_):_);let v=r.getResolution(this.wrappedTileCoord_[0]),y=Hr(e,n,g,v);if(!isFinite(y)||y<=0){this.state=X.EMPTY;return}if(this.triangulation_=new Kr(e,n,g,h,y*(l===void 0?.5:l),v),this.triangulation_.getTriangles().length===0){this.state=X.EMPTY;return}this.sourceZ_=t.getZForResolution(y);let b=this.triangulation_.calculateSourceExtent();if(h&&(e.canWrapX()?(b[1]=J(b[1],h[1],h[3]),b[3]=J(b[3],h[1],h[3])):b=C(b,h)),!u(b))this.state=X.EMPTY;else{let n=0,r=0;e.canWrapX()&&(n=M(_),r=Math.floor((b[0]-_[0])/n)),ue(b.slice(),e,!0).forEach(e=>{let i=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=i.minX;e<=i.maxX;e++)for(let t=i.minY;t<=i.maxY;t++){let i=c(this.sourceZ_,e,t,o);if(i){let e=r*n;this.sourceTiles_.push({tile:i,offset:e})}}++r}),this.sourceTiles_.length===0&&(this.state=X.EMPTY)}}getImage(){return this.canvas_}reproject_(){let e=[];if(this.sourceTiles_.forEach(t=>{let n=t.tile;if(n&&n.getState()==X.LOADED){let r=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);r[0]+=t.offset,r[2]+=t.offset;let i=this.clipExtent_?.slice();i&&(i[0]+=t.offset,i[2]+=t.offset),e.push({extent:r,clipExtent:i,image:n.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=X.ERROR;else{let t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n==`number`?n:n[0],i=typeof n==`number`?n:n[1],a=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ur(r,i,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,s,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=X.LOADED}this.changed()}load(){if(this.state==X.IDLE){this.state=X.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{let n=t.getState();if(n==X.IDLE||n==X.LOADING){e++;let n=j(t,_.CHANGE,r=>{let i=t.getState();(i==X.LOADED||i==X.ERROR||i==X.EMPTY)&&(P(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},t,n){e.getState()==X.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(P),this.sourcesListenerKeys_=null}release(){this.canvas_&&=(De(this.canvas_.getContext(`2d`)),Lr.push(this.canvas_),null),super.release()}},Jr=class extends jn{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio===void 0?1:e.tilePixelRatio,this.tileGrid=e.tileGrid===void 0?null:e.tileGrid,this.tileGrid&&K(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tmpSize=[0,0],this.key_=e.key||N(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){let t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,r,i,a){return he()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:gr(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){let r=this.getTileGridForProjection(n),i=this.getTilePixelRatio(t),a=K(r.getTileSize(e),this.tmpSize);return i==1?a:zt(a,i,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){let n=t===void 0?this.getProjection():t,r=t===void 0&&this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(e=_r(r,e,n)),cr(e,r)?e:null}clear(){}refresh(){this.clear(),super.refresh()}},Yr=class extends ce{constructor(e,t){super(e),this.tile=t}},Xr=Jr,Zr={TILELOADSTART:`tileloadstart`,TILELOADEND:`tileloadend`,TILELOADERROR:`tileloaderror`},Qr=class e extends Xr{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===e.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){let t=e.target,n=N(t),r=t.getState(),i;r==X.LOADING?(this.tileLoadingKeys_[n]=!0,i=Zr.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],i=r==X.ERROR?Zr.TILELOADERROR:r==X.LOADED?Zr.TILELOADEND:void 0),i!=null&&this.dispatchEvent(new Yr(i,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,t===void 0?this.changed():this.setKey(t)}setUrl(e){let t=Or(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;let t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Ar(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}},$r=class extends Qr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ei,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate===void 0?!0:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin===void 0?null:e.crossOrigin,this.tileClass=e.tileClass===void 0?Fr:e.tileClass,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!Ct(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=`:disable-interpolation`),e}getTileGridForProjection(e){let t=this.getProjection();if(this.tileGrid&&(!t||Ct(t,e)))return this.tileGrid;let n=N(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=gr(e)),this.tileGridForProjection[n]}createTile_(e,t,n,r,i,a){let o=[e,t,n],s=this.getTileCoordForTileUrlFunction(o,i),c=s?this.tileUrlFunction(s,r,i):void 0,l=new this.tileClass(o,c===void 0?X.EMPTY:X.IDLE,c===void 0?``:c,this.crossOrigin,this.tileLoadFunction,this.tileOptions);return l.key=a,l.addEventListener(_.CHANGE,this.handleTileChange.bind(this)),l}getTile(e,t,n,r,i,a){let o=this.getProjection();if(!o||!i||Ct(o,i))return this.getTileInternal(e,t,n,r,o||i);let s=[e,t,n],c=this.getKey(),l=new qr(o,this.getTileGridForProjection(o),i,this.getTileGridForProjection(i),s,this.getTileCoordForTileUrlFunction(s,i),this.getTilePixelRatio(r),this.getGutter(),(e,t,n,r)=>this.getTileInternal(e,t,n,r,o,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return l.key=c,l}getTileInternal(e,t,n,r,i,a){let o=this.getKey(),s=ar(this,o,e,t,n);if(a&&a.containsKey(s))return a.get(s);let c=this.createTile_(e,t,n,r,i,o);return a?.set(s,c),c}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){let n=G(e);if(n){let e=N(n);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}};function ei(e,t){if(F){let n=e.getCrossOrigin(),r=`same-origin`,i=`same-origin`;n===`anonymous`||n===``?(r=`cors`,i=`omit`):n===`use-credentials`&&(r=`cors`,i=`include`),fetch(t,{mode:r,credentials:i}).then(e=>{if(!e.ok)throw Error(`HTTP ${e.status}`);return e.blob()}).then(e=>createImageBitmap(e)).then(t=>{let n=e.getImage();n.width=t.width,n.height=t.height,n.getContext(`2d`).drawImage(t,0,0),t.close?.(),n.dispatchEvent(new Event(`load`))}).catch(()=>{e.getImage().dispatchEvent(new Event(`error`))});return}e.getImage().src=t}var ti=$r,ni=class extends ti{constructor(e){e||={};let t=e.projection===void 0?`EPSG:3857`:e.projection,n=e.tileGrid===void 0?yr({extent:Sr(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize}):e.tileGrid;super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter===void 0?0:e.gutter}getGutter(){return this.gutter_}};function ri(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}const ii=Error(`disposed`);var ai=[256,256],oi=class extends Mr{constructor(e){let t=X.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;let e=ri(this.data_);return e?[e.width,e.height]:ai}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==X.IDLE&&this.state!==X.ERROR)return;this.state=X.LOADING,this.changed();let e=this;this.loader_().then(function(t){e.data_=t,e.state=X.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=X.ERROR,e.changed()})}disposeInternal(){this.controller_&&=(this.controller_.abort(ii),null),super.disposeInternal()}},si=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,He(this.queuedElements_)}dequeue(){let e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));let r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(e){Y(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let t=this.priorityFunction_(e);return t==1/0?!1:(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){let t=this.elements_,n=this.priorities_,r=t.length,i=t[e],a=n[e],o=e;for(;e<r>>1;){let i=this.getLeftChildIndex_(e),a=this.getRightChildIndex_(e),o=a<r&&n[a]<n[i]?a:i;t[e]=t[o],n[e]=n[o],e=o}t[e]=i,n[e]=a,this.siftDown_(o,e)}siftDown_(e,t){let n=this.elements_,r=this.priorities_,i=n[t],a=r[t];for(;t>e;){let e=this.getParentIndex_(t);if(r[e]>a)n[t]=n[e],r[t]=r[e],t=e;else break}n[t]=i,r[t]=a}reprioritize(){let e=this.priorityFunction_,t=this.elements_,n=this.priorities_,r=0,i=t.length,a,o,s;for(o=0;o<i;++o)a=t[o],s=e(a),s==1/0?delete this.queuedElements_[this.keyFunction_(a)]:(n[r]=s,t[r++]=a);t.length=r,n.length=r,this.heapify_()}},ci=class extends si{constructor(e,t){super(t=>e.apply(null,t),e=>e[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){let t=super.enqueue(e);return t&&e[0].addEventListener(_.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){let t=e.target,n=t.getState();if(n===X.LOADED||n===X.ERROR||n===X.EMPTY){n!==X.ERROR&&t.removeEventListener(_.CHANGE,this.boundHandleTileChange_);let e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;){let e=this.dequeue()[0],t=e.getKey();e.getState()===X.IDLE&&!(t in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[t]=!0,++this.tilesLoading_,++n,e.load())}}};function li(e,t,n,r,i){if(!e||!(n in e.wantedTiles)||!e.wantedTiles[n][t.getKey()])return 1/0;let a=e.viewState.center,o=r[0]-a[0],s=r[1]-a[1];return 65536*Math.log(i)+Math.sqrt(o*o+s*s)/i}function ui(e,t,n){if(!(n in e))return e[n]=new Set([t]),!0;let r=e[n],i=r.has(t);return i||r.add(t),!i}function di(e,t,n){let r=e[n];return r?r.delete(t):!1}function fi(e,t){let n=e.layerStatesArray[e.layerIndex];n.extent&&(t=C(t,Wt(n.extent,e.viewState.projection)));let r=n.layer.getRenderSource();if(!r.getWrapX()){let n=r.getTileGridForProjection(e.viewState.projection).getExtent();n&&(t=C(t,n))}return t}var pi=class extends sn{constructor(e,t){super(e),t||={},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=l(),this.tempTileRange_=new dr(0,0,0,0),this.tempTileCoord_=rr(0,0,0);let n=t.cacheSize===void 0?512:t.cacheSize;this.tileCache_=new nr(n),this.sourceTileCache_=null,this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||=new nr(512),this.sourceTileCache_}getOrCreateTile(e,t,n,r){let i=this.tileCache_,a=this.getLayer().getSource(),o=ar(a,a.getKey(),e,t,n),s;if(i.containsKey(o))s=i.get(o);else{let c=r.viewState.projection,l=a.getProjection();if(s=a.getTile(e,t,n,r.pixelRatio,c,!l||Ct(l,c)?void 0:this.getSourceTileCache()),!s)return null;i.set(o,s)}return s}getTile(e,t,n,r){return this.getOrCreateTile(e,t,n,r)||null}getData(e){let t=this.frameState;if(!t)return null;let n=this.getLayer(),r=cn(t.pixelToCoordinateTransform,e.slice()),i=n.getExtent();if(i&&!xe(i,r))return null;let a=t.viewState,o=n.getRenderSource(),s=o.getTileGridForProjection(a.projection),c=o.getTilePixelRatio(t.pixelRatio);for(let e=s.getZForResolution(a.resolution);e>=s.getMinZoom();--e){let n=s.getTileCoordForCoordAndZ(r,e),i=this.getTile(e,n[1],n[2],t);if(!i||i.getState()!==X.LOADED)continue;let l=s.getOrigin(e),u=K(s.getTileSize(e)),d=s.getResolution(e),f;if(i instanceof Fr||i instanceof qr)f=i.getImage();else if(i instanceof oi){if(f=ri(i.getData()),!f)continue}else continue;let p=Math.floor(c*((r[0]-l[0])/d-n[1]*u[0])),m=Math.floor(c*((l[1]-r[1])/d-n[2]*u[1])),h=Math.round(c*o.getGutterForProjection(a.projection));return this.getImageData(f,p+h,m+h)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let n=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=n,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(t,n,r,i,a){let o=t.viewState,s=this.getLayer(),c=s.getRenderSource(),l=c.getTileGridForProjection(o.projection),u=N(c);u in t.wantedTiles||(t.wantedTiles[u]={});let d=t.wantedTiles[u],f=s.getMapInternal(),p=Math.max(r-a,l.getMinZoom(),l.getZForResolution(Math.min(s.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(s.getMinZoom(),0)):l.getResolution(0)),c.zDirection)),m=o.rotation,h=m?e(o.center,o.resolution,m,t.size):void 0;for(let e=r;e>=p;--e){let r=l.getTileRangeForExtentAndZ(n,e,this.tempTileRange_),a=l.getResolution(e);for(let n=r.minX;n<=r.maxX;++n)for(let o=r.minY;o<=r.maxY;++o){if(m&&!l.tileCoordIntersectsViewport([e,n,o],h))continue;let r=this.getTile(e,n,o,t);if(!r||!ui(i,r,e))continue;let s=r.getKey();if(d[s]=!0,r.getState()===X.IDLE&&!t.tileQueue.isKeyQueued(s)){let i=rr(e,n,o,this.tempTileCoord_);t.tileQueue.enqueue([r,u,l.getTileCoordCenter(i),a])}}}}findStaleTile_(e,t){let n=this.tileCache_,r=e[0],i=e[1],a=e[2],o=this.getStaleKeys();for(let e=0;e<o.length;++e){let s=ar(this.getLayer().getSource(),o[e],r,i,a);if(n.containsKey(s)){let e=n.peek(s);if(e.getState()===X.LOADED)return e.endTransition(N(this)),ui(t,e,r),!0}}return!1}findAltTiles_(e,t,n,r){let i=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!i)return!1;let a=!0,o=this.tileCache_,s=this.getLayer().getRenderSource(),c=s.getKey();for(let e=i.minX;e<=i.maxX;++e)for(let t=i.minY;t<=i.maxY;++t){let i=ar(s,c,n,e,t),l=!1;if(o.containsKey(i)){let e=o.peek(i);e.getState()===X.LOADED&&(ui(r,e,n),l=!0)}l||(a=!1)}return a}renderFrame(e,t){this.renderComplete=!0;let r=e.layerStatesArray[e.layerIndex],i=e.viewState,a=i.projection,o=i.resolution,s=i.center,c=e.pixelRatio,l=this.getLayer(),u=l.getSource(),d=u.getTileGridForProjection(a),f=d.getZForResolution(o,u.zDirection),p=d.getResolution(f),m=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==m&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=m):this.renderedSourceKey_=m;let h=e.extent,g=u.getTilePixelRatio(c);this.prepareContainer(e,t);let _=this.context.canvas.width,v=this.context.canvas.height,y=r.extent&&Wt(r.extent,a);y&&(h=C(h,Wt(r.extent,a)));let b=p*_/2/g,S=p*v/2/g,w=[s[0]-b,s[1]-S,s[0]+b,s[1]+S],T={};this.renderedTiles.length=0;let E=l.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){let t=d.getZForResolution(i.nextResolution,u.zDirection),n=fi(e,e.nextExtent);this.enqueueTiles(e,n,t,T,E)}let ee=fi(e,h);if(this.enqueueTiles(e,ee,f,T,0),E>0&&setTimeout(()=>{this.enqueueTiles(e,ee,f-1,T,E-1)},0),!(f in T))return this.container;let D=N(this),te=e.time;for(let t of T[f]){let n=t.getState();if(n===X.EMPTY)continue;let r=t.tileCoord;if(n===X.LOADED&&t.getAlpha(D,te)===1){t.endTransition(D);continue}if(n!==X.ERROR&&(this.renderComplete=!1),this.findStaleTile_(r,T)){di(T,t,f),e.animate=!0;continue}if(this.findAltTiles_(d,r,f+1,T))continue;let i=d.getMinZoom();for(let e=f-1;e>=i&&!this.findAltTiles_(d,r,e,T);--e);}let ne=p/o*c/g,O=this.getRenderContext(e);Zt(this.tempTransform,_/2,v/2,ne,ne,0,-_/2,-v/2),r.extent&&this.clipUnrotated(O,e,y),u.getInterpolate()||(O.imageSmoothingEnabled=!1),this.preRender(O,e);let re=Object.keys(T).map(Number);re.sort(x);let k,A=[],ie=[];for(let t=re.length-1;t>=0;--t){let n=re[t],r=u.getTilePixelSize(n,c,a),i=d.getResolution(n)/p,o=r[0]*i*ne,s=r[1]*i*ne,l=d.getTileCoordForCoordAndZ(me(w),n),f=d.getTileCoordExtent(l),m=cn(this.tempTransform,[g*(f[0]-w[0])/p,g*(w[3]-f[3])/p]),h=g*u.getGutterForProjection(a);for(let t of T[n]){if(t.getState()!==X.LOADED)continue;let r=t.tileCoord,i=l[1]-r[1],a=Math.round(m[0]-(i-1)*o),c=l[2]-r[2],d=Math.round(m[1]-(c-1)*s),f=Math.round(m[0]-i*o),p=Math.round(m[1]-c*s),g=a-f,_=d-p,v=re.length===1,y=!1;k=[f,p,f+g,p,f+g,p+_,f,p+_];for(let e=0,t=A.length;e<t;++e)if(!v&&n<ie[e]){let t=A[e];Fe([f,p,f+g,p+_],[t[0],t[3],t[4],t[7]])&&(y||=(O.save(),!0),O.beginPath(),O.moveTo(k[0],k[1]),O.lineTo(k[2],k[3]),O.lineTo(k[4],k[5]),O.lineTo(k[6],k[7]),O.moveTo(t[6],t[7]),O.lineTo(t[4],t[5]),O.lineTo(t[2],t[3]),O.lineTo(t[0],t[1]),O.clip())}A.push(k),ie.push(n),this.drawTile(t,e,f,p,g,_,h,v),y&&O.restore(),this.renderedTiles.unshift(t),this.updateUsedTiles(e.usedTiles,u,t)}}return this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!n(this.renderedExtent_,w),this.renderedExtent_=w,this.renderedPixelRatio=c,this.postRender(this.context,e),r.extent&&O.restore(),O.imageSmoothingEnabled=!0,this.renderComplete&&e.postRenderFunctions.push((e,t)=>{let n=N(u),r=t.wantedTiles[n],i=r?Object.keys(r).length:0;this.updateCacheSize(i),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()}),this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,n,r,i,a,o,s){let c;if(e instanceof oi){if(c=ri(e.getData()),!c)throw Error(`Rendering array data is not yet supported`)}else c=this.getTileImage(e);if(!c)return;let l=this.getRenderContext(t),u=N(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(s?e.getAlpha(u,t.time):1),p=f!==l.globalAlpha;p&&(l.save(),l.globalAlpha=f),l.drawImage(c,o,o,c.width-2*o,c.height-2*o,n,r,i,a),p&&l.restore(),f===d.opacity?s&&e.endTransition(u):t.animate=!0}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,n){let r=N(t);r in e||(e[r]={}),e[r][n.getKey()]=!0}},mi={PRELOAD:`preload`,USE_INTERIM_TILES_ON_ERROR:`useInterimTilesOnError`},hi=class extends rn{constructor(e){e||={};let t=Object.assign({},e),n=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(e.preload===void 0?0:e.preload),this.setUseInterimTilesOnError(e.useInterimTilesOnError===void 0?!0:e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(mi.PRELOAD)}setPreload(e){this.set(mi.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(mi.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(mi.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}},gi=class extends hi{constructor(e){super(e)}createRenderer(){return new pi(this,{cacheSize:this.getCacheSize()})}};function _i(e,t,n){let r=[],i=e(0),a=e(1),o=t(i),s=t(a),c=[a,i],l=[s,o],u=[1,0],d={},f=1e5,p,m,h,g,_,v;for(;--f>0&&u.length>0;)h=u.pop(),i=c.pop(),o=l.pop(),v=h.toString(),v in d||(r.push(o[0],o[1]),d[v]=!0),g=u.pop(),a=c.pop(),s=l.pop(),_=(h+g)/2,p=e(_),m=t(p),jt(m[0],m[1],o[0],o[1],s[0],s[1])<n?(r.push(s[0],s[1]),v=g.toString(),d[v]=!0):(u.push(g,_,_,h),l.push(s,m,m,o),c.push(a,p,p,i));return r}function vi(e,t,n,r,i){return _i(function(r){return[e,t+(n-t)*r]},Rt(G(`EPSG:4326`),r),i)}function yi(e,t,n,r,i){return _i(function(r){return[t+(n-t)*r,e]},Rt(G(`EPSG:4326`),r),i)}function bi(e){if(!(e.context instanceof CanvasRenderingContext2D))throw Error(`Only works for render events from Canvas 2D layers`);let t=e.inversePixelTransform[0],n=e.inversePixelTransform[1],r=Math.sqrt(t*t+n*n),i=e.frameState,a=Nn(e.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=wn(i.viewState.resolution,r),s,c=bt();return c&&(s=mn(c,i.viewState.projection)),new nn(e.context,r,i.extent,a,i.viewState.rotation,o,s)}var xi=new Qt({color:`rgba(0,0,0,0.2)`}),Si=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600],Ci=class extends zn{constructor(e){e||={};let t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize===void 0?100:e.targetSize,this.maxLines_=e.maxLines===void 0?100:e.maxLines,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle===void 0?xi:e.strokeStyle,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?kt.bind(this,`EW`):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?kt.bind(this,`NS`):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new un({text:e.lonLabelStyle===void 0?new Cn({font:`12px Calibri,sans-serif`,textBaseline:`bottom`,fill:new vn({color:`rgba(0,0,0,1)`}),stroke:new Qt({color:`rgba(255,255,255,1)`,width:3})}):e.lonLabelStyle.clone()}),this.lonLabelStyle_=e=>{let t=e.get(`graticule_label`);return this.lonLabelStyleBase_.getText().setText(t),this.lonLabelStyleBase_},this.latLabelStyleBase_=new un({text:e.latLabelStyle===void 0?new Cn({font:`12px Calibri,sans-serif`,textAlign:`right`,fill:new vn({color:`rgba(0,0,0,1)`}),stroke:new Qt({color:`rgba(255,255,255,1)`,width:3})}):e.latLabelStyle.clone()}),this.latLabelStyle_=e=>{let t=e.get(`graticule_label`);return this.latLabelStyleBase_.getText().setText(t),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(Yt.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals===void 0?Si:e.intervals,this.setSource(new $t({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new q,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new un({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let n=e.slice();return this.projection_&&this.getSource().getWrapX()&&Ee(n,this.projection_),this.loadedExtent_&&(c(this.loadedExtent_,n,t)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(e,t,r){this.loadedExtent_=e;let i=this.getSource(),a=C(this.getExtent()||[-1/0,-1/0,1/0,1/0],e);if(this.renderedExtent_&&n(this.renderedExtent_,a)&&this.renderedResolution_===t||(this.renderedExtent_=a,this.renderedResolution_=t,se(a)))return;let o=m(a),s=t*t/4;(!this.projection_||!Ct(this.projection_,r))&&this.updateProjectionInfo_(r),this.createGraticule_(a,o,t,s);let c=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(c+=this.meridians_.length),this.parallelsLabels_&&(c+=this.parallels_.length);let l;for(;c>this.featurePool_.length;)l=new At,this.featurePool_.push(l);let u=i.getFeaturesCollection();u.clear();let d=0,f,p;for(f=0,p=this.meridians_.length;f<p;++f)l=this.featurePool_[d++],l.setGeometry(this.meridians_[f]),l.setStyle(this.lineStyle_),u.push(l);for(f=0,p=this.parallels_.length;f<p;++f)l=this.featurePool_[d++],l.setGeometry(this.parallels_[f]),l.setStyle(this.lineStyle_),u.push(l)}addMeridian_(e,t,n,r,i,a){let o=this.getMeridian_(e,t,n,r,a);if(Fe(o.getExtent(),i)){if(this.meridiansLabels_){let t=this.lonLabelFormatter_(e);a in this.meridiansLabels_?this.meridiansLabels_[a].text=t:this.meridiansLabels_[a]={geom:new Ln([]),text:t}}this.meridians_[a++]=o}return a}addParallel_(e,t,n,r,i,a){let o=this.getParallel_(e,t,n,r,a);if(Fe(o.getExtent(),i)){if(this.parallelsLabels_){let t=this.latLabelFormatter_(e);a in this.parallelsLabels_?this.parallelsLabels_[a].text=t:this.parallelsLabels_[a]={geom:new Ln([]),text:t}}this.parallels_[a++]=o}return a}drawLabels_(e){let t=e.frameState.viewState.rotation,n=e.frameState.viewState.resolution,r=e.frameState.size,i=e.frameState.extent,a=m(i),o=i;if(t){let e=r[0]*n,t=r[1]*n;o=[a[0]-e/2,a[1]-t/2,a[0]+e/2,a[1]+t/2]}let s=0,c=0,l=this.latLabelPosition_<.5,u=this.projection_.getExtent(),d=M(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!v(u,i)){s=Math.floor((i[0]-u[0])/d),c=Math.ceil((i[2]-u[2])/d);let e=Math.abs(t)>Math.PI/2;l=l!==e}let f=bi(e);for(let e=s;e<=c;++e){let n=this.meridians_.length+this.parallels_.length,r,u,p,m;if(this.meridiansLabels_)for(u=0,p=this.meridiansLabels_.length;u<p;++u){let s=this.meridians_[u];if(!t&&e===0)m=this.getMeridianPoint_(s,i,u);else{let n=s.clone();n.translate(e*d,0),n.rotate(-t,a),m=this.getMeridianPoint_(n,o,u),m.rotate(t,a)}r=this.featurePool_[n++],r.setGeometry(m),r.set(`graticule_label`,this.meridiansLabels_[u].text),f.drawFeature(r,this.lonLabelStyle_(r))}if(this.parallelsLabels_&&(e===s&&l||e===c&&!l))for(u=0,p=this.parallels_.length;u<p;++u){let s=this.parallels_[u];if(!t&&e===0)m=this.getParallelPoint_(s,i,u);else{let n=s.clone();n.translate(e*d,0),n.rotate(-t,a),m=this.getParallelPoint_(n,o,u),m.rotate(t,a)}r=this.featurePool_[n++],r.setGeometry(m),r.set(`graticule_label`,this.parallelsLabels_[u].text),f.drawFeature(r,this.latLabelStyle_(r))}}}createGraticule_(e,t,n,r){let i=this.getInterval_(n);if(i==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let a=!1,o=this.projection_.getExtent(),s=M(o);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!v(o,e)&&(M(e)>=s?(e[0]=o[0],e[2]=o[2]):a=!0);let c=[J(t[0],this.minX_,this.maxX_),J(t[1],this.minY_,this.maxY_)],l=this.toLonLatTransform_(c);isNaN(l[1])&&(l[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let u=J(l[0],this.minLon_,this.maxLon_),d=J(l[1],this.minLat_,this.maxLat_),f=this.maxLines_,p,m,h,g,_=e;a||(_=[J(e[0],this.minX_,this.maxX_),J(e[1],this.minY_,this.maxY_),J(e[2],this.minX_,this.maxX_),J(e[3],this.minY_,this.maxY_)]);let y=E(_,this.toLonLatTransform_,void 0,8),b=y[3],x=y[2],S=y[1],C=y[0];if(a||(xe(_,this.bottomLeft_)&&(C=this.minLon_,S=this.minLat_),xe(_,this.bottomRight_)&&(x=this.maxLon_,S=this.minLat_),xe(_,this.topLeft_)&&(C=this.minLon_,b=this.maxLat_),xe(_,this.topRight_)&&(x=this.maxLon_,b=this.maxLat_),b=J(b,d,this.maxLat_),x=J(x,u,this.maxLon_),S=J(S,this.minLat_,d),C=J(C,this.minLon_,u)),u=Math.floor(u/i)*i,g=J(u,this.minLon_,this.maxLon_),m=this.addMeridian_(g,S,b,r,e,0),p=0,a)for(;(g-=i)>=C&&p++<f;)m=this.addMeridian_(g,S,b,r,e,m);else for(;g!=this.minLon_&&p++<f;)g=Math.max(g-i,this.minLon_),m=this.addMeridian_(g,S,b,r,e,m);if(g=J(u,this.minLon_,this.maxLon_),p=0,a)for(;(g+=i)<=x&&p++<f;)m=this.addMeridian_(g,S,b,r,e,m);else for(;g!=this.maxLon_&&p++<f;)g=Math.min(g+i,this.maxLon_),m=this.addMeridian_(g,S,b,r,e,m);for(this.meridians_.length=m,this.meridiansLabels_&&(this.meridiansLabels_.length=m),d=Math.floor(d/i)*i,h=J(d,this.minLat_,this.maxLat_),m=this.addParallel_(h,C,x,r,e,0),p=0;h!=this.minLat_&&p++<f;)h=Math.max(h-i,this.minLat_),m=this.addParallel_(h,C,x,r,e,m);for(h=J(d,this.minLat_,this.maxLat_),p=0;h!=this.maxLat_&&p++<f;)h=Math.min(h+i,this.maxLat_),m=this.addParallel_(h,C,x,r,e,m);this.parallels_.length=m,this.parallelsLabels_&&(this.parallelsLabels_.length=m)}getInterval_(e){let t=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1],r=-1,i=(this.targetSize_*e)**2,a=[],o=[];for(let e=0,s=this.intervals_.length;e<s;++e){let s=J(this.intervals_[e]/2,0,90),c=J(n,-90+s,90-s);if(a[0]=t-s,a[1]=c-s,o[0]=t+s,o[1]=c+s,this.fromLonLatTransform_(a,a),this.fromLonLatTransform_(o,o),(o[0]-a[0])**2+(o[1]-a[1])**2<=i)break;r=this.intervals_[e]}return r}getMeridian_(e,t,n,r,i){let a=vi(e,t,n,this.projection_,r),o=this.meridians_[i];return o?(o.setFlatCoordinates(`XY`,a),o.changed()):(o=new xt(a,`XY`),this.meridians_[i]=o),o}getMeridianPoint_(e,t,n){let r=e.getFlatCoordinates(),i=1,a=r.length-1;r[i]>r[a]&&(i=a,a=1);let o=Math.max(t[1],r[i]),s=Math.min(t[3],r[a]),c=J(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,o,s),l=[r[i-1]+(r[a-1]-r[i-1])*(c-r[i])/(r[a]-r[i]),c],u=this.meridiansLabels_[n].geom;return u.setCoordinates(l),u}getMeridians(){return this.meridians_}getParallel_(e,t,n,r,i){let a=yi(e,t,n,this.projection_,r),o=this.parallels_[i];return o?(o.setFlatCoordinates(`XY`,a),o.changed()):o=new xt(a,`XY`),o}getParallelPoint_(e,t,n){let r=e.getFlatCoordinates(),i=0,a=r.length-2;r[i]>r[a]&&(i=a,a=0);let o=Math.max(t[0],r[i]),s=Math.min(t[2],r[a]),c=J(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,o,s),l=[c,r[i+1]+(r[a+1]-r[i+1])*(c-r[i])/(r[a]-r[i])],u=this.parallelsLabels_[n].geom;return u.setCoordinates(l),u}getParallels(){return this.parallels_}updateProjectionInfo_(e){let t=G(`EPSG:4326`),n=e.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];let r=Rt(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=r;else{let e=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(t,n,i){i||=2;let a=r(t,n,i);for(let t=0,n=a.length;t<n;t+=i)a[t]<e&&(a[t]+=360);return a}}this.fromLonLatTransform_=Rt(t,e);let i=E([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=i[0],this.maxX_=i[2],this.minY_=i[1],this.maxY_=i[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(m(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}},Z={ADDLAYER:`addlayer`,REMOVELAYER:`removelayer`},wi=class extends ce{constructor(e,t){super(e),this.layer=t}},Ti={LAYERS:`layers`},Ei=class e extends bn{constructor(e){e||={};let t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ti.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new q(n.slice(),{unique:!0}):Y(typeof n.getArray==`function`,"Expected `layers` to be an array or a `Collection`"):n=new q(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(P),this.layersListenerKeys_.length=0;let e=this.getLayers();for(let t in this.layersListenerKeys_.push(j(e,W.ADD,this.handleLayersAdd_,this),j(e,W.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(P);He(this.listenerKeys_);let t=e.getArray();for(let e=0,n=t.length;e<n;e++){let n=t[e];this.registerLayerListeners_(n),this.dispatchEvent(new wi(Z.ADDLAYER,n))}this.changed()}registerLayerListeners_(t){let n=[j(t,w.PROPERTYCHANGE,this.handleLayerChange_,this),j(t,_.CHANGE,this.handleLayerChange_,this)];t instanceof e&&n.push(j(t,Z.ADDLAYER,this.handleLayerGroupAdd_,this),j(t,Z.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[N(t)]=n}handleLayerGroupAdd_(e){this.dispatchEvent(new wi(Z.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new wi(Z.REMOVELAYER,e.layer))}handleLayersAdd_(e){let t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new wi(Z.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){let t=e.element,n=N(t);this.listenerKeys_[n].forEach(P),delete this.listenerKeys_[n],this.dispatchEvent(new wi(Z.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(Ti.LAYERS)}setLayers(e){let t=this.getLayers();if(t){let e=t.getArray();for(let t=0,n=e.length;t<n;++t)this.dispatchEvent(new wi(Z.REMOVELAYER,e[t]))}this.set(Ti.LAYERS,e)}getLayersArray(e){return e=e===void 0?[]:e,this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){let t=e===void 0?[]:e,n=t.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(t)});let r=this.getLayerState(),i=r.zIndex;!e&&r.zIndex===void 0&&(i=0);for(let e=n,a=t.length;e<a;e++){let n=t[e];n.opacity*=r.opacity,n.visible=n.visible&&r.visible,n.maxResolution=Math.min(n.maxResolution,r.maxResolution),n.minResolution=Math.max(n.minResolution,r.minResolution),n.minZoom=Math.max(n.minZoom,r.minZoom),n.maxZoom=Math.min(n.maxZoom,r.maxZoom),r.extent!==void 0&&(n.extent===void 0?n.extent=r.extent:n.extent=C(n.extent,r.extent)),n.zIndex===void 0&&(n.zIndex=i)}return t}getSourceState(){return`ready`}},Di=class extends fe{constructor(e){super();let t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents=`auto`),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let e=0,t=this.listenerKeys.length;e<t;++e)P(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=e,e){let t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==ee&&this.listenerKeys.push(j(e,Bn.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e==`string`?document.getElementById(e):e}},Oi=class extends Di{constructor(e){e||={},super({element:document.createElement(`div`),render:e.render,target:e.target}),this.ulElement_=document.createElement(`ul`),this.collapsed_=e.collapsed===void 0?!0:e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible===void 0?!0:e.collapsible,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;let t=e.className===void 0?`ol-attribution`:e.className,n=e.tipLabel===void 0?`Attributions`:e.tipLabel,r=e.expandClassName===void 0?t+`-expand`:e.expandClassName,i=e.collapseLabel===void 0?``:e.collapseLabel,a=e.collapseClassName===void 0?t+`-collapse`:e.collapseClassName;typeof i==`string`?(this.collapseLabel_=document.createElement(`span`),this.collapseLabel_.textContent=i,this.collapseLabel_.className=a):this.collapseLabel_=i;let o=e.label===void 0?`i`:e.label;typeof o==`string`?(this.label_=document.createElement(`span`),this.label_.textContent=o,this.label_.className=r):this.label_=o;let s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement(`button`),this.toggleButton_.setAttribute(`type`,`button`),this.toggleButton_.setAttribute(`aria-expanded`,String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(s),this.toggleButton_.addEventListener(_.CLICK,this.handleClick_.bind(this),!1);let c=t+` `+ae+` `+ke+(this.collapsed_&&this.collapsible_?` `+Ie:``)+(this.collapsible_?``:` ol-uncollapsible`),l=this.element;l.className=c,l.appendChild(this.toggleButton_),l.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){let t=this.getMap().getAllLayers(),n=new Set(t.flatMap(t=>t.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(e=>n.add(e)):n.add(this.attributions_)),!this.overrideCollapsible_){let e=!t.some(e=>e.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(e)}return Array.from(n)}async updateElement_(e){if(!e){this.renderedVisible_&&=(this.element.style.display=`none`,!1);return}let t=await Promise.all(this.collectSourceAttributions_(e).map(e=>s(()=>e))),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?``:`none`,this.renderedVisible_=n),!Se(t,this.renderedAttributions_)){ve(this.ulElement_);for(let e=0,n=t.length;e<n;++e){let n=document.createElement(`li`);n.innerHTML=t[e],this.ulElement_.appendChild(n)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ie),this.collapsed_?ie(this.collapseLabel_,this.label_):ie(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute(`aria-expanded`,String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle(`ol-uncollapsible`),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},ki=class extends Di{constructor(e){e||={},super({element:document.createElement(`div`),render:e.render,target:e.target});let t=e.className===void 0?`ol-rotate`:e.className,n=e.label===void 0?``:e.label,r=e.compassClassName===void 0?`ol-compass`:e.compassClassName;this.label_=null,typeof n==`string`?(this.label_=document.createElement(`span`),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));let i=e.tipLabel?e.tipLabel:`Reset rotation`,a=document.createElement(`button`);a.className=t+`-reset`,a.setAttribute(`type`,`button`),a.title=i,a.appendChild(this.label_),a.addEventListener(_.CLICK,this.handleClick_.bind(this),!1);let o=t+` `+ae+` `+ke,s=this.element;s.className=o,s.appendChild(a),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration===void 0?250:e.duration,this.autoHide_=e.autoHide===void 0?!0:e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ne)}handleClick_(e){e.preventDefault(),this.callResetNorth_===void 0?this.resetNorth_():this.callResetNorth_()}resetNorth_(){let e=this.getMap().getView();if(!e)return;let t=e.getRotation();t!==void 0&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Et}):e.setRotation(0))}render(e){let t=e.frameState;if(!t)return;let n=t.viewState.rotation;if(n!=this.rotation_){let e=`rotate(`+n+`rad)`;if(this.autoHide_){let e=this.element.classList.contains(Ne);!e&&n===0?this.element.classList.add(Ne):e&&n!==0&&this.element.classList.remove(Ne)}this.label_.style.transform=e}this.rotation_=n}},Ai=class extends Di{constructor(e){e||={},super({element:document.createElement(`div`),target:e.target});let t=e.className===void 0?`ol-zoom`:e.className,n=e.delta===void 0?1:e.delta,r=e.zoomInClassName===void 0?t+`-in`:e.zoomInClassName,i=e.zoomOutClassName===void 0?t+`-out`:e.zoomOutClassName,a=e.zoomInLabel===void 0?`+`:e.zoomInLabel,o=e.zoomOutLabel===void 0?``:e.zoomOutLabel,s=e.zoomInTipLabel===void 0?`Zoom in`:e.zoomInTipLabel,c=e.zoomOutTipLabel===void 0?`Zoom out`:e.zoomOutTipLabel,l=document.createElement(`button`);l.className=r,l.setAttribute(`type`,`button`),l.title=s,l.appendChild(typeof a==`string`?document.createTextNode(a):a),l.addEventListener(_.CLICK,this.handleClick_.bind(this,n),!1);let u=document.createElement(`button`);u.className=i,u.setAttribute(`type`,`button`),u.title=c,u.appendChild(typeof o==`string`?document.createTextNode(o):o),u.addEventListener(_.CLICK,this.handleClick_.bind(this,-n),!1);let d=t+` `+ae+` `+ke,f=this.element;f.className=d,f.appendChild(l),f.appendChild(u),this.duration_=e.duration===void 0?250:e.duration}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){let t=this.getMap().getView();if(!t)return;let n=t.getZoom();if(n!==void 0){let r=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:r,duration:this.duration_,easing:Et})):t.setZoom(r)}}};function ji(e){e||={};let t=new q;return(e.zoom===void 0||e.zoom)&&t.push(new Ai(e.zoomOptions)),(e.rotate===void 0||e.rotate)&&t.push(new ki(e.rotateOptions)),(e.attribution===void 0||e.attribution)&&t.push(new Oi(e.attributionOptions)),t}var Mi={POINTERMOVE:`pointermove`,POINTERDOWN:`pointerdown`,POINTERUP:`pointerup`,POINTEROVER:`pointerover`,POINTEROUT:`pointerout`,POINTERENTER:`pointerenter`,POINTERLEAVE:`pointerleave`,POINTERCANCEL:`pointercancel`},Ni=`projection`,Pi=`coordinateFormat`,Fi=class extends Di{constructor(e){e||={};let t=document.createElement(`div`);t.className=e.className===void 0?`ol-mouse-position`:e.className,super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(Ni,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:`&#160;`,this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Pi)}getProjection(){return this.get(Ni)}handleMouseMove(e){let t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){let t=e.getViewport();this.listenerKeys.push(j(t,Mi.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(j(t,Mi.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Pi,e)}setProjection(e){this.set(Ni,G(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){let e=this.getProjection();e?this.transform_=mn(this.mapProjection_,e):this.transform_=fn}let n=this.getMap().getCoordinateFromPixelInternal(e);if(n){let e=bt();e&&(this.transform_=mn(this.mapProjection_,e)),this.transform_(n,n),this.wrapX_&&Rn(n,e||this.getProjection()||this.mapProjection_);let r=this.getCoordinateFormat();t=r?r(n):n.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){let t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}},Ii=`units`,Li=[1,2,5],Ri=25.4/.28,zi=class extends Di{constructor(e){e||={};let t=document.createElement(`div`);t.style.pointerEvents=`none`,super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;let n=e.className===void 0?e.bar?`ol-scale-bar`:`ol-scale-line`:e.className;this.innerElement_=document.createElement(`div`),this.innerElement_.className=n+`-inner`,this.element.className=n+` `+ae,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth===void 0?64:e.minWidth,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_=``,this.addChangeListener(Ii,this.handleUnitsChanged_),this.setUnits(e.units||`metric`),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(Ii)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(Ii,e)}setDpi(e){this.dpi_=e}updateElement_(){let e=this.viewState_;if(!e){this.renderedVisible_&&=(this.element.style.display=`none`,!1);return}let t=e.center,n=e.projection,r=this.getUnits(),i=r==`degrees`?`degrees`:`m`,a=Tt(n,e.resolution,t,i),o=this.minWidth_*(this.dpi_||Ri)/Ri,s=this.maxWidth_===void 0?void 0:this.maxWidth_*(this.dpi_||Ri)/Ri,c=o*a,l=``;if(r==`degrees`){let e=Bt.degrees;c*=e,c<e/60?(l=``,a*=3600):c<e?(l=``,a*=60):l=``}else if(r==`imperial`)c<.9144?(l=`in`,a/=.0254):c<1609.344?(l=`ft`,a/=.3048):(l=`mi`,a/=1609.344);else if(r==`nautical`)a/=1852,l=`NM`;else if(r==`metric`)c<1e-6?(l=`nm`,a*=1e9):c<.001?(l=`m`,a*=1e6):c<1?(l=`mm`,a*=1e3):c<1e3?l=`m`:(l=`km`,a/=1e3);else if(r==`us`)c<.9144?(l=`in`,a*=39.37):c<1609.344?(l=`ft`,a/=.30480061):(l=`mi`,a/=1609.3472);else throw Error(`Invalid units`);let u=3*Math.floor(Math.log(o*a)/Math.log(10)),d,f,p,m=0,h,g;for(;;){p=Math.floor(u/3);let e=10**p;if(d=Li[(u%3+3)%3]*e,f=Math.round(d/a),isNaN(f)){this.element.style.display=`none`,this.renderedVisible_=!1;return}if(s!==void 0&&f>=s){d=m,f=h,p=g;break}else if(f>=o)break;m=d,h=f,g=p,++u}let _=this.scaleBar_?this.createScaleBar(f,d,l):d.toFixed(p<0?-p:0)+` `+l;this.renderedHTML_!=_&&(this.innerElement_.innerHTML=_,this.renderedHTML_=_),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+`px`,this.renderedWidth_=f),this.renderedVisible_||=(this.element.style.display=``,!0)}createScaleBar(e,t,n){let r=this.getScaleForResolution(),i=r<1?Math.round(1/r).toLocaleString()+` : 1`:`1 : `+Math.round(r).toLocaleString(),a=this.scaleBarSteps_,o=e/a,s=[this.createMarker(`absolute`)];for(let r=0;r<a;++r){let i=r%2==0?`ol-scale-singlebar-odd`:`ol-scale-singlebar-even`;s.push(`<div><div class="ol-scale-singlebar ${i}" style="width: ${o}px;"></div>`+this.createMarker(`relative`)+(r%2==0||a===2?this.createStepText(r,e,!1,t,n):``)+`</div>`)}return s.push(this.createStepText(a,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+i+`</div>`:``)+s.join(``)}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e===`absolute`?3:-10}px;"></div>`}createStepText(e,t,n,r,i){let a=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?``:` `+i),o=e===0?-3:t/this.scaleBarSteps_*-1,s=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${o}px;text-align: ${e===0?`left`:`center`};min-width: ${s}px;left: ${n?t+`px`:`unset`};">`+a+`</div>`}getScaleForResolution(){let e=Tt(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,`m`),t=this.dpi_||Ri;return e*(1e3/25.4)*t}render(e){let t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}},Q={SINGLECLICK:`singleclick`,CLICK:_.CLICK,DBLCLICK:_.DBLCLICK,POINTERDRAG:`pointerdrag`,POINTERMOVE:`pointermove`,POINTERDOWN:`pointerdown`,POINTERUP:`pointerup`,POINTEROVER:`pointerover`,POINTEROUT:`pointerout`,POINTERENTER:`pointerenter`,POINTERLEAVE:`pointerleave`,POINTERCANCEL:`pointercancel`},Bi={ACTIVE:`active`},Vi=class extends fe{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Bi.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Bi.ACTIVE,e)}setMap(e){this.map_=e}};function Hi(e,t,n){let r=e.getCenterInternal();if(r){let i=[r[0]+t[0],r[1]+t[1]];e.animateInternal({duration:n===void 0?250:n,easing:wt,center:e.getConstrainedCenter(i)})}}function Ui(e,t,n,r){let i=e.getZoom();if(i===void 0)return;let a=e.getConstrainedZoom(i+t),o=e.getResolutionForZoom(a);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:o,anchor:n,duration:r===void 0?250:r,easing:Et})}var Wi=Vi,Gi=class extends Wi{constructor(e){super(),e||={},this.delta_=e.delta?e.delta:1,this.duration_=e.duration===void 0?250:e.duration}handleEvent(e){let t=!1;if(e.type==Q.DBLCLICK){let n=e.originalEvent,r=e.map,i=e.coordinate,a=n.shiftKey?-this.delta_:this.delta_;Ui(r.getView(),a,i,this.duration_),n.preventDefault(),t=!0}return!t}};function Ki(e){let t=arguments;return function(e){let n=!0;for(let r=0,i=t.length;r<i&&(n&&=t[r](e),n);++r);return n}}const qi=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Ji=function(e){let t=e.map.getTargetElement(),n=t.getRootNode(),r=e.map.getOwnerDocument().activeElement;return n instanceof ShadowRoot?n.host.contains(r):t.contains(r)},Yi=function(e){let t=e.map.getTargetElement(),n=t.getRootNode();return(n instanceof ShadowRoot?n.host:t).hasAttribute(`tabindex`)?Ji(e):!0},Xi=Be,Zi=function(e){let t=e.originalEvent;return`pointerId`in t&&t.button==0&&!(i&&Ve&&t.ctrlKey)},Qi=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},$i=function(e){let t=e.originalEvent;return Ve?t.metaKey:t.ctrlKey},ea=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ta=function(e){let t=e.originalEvent,n=t.target.tagName;return n!==`INPUT`&&n!==`SELECT`&&n!==`TEXTAREA`&&!t.target.isContentEditable},na=function(e){let t=e.originalEvent;return`pointerId`in t&&t.pointerType==`mouse`},ra=function(e){let t=e.originalEvent;return`pointerId`in t&&t.isPrimary&&t.button===0};var ia=class extends p{constructor(e){super(),this.geometry_=null,this.element_=document.createElement(`div`),this.element_.style.position=`absolute`,this.element_.style.pointerEvents=`auto`,this.element_.className=`ol-box `+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let e=this.startPixel_,t=this.endPixel_,n=this.element_.style;n.left=Math.min(e[0],t[0])+`px`,n.top=Math.min(e[1],t[1])+`px`,n.width=Math.abs(t[0]-e[0])+`px`,n.height=Math.abs(t[1]-e[1])+`px`}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let e=this.element_.style;e.left=`inherit`,e.top=`inherit`,e.width=`inherit`,e.height=`inherit`}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;let e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Mt([n])}getGeometry(){return this.geometry_}},aa=class extends Wi{constructor(e){e||={},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence)e.type==Q.POINTERDRAG?(this.handleDragEvent(e),e.originalEvent.preventDefault()):e.type==Q.POINTERUP&&(this.handlingDownUpSequence=this.handleUpEvent(e)&&this.targetPointers.length>0);else if(e.type==Q.POINTERDOWN){let n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Q.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}};function oa(e){let t=e.length,n=0,r=0;for(let i=0;i<t;i++)n+=e[i].clientX,r+=e[i].clientY;return{clientX:n/t,clientY:r/t}}var sa=aa,ca={BOXSTART:`boxstart`,BOXDRAG:`boxdrag`,BOXEND:`boxend`,BOXCANCEL:`boxcancel`},la=class extends ce{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}},ua=class extends sa{constructor(e){super(),this.on,this.once,this.un,e??={},this.box_=new ia(e.className||`ol-dragbox`),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??Zi,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){let r=n[0]-t[0],i=n[1]-t[1];return r*r+i*i>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new la(ca.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;let t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new la(t?ca.BOXEND:ca.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new la(ca.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&=(this.dispatchEvent(new la(ca.BOXCANCEL,this.startPixel_,null)),null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&=(this.dispatchEvent(new la(ca.BOXCANCEL,this.startPixel_,null)),null)),super.setMap(e)}},da=class extends sa{constructor(e){super({stopDown:a}),e||={},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let t=e.condition?e.condition:Ki(Qi,ra);this.condition_=e.onFocusOnly?Ki(Yi,t):t,this.noKinetic_=!1}handleDragEvent(e){let t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());let n=this.targetPointers,r=t.getEventPixel(oa(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){let t=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],n=e.map.getView();Vt(t,n.getResolution()),Nt(t,n.getRotation()),n.adjustCenterInternal(t)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){let t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let e=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),i=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(i),o=t.getCoordinateFromPixelInternal([a[0]-e*Math.cos(r),a[1]-e*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(o),duration:500,easing:Et})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){let t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},fa=class extends sa{constructor(e){e||={},super({stopDown:a}),this.condition_=e.condition?e.condition:qi,this.lastAngle_=void 0,this.duration_=e.duration===void 0?250:e.duration}handleDragEvent(e){if(!na(e))return;let t=e.map,n=t.getView();if(n.getConstraints().rotation===ln)return;let r=t.getSize(),i=e.pixel,a=Math.atan2(r[1]/2-i[1],i[0]-r[0]/2);if(this.lastAngle_!==void 0){let e=a-this.lastAngle_;n.adjustRotationInternal(-e)}this.lastAngle_=a}handleUpEvent(e){return na(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return na(e)&&Zi(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},pa=class extends ua{constructor(e){e||={};let t=e.condition?e.condition:ea;super({condition:t,className:e.className||`ol-dragzoom`,minArea:e.minArea}),this.duration_=e.duration===void 0?200:e.duration,this.out_=e.out===void 0?!1:e.out}onBoxEnd(e){let t=this.getMap().getView(),n=this.getGeometry();if(this.out_){let e=t.rotatedExtentForGeometry(n),r=t.getResolutionForExtentInternal(e),i=t.getResolution()/r;n=n.clone(),n.scale(i*i)}t.fitInternal(n,{duration:this.duration_,easing:Et})}},ma=class extends ce{constructor(e,t,n){super(e),this.map=t,this.frameState=n===void 0?null:n}},ha=class extends ma{constructor(e,t,n,r,i,a){super(e,t,i),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r===void 0?!1:r,this.activePointers=a}get pixel(){return this.pixel_||=this.map.getEventPixel(this.originalEvent),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||=this.map.getCoordinateFromPixel(this.pixel),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),`preventDefault`in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),`stopPropagation`in this.originalEvent&&this.originalEvent.stopPropagation()}},ga={LEFT:`ArrowLeft`,UP:`ArrowUp`,RIGHT:`ArrowRight`,DOWN:`ArrowDown`},_a=class extends Wi{constructor(e){super(),e||={},this.defaultCondition_=function(e){return Qi(e)&&ta(e)},this.condition_=e.condition===void 0?this.defaultCondition_:e.condition,this.duration_=e.duration===void 0?100:e.duration,this.pixelDelta_=e.pixelDelta===void 0?128:e.pixelDelta}handleEvent(e){let t=!1;if(e.type==_.KEYDOWN){let n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==ga.DOWN||r==ga.LEFT||r==ga.RIGHT||r==ga.UP)){let i=e.map.getView(),a=i.getResolution()*this.pixelDelta_,o=0,s=0;r==ga.DOWN?s=-a:r==ga.LEFT?o=-a:r==ga.RIGHT?o=a:s=a;let c=[o,s];Nt(c,i.getRotation()),Hi(i,c,this.duration_),n.preventDefault(),t=!0}}return!t}},va=class extends Wi{constructor(e){super(),e||={},this.condition_=e.condition?e.condition:function(e){return!$i(e)&&ta(e)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration===void 0?100:e.duration}handleEvent(e){let t=!1;if(e.type==_.KEYDOWN||e.type==_.KEYPRESS){let n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r===`+`||r===`-`)){let i=e.map,a=r===`+`?this.delta_:-this.delta_;Ui(i.getView(),a,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}},ya=40,ba=300,xa=class extends Wi{constructor(e){e||={},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta===void 0?1:e.maxDelta,this.duration_=e.duration===void 0?250:e.duration,this.timeout_=e.timeout===void 0?80:e.timeout,this.useAnchor_=e.useAnchor===void 0?!0:e.useAnchor,this.constrainResolution_=e.constrainResolution===void 0?!1:e.constrainResolution;let t=e.condition?e.condition:Xi;this.condition_=e.onFocusOnly?Ki(Yi,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==_.WHEEL)return!0;let t=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r=n.deltaY;switch(n.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=ya;break;case WheelEvent.DOM_DELTA_PAGE:r*=ba;break;default:}if(r===0)return!1;this.lastDelta_=r;let i=Date.now();this.startTime_===void 0&&(this.startTime_=i),(!this.mode_||i-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?`trackpad`:`wheel`);let a=t.getView();if(this.mode_===`trackpad`&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=i,!1;this.totalDelta_+=r;let o=Math.max(this.timeout_-(i-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),o),!1}handleWheelZoom_(e){let t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-J(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Ui(t,n,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},Sa=class extends sa{constructor(e){e||={};let t=e;t.stopDown||=a,super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold===void 0?.3:e.threshold,this.duration_=e.duration===void 0?250:e.duration}handleDragEvent(e){let t=0,n=this.targetPointers[0],r=this.targetPointers[1],i=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){let e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=e}this.lastAngle_=i;let a=e.map,o=a.getView();o.getConstraints().rotation!==ln&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(oa(this.targetPointers))),this.rotating_&&(a.render(),o.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){let t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},Ca=class extends sa{constructor(e){e||={};let t=e;t.stopDown||=a,super(t),this.anchor_=null,this.duration_=e.duration===void 0?400:e.duration,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1,n=this.targetPointers[0],r=this.targetPointers[1],i=n.clientX-r.clientX,a=n.clientY-r.clientY,o=Math.sqrt(i*i+a*a);this.lastDistance_!==void 0&&(t=this.lastDistance_/o),this.lastDistance_=o;let s=e.map,c=s.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(oa(this.targetPointers))),s.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){let t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){let t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},wa=class{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;let e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;let r=this.points_[t+2]-this.points_[n+2];if(r<1e3/60)return!1;let i=this.points_[t]-this.points_[n],a=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(a,i),this.initialVelocity_=Math.sqrt(i*i+a*a)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}};function Ta(e){e||={};let t=new q,n=new wa(-.005,.05,100);return(e.altShiftDragRotate===void 0||e.altShiftDragRotate)&&t.push(new fa),(e.doubleClickZoom===void 0||e.doubleClickZoom)&&t.push(new Gi({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan===void 0||e.dragPan)&&t.push(new da({onFocusOnly:e.onFocusOnly,kinetic:n})),(e.pinchRotate===void 0||e.pinchRotate)&&t.push(new Sa),(e.pinchZoom===void 0||e.pinchZoom)&&t.push(new Ca({duration:e.zoomDuration})),(e.keyboard===void 0||e.keyboard)&&(t.push(new _a),t.push(new va({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom===void 0||e.mouseWheelZoom)&&t.push(new xa({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom===void 0||e.shiftDragZoom)&&t.push(new pa({duration:e.zoomDuration})),t}var Ea=class extends We{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;let n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=j(n,Mi.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=j(n,Mi.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(_.TOUCHMOVE,this.boundHandleTouchMove_,T?{passive:!1}:!1)}emulateClick_(e){let t=new ha(Q.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_===void 0?this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let t=new ha(Q.SINGLECLICK,this.map_,e);this.dispatchEvent(t)},250):(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new ha(Q.DBLCLICK,this.map_,e),this.dispatchEvent(t))}updateActivePointers_(e){let t=e,n=t.pointerId;if(t.type==Q.POINTERUP||t.type==Q.POINTERCANCEL){for(let e in delete this.trackedTouches_[n],this.trackedTouches_)if(this.trackedTouches_[e].target!==t.target){delete this.trackedTouches_[e];break}}else (t.type==Q.POINTERDOWN||t.type==Q.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);let t=new ha(Q.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(P),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);let t=new ha(Q.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,`target`,{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){let e=this.map_.getOwnerDocument();this.dragListenerKeys_.push(j(e,Q.POINTERMOVE,this.handlePointerMove_,this),j(e,Q.POINTERUP,this.handlePointerUp_,this),j(this.element_,Q.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==e&&this.dragListenerKeys_.push(j(this.element_.getRootNode(),Q.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;let t=new ha(Q.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;let t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new ha(Q.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){let t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!=`boolean`||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&=(P(this.relayedListenerKey_),null),this.element_.removeEventListener(_.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&=(P(this.pointerdownListenerKey_),null),this.dragListenerKeys_.forEach(P),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},$={LAYERGROUP:`layergroup`,SIZE:`size`,TARGET:`target`,VIEW:`view`},Da=class extends p{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){he()}calculateMatrices2D(e){let t=e.viewState,n=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Zt(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),tn(r,n)}forEachFeatureAtCoordinate(e,t,n,r,i,a,o,s){let c,l=t.viewState;function u(e,t,n,r){return i.call(a,t,e?n:null,r)}let d=l.projection,f=Rn(e.slice(),d),p=[[0,0]];if(d.canWrapX()&&r){let e=M(d.getExtent());p.push([-e,0],[e,0])}let m=t.layerStatesArray,h=m.length,g=[],_=[];for(let r=0;r<p.length;r++)for(let i=h-1;i>=0;--i){let a=m[i],d=a.layer;if(d.hasRenderer()&&on(a,l)&&o.call(s,d)){let i=d.getRenderer(),o=d.getSource();if(i&&o){let s=o.getWrapX()?f:e,l=u.bind(null,a.managed);_[0]=s[0]+p[r][0],_[1]=s[1]+p[r][1],c=i.forEachFeatureAtCoordinate(_,t,n,l,g)}if(c)return c}}if(g.length===0)return;let v=1/g.length;return g.forEach((e,t)=>e.distanceSq+=t*v),g.sort((e,t)=>e.distanceSq-t.distanceSq),g.some(e=>c=e.callback(e.feature,e.layer,e.geometry)),c}hasFeatureAtCoordinate(e,t,n,r,i,a){return this.forEachFeatureAtCoordinate(e,t,n,r,Be,this,i,a)!==void 0}getMap(){return this.map_}renderFrame(e){he()}scheduleExpireIconCache(e){Dn.canExpireCache()&&e.postRenderFunctions.push(Oa)}};function Oa(e,t){Dn.expire()}var ka=Da,Aa=class extends ka{constructor(e){super(e),this.fontChangeListenerKey_=j(hn,w.PROPERTYCHANGE,e.redrawText,e),this.element_=F?we():document.createElement(`div`);let t=this.element_.style;t.position=`absolute`,t.width=`100%`,t.height=`100%`,t.zIndex=`0`,this.element_.className=ae+` ol-layers`;let n=e.getViewport();n&&n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){let n=this.getMap();if(n.hasListener(e)){let r=new On(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){P(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&=(this.element_.style.display=`none`,!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(Yt.PRECOMPOSE,e);let t=e.layerStatesArray.sort((e,t)=>e.zIndex-t.zIndex);t.some(e=>e.layer instanceof Tn&&e.layer.getDeclutter())&&(e.declutter={});let n=e.viewState;this.children_.length=0;let r=[],i=null;for(let a=0,o=t.length;a<o;++a){let o=t[a];e.layerIndex=a;let s=o.layer,c=s.getSourceState();if(!on(o,n)||c!=`ready`&&c!=`undefined`){s.unrender();continue}let l=s.render(e,i);l&&(l!==i&&(this.children_.push(l),i=l),r.push(o))}this.declutter(e,r),ge(this.element_,this.children_);let a=this.getMap().getTargetElement();if(de(a)){let e=a.getContext(`2d`);for(let t of this.children_){let n=t.firstElementChild||t,r=t.style.backgroundColor;if(r&&(!de(n)||n.width>0)&&(e.fillStyle=r,e.fillRect(0,0,a.width,a.height)),de(n)&&n.width>0){let r=t.style.opacity||n.style.opacity;e.globalAlpha=r===``?1:Number(r);let i=n.style.transform;if(i)e.setTransform(...In(i));else{let t=parseFloat(n.style.width)/n.width,r=parseFloat(n.style.height)/n.height;e.setTransform(t,0,0,r,0,0)}e.drawImage(n,0,0)}}e.globalAlpha=1,e.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(Yt.POSTCOMPOSE,e),this.renderedVisible_||=(this.element_.style.display=``,!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let n=t.length-1;n>=0;--n){let r=t[n],i=r.layer;i.getDeclutter()&&i.renderDeclutter(e,r)}t.forEach(t=>t.layer.renderDeferred(e))}}};function ja(e){if(e instanceof rn){e.setMapInternal(null);return}e instanceof Ei&&e.getLayers().forEach(ja)}function Ma(e,t){if(e instanceof rn){e.setMapInternal(t);return}if(e instanceof Ei){let n=e.getLayers().getArray();for(let e=0,r=n.length;e<r;++e)Ma(n[e],t)}}var Na=class extends fe{constructor(e){super(),e||={},this.on,this.once,this.un;let t=Pa(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading===void 0?16:e.maxTilesLoading,this.pixelRatio_=e.pixelRatio===void 0?Ue:e.pixelRatio,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=An(),this.pixelToCoordinateTransform_=An(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,F||(this.viewport_=document.createElement(`div`),this.viewport_.className=`ol-viewport`+(`ontouchstart`in window?` ol-touch`:``),this.viewport_.style.position=`relative`,this.viewport_.style.overflow=`hidden`,this.viewport_.style.width=`100%`,this.viewport_.style.height=`100%`,this.overlayContainer_=document.createElement(`div`),this.overlayContainer_.style.position=`absolute`,this.overlayContainer_.style.zIndex=`0`,this.overlayContainer_.style.width=`100%`,this.overlayContainer_.style.height=`100%`,this.overlayContainer_.style.pointerEvents=`none`,this.overlayContainer_.className=`ol-overlaycontainer`,this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement(`div`),this.overlayContainerStopEvent_.style.position=`absolute`,this.overlayContainerStopEvent_.style.zIndex=`0`,this.overlayContainerStopEvent_.style.width=`100%`,this.overlayContainerStopEvent_.style.height=`100%`,this.overlayContainerStopEvent_.style.pointerEvents=`none`,this.overlayContainerStopEvent_.className=`ol-overlaycontainer-stopevent`,this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,F||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=t.controls||(F?new q:ji()),this.interactions=t.interactions||(F?new q:Ta({onFocusOnly:!0})),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ci(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener($.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener($.VIEW,this.handleViewChanged_),this.addChangeListener($.SIZE,this.handleSizeChanged_),this.addChangeListener($.TARGET,this.handleTargetChanged_),this.setProperties(t.values);let n=this;e.view&&!(e.view instanceof gn)&&e.view.then(function(e){n.setView(new gn(e))}),this.controls.addEventListener(W.ADD,e=>{e.element.setMap(this)}),this.controls.addEventListener(W.REMOVE,e=>{e.element.setMap(null)}),this.interactions.addEventListener(W.ADD,e=>{e.element.setMap(this)}),this.interactions.addEventListener(W.REMOVE,e=>{e.element.setMap(null)}),this.overlays_.addEventListener(W.ADD,e=>{this.addOverlayInternal_(e.element)}),this.overlays_.addEventListener(W.REMOVE,e=>{let t=e.element.getId();t!==void 0&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)}),this.controls.forEach(e=>{e.setMap(this)}),this.interactions.forEach(e=>{e.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){Ma(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){let t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;let r=this.getCoordinateFromPixelInternal(e);n=n===void 0?{}:n;let i=n.hitTolerance===void 0?0:n.hitTolerance,a=n.layerFilter===void 0?Be:n.layerFilter,o=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,i,o,t,null,a,null)}getFeaturesAtPixel(e,t){let n=[];return this.forEachFeatureAtPixel(e,function(e){n.push(e)},t),n}getAllLayers(){let e=[];function t(n){n.forEach(function(n){n instanceof Ei?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;let n=this.getCoordinateFromPixelInternal(e);t=t===void 0?{}:t;let r=t.layerFilter===void 0?Be:t.layerFilter,i=t.hitTolerance===void 0?0:t.hitTolerance,a=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,i,a,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){let t=this.viewport_.getBoundingClientRect(),n=this.getSize(),r=t.width/n[0],i=t.height/n[1],a=`changedTouches`in e?e.changedTouches[0]:e;return[(a.clientX-t.left)/r,(a.clientY-t.top)/i]}getTarget(){return this.get($.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Ft(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){let t=this.frameState_;return t?cn(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){let t=this.overlayIdIndex_[e.toString()];return t===void 0?null:t}getInteractions(){return this.interactions}getLayerGroup(){return this.get($.LAYERGROUP)}setLayers(e){let t=this.getLayerGroup();if(e instanceof q){t.setLayers(e);return}let n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){let n=e[t];if(!n.visible)continue;let r=n.layer.getRenderer();if(r&&!r.ready)return!0;let i=n.layer.getSource();if(i&&i.loading)return!0}return!1}getPixelFromCoordinate(e){let t=Mn(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){let t=this.frameState_;return t?cn(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get($.SIZE)}getView(){return this.get($.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,r){return li(this.frameState_,e,t,n,r)}handleBrowserEvent(e,t){t||=e.type;let n=new ha(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;let t=e.originalEvent,n=t.type;if(n===Mi.POINTERDOWN||n===_.WHEEL||n===_.KEYDOWN){let e=this.getOwnerDocument(),n=this.viewport_.getRootNode?this.viewport_.getRootNode():e,r=t.target,i=n instanceof ShadowRoot?n.host===r?n.host.ownerDocument:n:n===e?e.documentElement:n;if(this.overlayContainerStopEvent_.contains(r)||!i.contains(r))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){let t=this.getInteractions().getArray().slice();for(let n=t.length-1;n>=0;n--){let r=t[n];if(!(r.getMap()!==this||!r.getActive()||!this.getTargetElement())&&(!r.handleEvent(e)||e.propagationStopped))break}}}handlePostRender(){let e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){let t=e.viewHints;if(t[Pn.ANIMATING]||t[Pn.INTERACTING]){let t=Date.now()-e.time>8;n=t?0:8,r=t?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(Yt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Yt.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ma(Bn.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ma(Bn.LOADSTART,this,e))));let n=this.postRenderFunctions_;if(e)for(let t=0,r=n.length;t<r;++t)n[t](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)P(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(_.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(_.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!de(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);let e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}let e=this.getTarget(),t=typeof e==`string`?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&=(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),null),this.animationDelayKey_&&=(cancelAnimationFrame(this.animationDelayKey_),void 0);else{if(de(t)||t.appendChild(this.viewport_),this.renderer_||=new Aa(this),!de(t)){for(let e in this.mapBrowserEventHandler_=new Ea(this,this.moveTolerance_),Q)this.mapBrowserEventHandler_.addEventListener(Q[e],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(_.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(_.WHEEL,this.boundHandleBrowserEvent_,T?{passive:!1}:!1);let e;if(this.keyboardEventTarget_)e=this.keyboardEventTarget_;else{let n=t.getRootNode();e=n instanceof ShadowRoot?n.host:t}if(this.targetChangeHandlerKeys_=[j(e,_.KEYDOWN,this.handleBrowserEvent,this),j(e,_.KEYPRESS,this.handleBrowserEvent,this)],t instanceof HTMLElement){let e=t.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.observe(e.host),this.resizeObserver_?.observe(t)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&=(P(this.viewPropertyListenerKey_),null),this.viewChangeListenerKey_&&=(P(this.viewChangeListenerKey_),null);let e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=j(e,w.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=j(e,_.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&=(this.layerGroupPropertyListenerKeys_.forEach(P),null);let e=this.getLayerGroup();e&&(this.handleLayerAdd_(new wi(`addlayer`,e)),this.layerGroupPropertyListenerKeys_=[j(e,w.PROPERTYCHANGE,this.render,this),j(e,_.CHANGE,this.render,this),j(e,`addlayer`,this.handleLayerAdd_,this),j(e,`removelayer`,this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;let e=this.frameState_.layerStatesArray;for(let t=0,n=e.length;t<n;++t){let n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){ja(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){let t=this.getSize(),r=this.getView(),i=this.frameState_,a=null;if(t!==void 0&&It(t)&&r&&r.isDef()){let n=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),i=r.getState();if(a={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:O(i.center,i.resolution,i.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:i,viewHints:n,wantedTiles:{},mapId:N(this),renderTargets:{}},i.nextCenter&&i.nextResolution){let e=isNaN(i.nextRotation)?i.rotation:i.nextRotation;a.nextExtent=O(i.nextCenter,i.nextResolution,e,t)}}this.frameState_=a,this.renderer_.renderFrame(a),a&&(a.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,a.postRenderFunctions),i&&(!this.previousExtent_||!se(this.previousExtent_)&&!n(a.extent,this.previousExtent_))&&(this.dispatchEvent(new ma(Bn.MOVESTART,this,i)),this.previousExtent_=g(this.previousExtent_)),this.previousExtent_&&!a.viewHints[Pn.ANIMATING]&&!a.viewHints[Pn.INTERACTING]&&!n(a.extent,this.previousExtent_)&&(this.dispatchEvent(new ma(Bn.MOVEEND,this,a)),Ce(a.extent,this.previousExtent_))),this.dispatchEvent(new ma(Bn.POSTRENDER,this,a)),this.renderComplete_=(this.hasListener(Bn.LOADSTART)||this.hasListener(Bn.LOADEND)||this.hasListener(Yt.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0)}setLayerGroup(e){let t=this.getLayerGroup();t&&this.handleLayerRemove_(new wi(`removelayer`,t)),this.set($.LAYERGROUP,e)}setSize(e){this.set($.SIZE,e)}setTarget(e){this.set($.TARGET,e)}setView(e){if(!e||e instanceof gn){this.set($.VIEW,e);return}this.set($.VIEW,new gn);let t=this;e.then(function(e){t.setView(new gn(e))})}updateSize(){let e=this.getTargetElement(),t;if(e){let n,r;if(de(e))n=e.width,r=e.height;else{let t=getComputedStyle(e);n=e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),r=e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)}!isNaN(n)&&!isNaN(r)&&(t=[Math.max(0,n),Math.max(0,r)],!It(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Sn(`No map visible because the map container's width or height are 0.`))}let n=this.getSize();t&&(!n||!Se(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){let t=this.getView();t&&t.setViewportSize(e)}};function Pa(e){let t=null;e.keyboardEventTarget!==void 0&&(t=typeof e.keyboardEventTarget==`string`?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);let n={},r=e.layers&&typeof e.layers.getLayers==`function`?e.layers:new Ei({layers:e.layers});n[$.LAYERGROUP]=r,n[$.TARGET]=e.target,n[$.VIEW]=e.view instanceof gn?e.view:new gn;let i;e.controls!==void 0&&(Array.isArray(e.controls)?i=new q(e.controls.slice()):(Y(typeof e.controls.getArray==`function`,"Expected `controls` to be an array or an `ol/Collection.js`"),i=e.controls));let a;e.interactions!==void 0&&(Array.isArray(e.interactions)?a=new q(e.interactions.slice()):(Y(typeof e.interactions.getArray==`function`,"Expected `interactions` to be an array or an `ol/Collection.js`"),a=e.interactions));let o;return e.overlays===void 0?o=new q:Array.isArray(e.overlays)?o=new q(e.overlays.slice()):(Y(typeof e.overlays.getArray==`function`,"Expected `overlays` to be an array or an `ol/Collection.js`"),o=e.overlays),{controls:i,interactions:a,keyboardEventTarget:t,overlays:o,values:n}}var Fa=Na;const Ia=(e,t)=>{typeof t==`object`&&(t=JSON.stringify(t)),window.localStorage.setItem(e,t)},La=e=>{let t=window.localStorage.getItem(e);try{return JSON.parse(t)}catch{return t}},Ra=ht(`tk`,{state:()=>({tk:La(`tianditu-tk`)||`e1f2618711e8858b50bb0a1d4a715fa9`}),actions:{updateTk(e){this.tk=e,Ia(`tianditu-tk`,e)}}});var za=class{#e=`https://t{0-7}.tianditu.gov.cn/`;#t=Ra();#n={vec:[`vec`,`cva`],img:[`img`,`cia`]};get tk(){return this.#t.tk}createTileLayerGroup(e,t){return new Ei({layers:this.#n[e].map(e=>this.createTileLayer(e)),visible:t,properties:{name:e+`-group`}})}createTileLayer(e){return new gi({source:this.createXYZSource(e),properties:{name:e}})}createXYZSource(e){let t=new ni({url:this.#e+e+`_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=`+e+`&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=`+this.tk,tileGrid:Ba(G(`EPSG:3857`))});return t.once(`tileloaderror`,()=>{Jt.error({message:``,duration:3e3})}),t}};function Ba(e){let t=e.getExtent(),n=me(t),r=M(t),i=Array(18),a=Array(18);for(let e=0;e<18;++e)i[e]=r/(256*2**e),a[e]=e;return new hr({origin:n,resolutions:i,matrixIds:a})}var Va={class:`graticule-switch`},Ha=ft({__name:`index`,props:{defaultTdtLyrType:{type:String,default:`vec`}},emits:[`mapCreated`,`mapClick`],setup(e,{emit:t}){let n,r,i,a,o,s=it(),c=null,l=null,u=it(null),d=[73.62,16.7,134.77,53.56],f=t,p=e,m=it(p.defaultTdtLyrType),h=[{label:``,value:`vec`},{label:``,value:`img`}],g=it(!1),_=new Ci({strokeStyle:new Qt({color:`rgba(255,120,0,0.9)`,width:2,lineDash:[.5,4]}),showLabels:!0,visible:g.value,lonLabelPosition:.05}),v=it(null);Ze(async()=>{i=new za,y(),b()}),qe(()=>{ye(c),ye(l),c=null,l=null,n=null});function y(){a=i.createTileLayerGroup(`vec`,p.defaultTdtLyrType===`vec`),o=i.createTileLayerGroup(`img`,p.defaultTdtLyrType===`img`),r=new Oi({attributions:`<span> & NavInfoGS20251508</span>`});let e=ji({attribution:!1,rotate:!1,zoom:!1}).extend([r,new zi,new Fi({target:v.value,coordinateFormat:e=>(u.value||=e,Dt(6)(e))})]),t=new gn({center:[(d[0]+d[2])/2,(d[1]+d[3])/2],zoom:3,maxZoom:28,projection:`EPSG:4326`}),c=new zn({source:new $t({wrapX:!1}),style:new un({fill:new vn({color:`rgba(0, 255, 255, 0.1)`}),stroke:new Qt({color:`rgb(0, 255, 255)`,width:2})}),properties:{name:`highlight`},zIndex:100});n=new Fa({target:s.value,layers:[a,o,c,_],view:t,controls:e,interactions:Ta({doubleClickZoom:!1})}),f(`mapCreated`,n)}function b(){x(),l=n.on(`change:size`,x),c=n.on(`singleclick`,S)}function x(){let e=n.getSize()[0]<600;r.setCollapsible(e),r.setCollapsed(e)}function S(e){f(`mapClick`,e)}function C(e){e===`vec`?(a.setVisible(!0),o.setVisible(!1)):(a.setVisible(!1),o.setVisible(!0))}function w(e){e?_.setVisible(!0):_.setVisible(!1)}return(e,t)=>{let n=tr,r=Yn;return V(),L(`div`,{class:`map`,ref_key:`mapDivRef`,ref:s},[_t(n,{class:`map-switch`,modelValue:B(m),"onUpdate:modelValue":t[0]||=e=>Ye(m)?m.value=e:null,options:h,onChange:C},null,8,[`modelValue`]),U(`div`,Va,[t[2]||=U(`div`,null,``,-1),_t(r,{size:`small`,width:`40px`,modelValue:B(g),"onUpdate:modelValue":t[1]||=e=>Ye(g)?g.value=e:null,"inline-prompt":``,"active-text":``,"inactive-text":``,onChange:w},null,8,[`modelValue`])]),nt(U(`div`,{class:`realtime-coordinates`,ref_key:`realtimeCoordinatesRef`,ref:v},`  `,512),[[mt,B(u)]])],512)}}},[[`__scopeId`,`data-v-fb63ce0d`]]);export{ni as i,Ra as n,Ei as r,Ha as t};