import{$ as e,$t as t,A as n,B as r,C as i,Ct as a,E as o,En as s,Et as c,F as l,Ft as u,G as d,Gt as f,Ht as p,I as m,It as h,J as g,Jt as _,K as v,Lt as y,Mt as b,O as x,P as S,Pt as C,Q as w,Qt as T,Rt as ee,S as te,Sn as E,St as D,T as O,Tt as ne,U as k,V as re,W as ie,X as ae,Y as oe,Z as se,Zt as ce,_ as le,_t as ue,a as de,b as fe,c as pe,d as me,dt as A,en as he,et as ge,fn as _e,g as ve,gt as j,h as ye,it as be,j as xe,jt as Se,kt as Ce,l as we,lt as Te,m as Ee,mn as De,mt as M,n as Oe,nn as ke,nt as Ae,ot as je,pt as Me,q as Ne,r as Pe,rn as Fe,sn as Ie,st as Le,t as Re,tn as ze,tt as N,ut as Be,v as Ve,vt as He,w as Ue,x as We,xt as Ge,yt as Ke,z as qe}from"./css-kr_0w2QN.js";import{C as Je,E as Ye,H as Xe,M as Ze,P as Qe,V as $e,W as et,Y as tt,Z as nt,_ as rt,c as it,d as P,dt as at,f as F,ft as ot,g as st,h as ct,ht as lt,j as ut,k as I,l as dt,m as L,mt as ft,nt as R,o as pt,p as z,pt as B,q as mt,s as ht,t as gt,u as V,ut as _t,w as vt,z as yt}from"./index-B1DvdBcA.js";import{$t as bt,A as xt,At as St,B as Ct,Bt as wt,C as Tt,Ct as Et,D as Dt,Dt as Ot,E as kt,Et as At,Ft as jt,Gt as Mt,Ht as Nt,I as Pt,It as Ft,Jt as It,Kt as Lt,Lt as Rt,M as H,Mt as zt,Nt as Bt,O as Vt,Ot as U,P as Ht,Pt as Ut,Qt as Wt,Rt as Gt,S as W,St as Kt,T as qt,Tt as Jt,Ut as G,Vt as Yt,Wt as Xt,Xt as Zt,Yt as Qt,Zt as K,_ as $t,_n as en,a as tn,an as nn,b as rn,bt as an,c as on,d as sn,en as cn,f as ln,fn as un,g as dn,gn as fn,h as pn,hn as mn,i as hn,j as gn,jt as _n,k as vn,kt as yn,l as bn,m as q,n as xn,o as Sn,p as Cn,r as wn,s as Tn,t as En,tn as Dn,u as On,v as kn,vn as An,vt as jn,w as Mn,wt as Nn,x as J,xt as Pn,y as Fn,yt as In,zt as Ln}from"./Vector-CpOEPyP7.js";import{t as Rn}from"./LineString-BaUch8ON.js";import{t as Y}from"./MapEventType-V8bC502L.js";var zn=t({modelValue:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:void 0},loading:Boolean,size:{type:String,validator:e=>[``,...T].includes(e)},width:{type:[String,Number],default:``},inlinePrompt:Boolean,inactiveActionIcon:{type:nn},activeActionIcon:{type:nn},activeIcon:{type:nn},inactiveIcon:{type:nn},activeText:{type:String,default:``},inactiveText:{type:String,default:``},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:``},validateEvent:{type:Boolean,default:!0},beforeChange:{type:he(Function)},id:String,tabindex:{type:[String,Number]},...Dn([`ariaLabel`])}),Bn={[An]:e=>_e(e)||ot(e)||De(e),[fn]:e=>_e(e)||ot(e)||De(e),[en]:e=>_e(e)||ot(e)||De(e)},Vn=[`id`,`aria-checked`,`aria-disabled`,`aria-label`,`name`,`true-value`,`false-value`,`disabled`,`tabindex`],Hn=[`aria-hidden`],Un={key:1},Wn={key:1},Gn=[`aria-hidden`],Kn=`ElSwitch`,qn=f(_(rt({name:Kn,__name:`switch`,props:zn,emits:Bn,setup(e,{expose:t,emit:n}){let r=e,i=n,{formItem:a}=Wt(),o=ee(),s=E(`switch`),{inputId:c}=bt(r,{formItemContext:a}),l=y(V(()=>{if(r.loading)return!0})),u=tt(r.modelValue!==!1),d=nt(),f=V(()=>[s.b(),s.m(o.value),s.is(`disabled`,l.value),s.is(`checked`,v.value)]),m=V(()=>[s.e(`label`),s.em(`label`,`left`),s.is(`active`,!v.value)]),h=V(()=>[s.e(`label`),s.em(`label`,`right`),s.is(`active`,v.value)]),g=V(()=>({width:p(r.width)}));yt(()=>r.modelValue,()=>{u.value=!0});let _=V(()=>u.value?r.modelValue:!1),v=V(()=>_.value===r.activeValue);[r.activeValue,r.inactiveValue].includes(_.value)||(i(An,r.inactiveValue),i(fn,r.inactiveValue),i(en,r.inactiveValue)),yt(v,e=>{var t;d.value.checked=e,r.validateEvent&&((t=a?.validate)==null||t.call(a,`change`).catch(e=>ze(e)))});let b=()=>{let e=v.value?r.inactiveValue:r.activeValue;i(An,e),i(fn,e),i(en,e),Je(()=>{d.value.checked=v.value})},x=()=>{if(l.value)return;let{beforeChange:e}=r;if(!e){b();return}let t=e();[at(t),_e(t)].includes(!0)||ke(Kn,"beforeChange must return type `Promise<boolean>` or `boolean`"),at(t)?t.then(e=>{e&&b()}).catch(e=>{ze(Kn,`some error occurred: ${e}`)}):t&&b()};return Ye(()=>{d.value.checked=v.value}),t({focus:()=>{var e,t;(t=(e=d.value)?.focus)==null||t.call(e)},checked:v}),(e,t)=>(I(),L(`div`,{class:B(f.value),onClick:it(x,[`prevent`])},[P(`input`,{id:R(c),ref_key:`input`,ref:d,class:B(R(s).e(`input`)),type:`checkbox`,role:`switch`,"aria-checked":v.value,"aria-disabled":R(l),"aria-label":e.ariaLabel,name:e.name,"true-value":e.activeValue,"false-value":e.inactiveValue,disabled:R(l),tabindex:e.tabindex,onChange:b,onKeydown:ht(x,[`enter`])},null,42,Vn),!e.inlinePrompt&&(e.inactiveIcon||e.inactiveText||e.$slots.inactive)?(I(),L(`span`,{key:0,class:B(m.value)},[Ze(e.$slots,`inactive`,{},()=>[e.inactiveIcon?(I(),F(R(mn),{key:0},{default:$e(()=>[(I(),F(Qe(e.inactiveIcon)))]),_:1})):z(`v-if`,!0),!e.inactiveIcon&&e.inactiveText?(I(),L(`span`,{key:1,"aria-hidden":v.value},lt(e.inactiveText),9,Hn)):z(`v-if`,!0)])],2)):z(`v-if`,!0),P(`span`,{class:B(R(s).e(`core`)),style:ft(g.value)},[e.inlinePrompt?(I(),L(`div`,{key:0,class:B(R(s).e(`inner`))},[v.value?(I(),L(`div`,{key:1,class:B(R(s).e(`inner-wrapper`))},[Ze(e.$slots,`active`,{},()=>[e.activeIcon?(I(),F(R(mn),{key:0},{default:$e(()=>[(I(),F(Qe(e.activeIcon)))]),_:1})):z(`v-if`,!0),!e.activeIcon&&e.activeText?(I(),L(`span`,Wn,lt(e.activeText),1)):z(`v-if`,!0)])],2)):(I(),L(`div`,{key:0,class:B(R(s).e(`inner-wrapper`))},[Ze(e.$slots,`inactive`,{},()=>[e.inactiveIcon?(I(),F(R(mn),{key:0},{default:$e(()=>[(I(),F(Qe(e.inactiveIcon)))]),_:1})):z(`v-if`,!0),!e.inactiveIcon&&e.inactiveText?(I(),L(`span`,Un,lt(e.inactiveText),1)):z(`v-if`,!0)])],2))],2)):z(`v-if`,!0),P(`div`,{class:B(R(s).e(`action`))},[e.loading?(I(),F(R(mn),{key:0,class:B(R(s).is(`loading`))},{default:$e(()=>[st(R(un))]),_:1},8,[`class`])):v.value?Ze(e.$slots,`active-action`,{key:1},()=>[e.activeActionIcon?(I(),F(R(mn),{key:0},{default:$e(()=>[(I(),F(Qe(e.activeActionIcon)))]),_:1})):z(`v-if`,!0)]):v.value?z(`v-if`,!0):Ze(e.$slots,`inactive-action`,{key:2},()=>[e.inactiveActionIcon?(I(),F(R(mn),{key:0},{default:$e(()=>[(I(),F(Qe(e.inactiveActionIcon)))]),_:1})):z(`v-if`,!0)])],2)],6),!e.inlinePrompt&&(e.activeIcon||e.activeText||e.$slots.active)?(I(),L(`span`,{key:1,class:B(h.value)},[Ze(e.$slots,`active`,{},()=>[e.activeIcon?(I(),F(R(mn),{key:0},{default:$e(()=>[(I(),F(Qe(e.activeIcon)))]),_:1})):z(`v-if`,!0),!e.activeIcon&&e.activeText?(I(),L(`span`,{key:1,"aria-hidden":!v.value},lt(e.activeText),9,Gn)):z(`v-if`,!0)])],2)):z(`v-if`,!0)],2))}}),[[`__file`,`/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue`]])),Jn={label:`label`,value:`value`,disabled:`disabled`},Yn=t({direction:{type:he(String),default:`horizontal`},options:{type:he(Array),default:()=>[]},modelValue:{type:[String,Number,Boolean],default:void 0},props:{type:he(Object),default:()=>Jn},block:Boolean,size:ce,disabled:{type:Boolean,default:void 0},validateEvent:{type:Boolean,default:!0},id:String,name:String,...Dn([`ariaLabel`])}),Xn={[An]:e=>ot(e)||De(e)||_e(e),[fn]:e=>ot(e)||De(e)||_e(e)},Zn=[`id`,`aria-label`,`aria-labelledby`],Qn=[`name`,`disabled`,`checked`,`onChange`],$n=f(_(rt({name:`ElSegmented`,__name:`segmented`,props:Yn,emits:Xn,setup(e,{emit:t}){let n=e,r=t,i=E(`segmented`),a=cn(),o=ee(),s=y(),{formItem:c}=Wt(),{inputId:l,isLabeledByFormItem:u}=bt(n,{formItemContext:c}),d=tt(null),f=Fe(),p=mt({isInit:!1,width:0,height:0,translateX:0,translateY:0,focusVisible:!1}),m=(e,t)=>{let i=_(t);r(An,i),r(fn,i),e.target.checked=i===n.modelValue},h=V(()=>({...Jn,...n.props})),g=e=>e,_=e=>_t(e)?e[h.value.value]:e,v=e=>_t(e)?e[h.value.label]:e,b=e=>!!(s.value||_t(e)&&e[h.value.disabled]),x=e=>n.modelValue===_(e),S=e=>n.options.find(t=>_(t)===e),C=e=>[i.e(`item`),i.is(`selected`,x(e)),i.is(`disabled`,b(e))],w=()=>{if(!d.value)return;let e=d.value.querySelector(`.is-selected`),t=d.value.querySelector(`.is-selected input`);if(!e||!t){p.width=0,p.height=0,p.translateX=0,p.translateY=0,p.focusVisible=!1;return}p.isInit=!0,n.direction===`vertical`?(p.height=e.offsetHeight,p.translateY=e.offsetTop):(p.width=e.offsetWidth,p.translateX=e.offsetLeft);try{p.focusVisible=t.matches(`:focus-visible`)}catch{}},T=V(()=>[i.b(),i.m(o.value),i.is(`block`,n.block)]),te=V(()=>({width:n.direction===`vertical`?`100%`:`${p.width}px`,height:n.direction===`vertical`?`${p.height}px`:`100%`,transform:n.direction===`vertical`?`translateY(${p.translateY}px)`:`translateX(${p.translateX}px)`,display:p.isInit?`block`:`none`})),D=V(()=>[i.e(`item-selected`),i.is(`disabled`,b(S(n.modelValue))),i.is(`focus-visible`,p.focusVisible)]),O=V(()=>n.name||a.value);return Ie(d,w),yt(f,w),yt(()=>n.modelValue,()=>{var e;w(),n.validateEvent&&((e=c?.validate)==null||e.call(c,`change`).catch(e=>ze(e)))},{flush:`post`}),(e,t)=>e.options.length?(I(),L(`div`,{key:0,id:R(l),ref_key:`segmentedRef`,ref:d,class:B(T.value),role:`radiogroup`,"aria-label":R(u)?void 0:e.ariaLabel||`segmented`,"aria-labelledby":R(u)?R(c).labelId:void 0},[P(`div`,{class:B([R(i).e(`group`),R(i).m(e.direction)])},[P(`div`,{style:ft(te.value),class:B(D.value)},null,6),(I(!0),L(dt,null,ut(e.options,(t,n)=>(I(),L(`label`,{key:n,class:B(C(t))},[P(`input`,{class:B(R(i).e(`item-input`)),type:`radio`,name:O.value,disabled:b(t),checked:x(t),onChange:e=>m(e,t)},null,42,Qn),P(`div`,{class:B(R(i).e(`item-label`))},[Ze(e.$slots,`default`,{item:g(t)},()=>[ct(lt(v(t)),1)])],2)],2))),128))],2)],10,Zn)):z(`v-if`,!0)}}),[[`__file`,`/home/runner/work/element-plus/element-plus/packages/components/segmented/src/segmented.vue`]])),er=class{constructor(e){this.highWaterMark=e===void 0?2048:e,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){let e=this.pop();e instanceof C&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){let n=this.entries_[e];return K(n!==void 0,`Tried to get a value for a key that does not exist in the cache`),n===this.newest_?n.value_:(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n,n.value_)}remove(e){let t=this.entries_[e];return K(t!==void 0,`Tried to get a value for a key that does not exist in the cache`),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){let e=Array(this.count_),t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){let e=Array(this.count_),t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){let e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){K(!(e in this.entries_),`Tried to set a value for a key that is used already`);let n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}};function tr(e,t,n,r){return r===void 0?[e,t,n]:(r[0]=e,r[1]=t,r[2]=n,r)}function nr(e,t,n){return e+`/`+t+`/`+n}function rr(e,t,n,r,i){return`${A(e)},${t},${nr(n,r,i)}`}function ir(e){return ar(e[0],e[1],e[2])}function ar(e,t,n){return(t<<e)+n}function or(e,t){let n=e[0],r=e[1],i=e[2];if(t.getMinZoom()>n||n>t.getMaxZoom())return!1;let a=t.getFullTileRange(n);return a?a.containsXY(r,i):!0}var sr=class{constructor(e,t,n,r){this.minX=e,this.maxX=t,this.minY=n,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}};function cr(e,t,n,r,i){return i===void 0?new sr(e,t,n,r):(i.minX=e,i.maxX=t,i.minY=n,i.maxY=r,i)}var lr=sr,ur=[0,0,0],X=5,dr=class{constructor(t){this.minZoom=t.minZoom===void 0?0:t.minZoom,this.resolutions_=t.resolutions,K(Se(this.resolutions_,(e,t)=>t-e,!0),"`resolutions` must be sorted in descending order");let n;if(!t.origins){for(let e=0,t=this.resolutions_.length-1;e<t;++e)if(!n)n=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==n){n=void 0;break}}this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin===void 0?null:t.origin,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,K(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let r=t.extent;r!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=e(r)),K(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,K(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize===void 0?this.tileSizes_?null:256:t.tileSize,K(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=r===void 0?null:r,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes===void 0?r&&this.calculateTileRanges_(r):this.fullTileRanges_=t.sizes.map((e,t)=>{let n=new lr(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(r){let e=this.getTileRangeForExtentAndZ(r,t);n.minX=Math.max(e.minX,n.minX),n.maxX=Math.min(e.maxX,n.maxX),n.minY=Math.max(e.minY,n.minY),n.maxY=Math.min(e.maxY,n.maxY)}return n})}forEachTileCoord(e,t,n){let r=this.getTileRangeForExtentAndZ(e,t);for(let e=r.minX,i=r.maxX;e<=i;++e)for(let i=r.minY,a=r.maxY;i<=a;++i)n([t,e,i])}forEachTileCoordParentTileRange(e,t,n,r){let i,a,o,s=null,c=e[0]-1;for(this.zoomFactor_===2?(a=e[1],o=e[2]):s=this.getTileCoordExtent(e,r);c>=this.minZoom;){if(a!==void 0&&o!==void 0?(a=Math.floor(a/2),o=Math.floor(o/2),i=cr(a,a,o,o,n)):i=this.getTileRangeForExtentAndZ(s,c,n),t(c,i))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){let n=e[1]*2,r=e[2]*2;return cr(n,n+1,r,r+1,t)}let r=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;let r=e[0],i=e[1],a=e[2];if(t===r)return cr(i,a,i,a,n);if(this.zoomFactor_){let e=this.zoomFactor_**+(t-r),o=Math.floor(i*e),s=Math.floor(a*e);return t<r?cr(o,o,s,s,n):cr(o,Math.floor(e*(i+1))-1,s,Math.floor(e*(a+1))-1,n)}let o=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,ur);let r=ur[1],i=ur[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,ur);let a=ur[1],o=ur[2];return cr(r,a,i,o,n)}getTileCoordCenter(e){let t=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=H(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*n,t[1]-(e[2]+.5)*r[1]*n]}getTileCoordExtent(e,t){let n=this.getOrigin(e[0]),r=this.getResolution(e[0]),i=H(this.getTileSize(e[0]),this.tmpSize_),a=n[0]+e[1]*i[0]*r,o=n[1]-(e[2]+1)*i[1]*r;return l(a,o,a+i[0]*r,o+i[1]*r,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,r,i){let a=this.getZForResolution(n),o=n/this.getResolution(a),s=this.getOrigin(a),c=H(this.getTileSize(a),this.tmpSize_),l=o*(e-s[0])/n/c[0],u=o*(s[1]-t)/n/c[1];return r?(l=Nt(l,X)-1,u=Nt(u,X)-1):(l=Xt(l,X),u=Xt(u,X)),tr(a,l,u,i)}getTileCoordForXYAndZ_(e,t,n,r,i){let a=this.getOrigin(n),o=this.getResolution(n),s=H(this.getTileSize(n),this.tmpSize_),c=(e-a[0])/o/s[0],l=(a[1]-t)/o/s[1];return r?(c=Nt(c,X)-1,l=Nt(l,X)-1):(c=Xt(c,X),l=Xt(l,X)),tr(n,c,l,i)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){return G(b(this.resolutions_,e,t||0),this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Ct(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){let t=this.resolutions_.length,n=Array(t);for(let r=this.minZoom;r<t;++r)n[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=n}},fr=class extends dr{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}};function pr(e){let t=e.getDefaultTileGrid();return t||(t=vr(e),e.setDefaultTileGrid(t)),t}function mr(e,t,r){let i=t[0],a=e.getTileCoordCenter(t),o=yr(r);if(!n(o,a)){let t=N(o),n=Math.ceil((o[0]-a[0])/t);return a[0]+=t*n,e.getTileCoordForCoordAndZ(a,i)}return t}function hr(e,t,n,r){r=r===void 0?`top-left`:r;let i=_r(e,t,n);return new dr({extent:e,origin:g(e,r),resolutions:i,tileSize:n})}function gr(e){let t=e||{},n=t.extent||U(`EPSG:3857`).getExtent();return new dr({extent:n,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:_r(n,t.maxZoom,t.tileSize,t.maxResolution)})}function _r(e,t,n,r){t=t===void 0?42:t,n=H(n===void 0?256:n);let i=ae(e),a=N(e);r=r>0?r:Math.max(a/n[0],i/n[1]);let o=t+1,s=Array(o);for(let e=0;e<o;++e)s[e]=r/2**e;return s}function vr(e,t,n,r){return hr(yr(e),t,n,r)}function yr(e){e=U(e);let t=e.getExtent();if(!t){let n=180*Ft.degrees/e.getMetersPerUnit();t=l(-n,-n,n,n)}return t}var br=/\{z\}/g,xr=/\{x\}/g,Sr=/\{y\}/g,Cr=/\{-y\}/g;function wr(e,t,n,r,i){return e.replace(br,t.toString()).replace(xr,n.toString()).replace(Sr,r.toString()).replace(Cr,function(){if(i===void 0)throw Error(`If the URL template has a {-y} placeholder, the grid extent must be known`);return(i-r).toString()})}function Tr(e){let t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){let r=n[1].charCodeAt(0),i=n[2].charCodeAt(0),a;for(a=r;a<=i;++a)t.push(e.replace(n[0],String.fromCharCode(a)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e),n){let r=parseInt(n[2],10);for(let i=parseInt(n[1],10);i<=r;i++)t.push(e.replace(n[0],i.toString()));return t}return t.push(e),t}function Er(e,t){return(function(n,r,i){if(!n)return;let a,o=n[0];if(t){let e=t.getFullTileRange(o);e&&(a=e.getHeight()-1)}return wr(e,o,n[1],n[2],a)})}function Dr(e,t){let n=e.length,r=Array(n);for(let i=0;i<n;++i)r[i]=Er(e[i],t);return Or(r)}function Or(e){return e.length===1?e[0]:(function(t,n,r){if(t)return e[Mt(ir(t),e.length)](t,n,r)})}var Z={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},kr=class extends ue{constructor(e,t,n){super(),n||={},this.tileCoord=e,this.state=t,this.key=``,this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(u.CHANGE)}release(){this.setState(Z.EMPTY)}getKey(){return this.key+`/`+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Z.EMPTY){if(this.state!==Z.ERROR&&this.state>e)throw Error(`Tile load sequence violation`);this.state=e,this.changed()}}load(){Be()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;let r=t-n+1e3/60;return r>=this.transition_?1:Mn(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}},Ar=class extends kr{constructor(e,t,n,r,a,o){super(e,t,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_,i?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,r!==null&&(this.image_.crossOrigin=r)),this.unlisten_=null,this.tileLoadFunction_=a}getImage(){return this.image_}setImage(e){this.image_=e,this.state=Z.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=Z.ERROR,this.unlistenImage_(),this.image_=jr(),this.changed()}handleImageLoad_(){if(i)this.state=Z.LOADED;else{let e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=Z.LOADED:this.state=Z.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==Z.ERROR&&(this.state=Z.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Z.IDLE&&(this.state=Z.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Dt(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&=(this.unlisten_(),null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};function jr(){let e=pe(1,1);return e.fillStyle=`rgba(0,0,0,0)`,e.fillRect(0,0,1,1),e.canvas}var Mr=Ar,Nr;const Pr=[];function Fr(e,t,n,r,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(r,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,r)+1,Math.max(n,i)),e.restore()}function Ir(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function Lr(){if(Nr===void 0){let e=pe(6,6,Pr);e.globalCompositeOperation=`lighter`,e.fillStyle=`rgba(210, 0, 0, 0.75)`,Fr(e,4,5,4,0),Fr(e,4,5,0,5);let t=e.getImageData(0,0,3,3).data;Nr=Ir(t,0)||Ir(t,4)||Ir(t,8),Ee(e),Pr.push(e.canvas)}return Nr}function Rr(e,t,r,i){let a=jt(r,t,e),o=yn(t,i,r),s=t.getMetersPerUnit();s!==void 0&&(o*=s);let c=e.getMetersPerUnit();c!==void 0&&(o/=c);let l=e.getExtent();if(!l||n(l,a)){let t=yn(e,o,a)/o;isFinite(t)&&t>0&&(o/=t)}return o}function zr(e,t,n,r){let i=Rr(e,t,Ne(n),r);return(!isFinite(i)||i<=0)&&k(n,function(n){return i=Rr(e,t,n,r),isFinite(i)&&i>0}),i}function Br(t,n,i,a,o,s,c,l,u,d,f,p,m,h){let g=pe(Math.round(i*t),Math.round(i*n),Pr);if(p||(g.imageSmoothingEnabled=!1),u.length===0)return g.canvas;g.scale(i,i);function _(e){return Math.round(e*i)/i}g.globalCompositeOperation=`lighter`;let v=S();u.forEach(function(e,t,n){r(v,e.extent)});let y,b=i/a,x=(p?1:1+2**-24)/b;if(!m||u.length!==1||d!==0){if(y=pe(Math.round(N(v)*b),Math.round(ae(v)*b),Pr),p||(y.imageSmoothingEnabled=!1),o&&h){let e=(o[0]-v[0])*b,t=-(o[3]-v[3])*b,n=N(o)*b,r=ae(o)*b;y.rect(e,t,n,r),y.clip()}u.forEach(function(e,t,n){if(e.image.width>0&&e.image.height>0){if(e.clipExtent){y.save();let t=(e.clipExtent[0]-v[0])*b,n=-(e.clipExtent[3]-v[3])*b,r=N(e.clipExtent)*b,i=ae(e.clipExtent)*b;y.rect(p?t:Math.round(t),p?n:Math.round(n),p?r:Math.round(t+r)-Math.round(t),p?i:Math.round(n+i)-Math.round(n)),y.clip()}let t=(e.extent[0]-v[0])*b,n=-(e.extent[3]-v[3])*b,r=N(e.extent)*b,i=ae(e.extent)*b;y.drawImage(e.image,d,d,e.image.width-2*d,e.image.height-2*d,p?t:Math.round(t),p?n:Math.round(n),p?r:Math.round(t+r)-Math.round(t),p?i:Math.round(n+i)-Math.round(n)),e.clipExtent&&y.restore()}})}let C=e(c);return l.getTriangles().forEach(function(e,t,n){let r=e.source,i=e.target,a=r[0][0],o=r[0][1],c=r[1][0],l=r[1][1],d=r[2][0],f=r[2][1],m=_((i[0][0]-C[0])/s),h=_(-(i[0][1]-C[1])/s),b=_((i[1][0]-C[0])/s),S=_(-(i[1][1]-C[1])/s),w=_((i[2][0]-C[0])/s),T=_(-(i[2][1]-C[1])/s),ee=a,te=o;a=0,o=0,c-=ee,l-=te,d-=ee,f-=te;let E=Lt([[c,l,0,0,b-m],[d,f,0,0,w-m],[0,0,c,l,S-h],[0,0,d,f,T-h]]);if(!E)return;if(g.save(),g.beginPath(),Lr()||!p){g.moveTo(b,S);let e=m-b,t=h-S;for(let n=0;n<4;n++)g.lineTo(b+_((n+1)*e/4),S+_(n*t/3)),n!=3&&g.lineTo(b+_((n+1)*e/4),S+_((n+1)*t/3));g.lineTo(w,T)}else g.moveTo(b,S),g.lineTo(m,h),g.lineTo(w,T);g.clip(),g.transform(E[0],E[2],E[1],E[3],m,h),g.translate(v[0]-ee,v[3]-te);let D;if(y)D=y.canvas,g.scale(x,-x);else{let e=u[0],t=e.extent;D=e.image,g.scale(N(t)/D.width,-ae(t)/D.height)}g.drawImage(D,0,0),g.restore()}),y&&(Ee(y),Pr.push(y.canvas)),f&&(g.save(),g.globalCompositeOperation=`source-over`,g.strokeStyle=`black`,g.lineWidth=1,l.getTriangles().forEach(function(e,t,n){let r=e.target,i=(r[0][0]-C[0])/s,a=-(r[0][1]-C[1])/s,o=(r[1][0]-C[0])/s,c=-(r[1][1]-C[1])/s,l=(r[2][0]-C[0])/s,u=-(r[2][1]-C[1])/s;g.beginPath(),g.moveTo(o,c),g.lineTo(i,a),g.lineTo(l,u),g.closePath(),g.stroke()}),g.restore()),g.canvas}var Vr=10,Hr=.25,Ur=class{constructor(t,n,r,i,a,o,s){this.sourceProj_=t,this.targetProj_=n;let c={},l=s?Nn(e=>jn(s,jt(e,this.targetProj_,this.sourceProj_))):St(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){let t=e[0]+`/`+e[1];return c[t]||(c[t]=l(e)),c[t]},this.maxSourceExtent_=i,this.errorThresholdSquared_=a*a,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&N(i)>=N(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?N(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?N(this.targetProj_.getExtent()):null;let u=e(r),f=ge(r),p=v(r),m=d(r),h=this.transformInv_(u),g=this.transformInv_(f),_=this.transformInv_(p),y=this.transformInv_(m),b=Vr+(o?Math.max(0,Math.ceil(Math.log2(ie(r)/(o*o*256*256)))):0);if(this.addQuad_(u,f,p,m,h,g,_,y,b),this.wrapsXInSource_){let e=1/0;this.triangles_.forEach(function(t,n,r){e=Math.min(e,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(t=>{if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){let n=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];n[0][0]-e>this.sourceWorldWidth_/2&&(n[0][0]-=this.sourceWorldWidth_),n[1][0]-e>this.sourceWorldWidth_/2&&(n[1][0]-=this.sourceWorldWidth_),n[2][0]-e>this.sourceWorldWidth_/2&&(n[2][0]-=this.sourceWorldWidth_);let r=Math.min(n[0][0],n[1][0],n[2][0]);Math.max(n[0][0],n[1][0],n[2][0])-r<this.sourceWorldWidth_/2&&(t.source=n)}})}c={}}addTriangle_(e,t,n,r,i,a){this.triangles_.push({source:[r,i,a],target:[e,t,n]})}addQuad_(e,t,n,r,i,a,s,c,l){let u=o([i,a,s,c]),d=this.sourceWorldWidth_?N(u)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&d>.5&&d<1,m=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(m=N(o([e,t,n,r]))/this.targetWorldWidth_>Hr||m),!p&&this.sourceProj_.isGlobal()&&d&&(m=d>Hr||m)),!m&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!Ae(u,this.maxSourceExtent_))return;let h=0;if(!m&&(!isFinite(i[0])||!isFinite(i[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(c[0])||!isFinite(c[1]))){if(l>0)m=!0;else if(h=(!isFinite(i[0])||!isFinite(i[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(s[0])||!isFinite(s[1])?2:0)+(!isFinite(c[0])||!isFinite(c[1])?1:0),h!=1&&h!=2&&h!=4&&h!=8)return}if(l>0){if(!m){let t=[(e[0]+n[0])/2,(e[1]+n[1])/2],r=this.transformInv_(t),a;a=p?(Mt(i[0],f)+Mt(s[0],f))/2-Mt(r[0],f):(i[0]+s[0])/2-r[0];let o=(i[1]+s[1])/2-r[1];m=a*a+o*o>this.errorThresholdSquared_}if(m){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){let o=[(t[0]+n[0])/2,(t[1]+n[1])/2],u=this.transformInv_(o),d=[(r[0]+e[0])/2,(r[1]+e[1])/2],f=this.transformInv_(d);this.addQuad_(e,t,o,d,i,a,u,f,l-1),this.addQuad_(d,o,n,r,f,u,s,c,l-1)}else{let o=[(e[0]+t[0])/2,(e[1]+t[1])/2],u=this.transformInv_(o),d=[(n[0]+r[0])/2,(n[1]+r[1])/2],f=this.transformInv_(d);this.addQuad_(e,o,d,r,i,u,f,c,l-1),this.addQuad_(o,t,n,d,u,a,s,f,l-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}h&11||this.addTriangle_(e,n,r,i,s,c),h&14||this.addTriangle_(e,n,t,i,s,a),h&&(h&13||this.addTriangle_(t,r,e,a,c,i),h&7||this.addTriangle_(t,r,n,a,c,s))}calculateSourceExtent(){let e=S();return this.triangles_.forEach(function(t,n,r){let i=t.source;re(e,i[0]),re(e,i[1]),re(e,i[2])}),e}getTriangles(){return this.triangles_}},Wr=class extends kr{constructor(e,t,n,r,i,a,o,s,c,l,u,d){super(i,Z.IDLE,d),this.renderEdges_=u===void 0?!1:u,this.pixelRatio_=o,this.gutter_=s,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=a||i,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;let f=r.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),m=this.sourceTileGrid_.getExtent(),h=p?se(f,p):f;if(ie(h)===0){this.state=Z.EMPTY;return}let g=e.getExtent();g&&(m=m?se(m,g):g);let _=r.getResolution(this.wrappedTileCoord_[0]),v=zr(e,n,h,_);if(!isFinite(v)||v<=0){this.state=Z.EMPTY;return}if(this.triangulation_=new Ur(e,n,h,m,v*(l===void 0?.5:l),_),this.triangulation_.getTriangles().length===0){this.state=Z.EMPTY;return}this.sourceZ_=t.getZForResolution(v);let y=this.triangulation_.calculateSourceExtent();if(m&&(e.canWrapX()?(y[1]=G(y[1],m[1],m[3]),y[3]=G(y[3],m[1],m[3])):y=se(y,m)),!ie(y))this.state=Z.EMPTY;else{let n=0,r=0;e.canWrapX()&&(n=N(g),r=Math.floor((y[0]-g[0])/n)),je(y.slice(),e,!0).forEach(e=>{let i=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=i.minX;e<=i.maxX;e++)for(let t=i.minY;t<=i.maxY;t++){let i=c(this.sourceZ_,e,t,o);if(i){let e=r*n;this.sourceTiles_.push({tile:i,offset:e})}}++r}),this.sourceTiles_.length===0&&(this.state=Z.EMPTY)}}getImage(){return this.canvas_}reproject_(){let e=[];if(this.sourceTiles_.forEach(t=>{let n=t.tile;if(n&&n.getState()==Z.LOADED){let r=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);r[0]+=t.offset,r[2]+=t.offset;let i=this.clipExtent_?.slice();i&&(i[0]+=t.offset,i[2]+=t.offset),e.push({extent:r,clipExtent:i,image:n.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=Z.ERROR;else{let t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n==`number`?n:n[0],i=typeof n==`number`?n:n[1],a=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Br(r,i,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,s,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=Z.LOADED}this.changed()}load(){if(this.state==Z.IDLE){this.state=Z.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{let n=t.getState();if(n==Z.IDLE||n==Z.LOADING){e++;let n=M(t,u.CHANGE,r=>{let i=t.getState();(i==Z.LOADED||i==Z.ERROR||i==Z.EMPTY)&&(j(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},t,n){e.getState()==Z.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(j),this.sourcesListenerKeys_=null}release(){this.canvas_&&=(Ee(this.canvas_.getContext(`2d`)),Pr.push(this.canvas_),null),super.release()}},Gr=class extends Tt{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio===void 0?1:e.tilePixelRatio,this.tileGrid=e.tileGrid===void 0?null:e.tileGrid,this.tileGrid&&H(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tmpSize=[0,0],this.key_=e.key||A(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){let t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,r,i,a){return Be()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:pr(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){let r=this.getTileGridForProjection(n),i=this.getTilePixelRatio(t),a=H(r.getTileSize(e),this.tmpSize);return i==1?a:gn(a,i,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){let n=t===void 0?this.getProjection():t,r=t===void 0&&this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(e=mr(r,e,n)),or(e,r)?e:null}clear(){}refresh(){this.clear(),super.refresh()}},Kr=class extends He{constructor(e,t){super(e),this.tile=t}},qr=Gr,Jr={TILELOADSTART:`tileloadstart`,TILELOADEND:`tileloadend`,TILELOADERROR:`tileloaderror`},Yr=class e extends qr{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===e.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){let t=e.target,n=A(t),r=t.getState(),i;r==Z.LOADING?(this.tileLoadingKeys_[n]=!0,i=Jr.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],i=r==Z.ERROR?Jr.TILELOADERROR:r==Z.LOADED?Jr.TILELOADEND:void 0),i!=null&&this.dispatchEvent(new Kr(i,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,t===void 0?this.changed():this.setKey(t)}setUrl(e){let t=Tr(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;let t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Dr(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}},Xr=class extends Yr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Zr,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate===void 0?!0:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin===void 0?null:e.crossOrigin,this.tileClass=e.tileClass===void 0?Mr:e.tileClass,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!Jt(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=`:disable-interpolation`),e}getTileGridForProjection(e){let t=this.getProjection();if(this.tileGrid&&(!t||Jt(t,e)))return this.tileGrid;let n=A(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=pr(e)),this.tileGridForProjection[n]}createTile_(e,t,n,r,i,a){let o=[e,t,n],s=this.getTileCoordForTileUrlFunction(o,i),c=s?this.tileUrlFunction(s,r,i):void 0,l=new this.tileClass(o,c===void 0?Z.EMPTY:Z.IDLE,c===void 0?``:c,this.crossOrigin,this.tileLoadFunction,this.tileOptions);return l.key=a,l.addEventListener(u.CHANGE,this.handleTileChange.bind(this)),l}getTile(e,t,n,r,i,a){let o=this.getProjection();if(!o||!i||Jt(o,i))return this.getTileInternal(e,t,n,r,o||i);let s=[e,t,n],c=this.getKey(),l=new Wr(o,this.getTileGridForProjection(o),i,this.getTileGridForProjection(i),s,this.getTileCoordForTileUrlFunction(s,i),this.getTilePixelRatio(r),this.getGutter(),(e,t,n,r)=>this.getTileInternal(e,t,n,r,o,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return l.key=c,l}getTileInternal(e,t,n,r,i,a){let o=this.getKey(),s=rr(this,o,e,t,n);if(a&&a.containsKey(s))return a.get(s);let c=this.createTile_(e,t,n,r,i,o);return a?.set(s,c),c}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){let n=U(e);if(n){let e=A(n);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}};function Zr(e,t){if(i){let n=e.getCrossOrigin(),r=`same-origin`,i=`same-origin`;n===`anonymous`||n===``?(r=`cors`,i=`omit`):n===`use-credentials`&&(r=`cors`,i=`include`),fetch(t,{mode:r,credentials:i}).then(e=>{if(!e.ok)throw Error(`HTTP ${e.status}`);return e.blob()}).then(e=>createImageBitmap(e)).then(t=>{let n=e.getImage();n.width=t.width,n.height=t.height,n.getContext(`2d`).drawImage(t,0,0),t.close?.(),n.dispatchEvent(new Event(`load`))}).catch(()=>{e.getImage().dispatchEvent(new Event(`error`))});return}e.getImage().src=t}var Qr=Xr,$r=class extends Qr{constructor(e){e||={};let t=e.projection===void 0?`EPSG:3857`:e.projection,n=e.tileGrid===void 0?gr({extent:yr(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize}):e.tileGrid;super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter===void 0?0:e.gutter}getGutter(){return this.gutter_}};function ei(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}const ti=Error(`disposed`);var ni=[256,256],ri=class extends kr{constructor(e){let t=Z.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;let e=ei(this.data_);return e?[e.width,e.height]:ni}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Z.IDLE&&this.state!==Z.ERROR)return;this.state=Z.LOADING,this.changed();let e=this;this.loader_().then(function(t){e.data_=t,e.state=Z.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=Z.ERROR,e.changed()})}disposeInternal(){this.controller_&&=(this.controller_.abort(ti),null),super.disposeInternal()}},ii=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Ke(this.queuedElements_)}dequeue(){let e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));let r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(e){K(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let t=this.priorityFunction_(e);return t==1/0?!1:(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){let t=this.elements_,n=this.priorities_,r=t.length,i=t[e],a=n[e],o=e;for(;e<r>>1;){let i=this.getLeftChildIndex_(e),a=this.getRightChildIndex_(e),o=a<r&&n[a]<n[i]?a:i;t[e]=t[o],n[e]=n[o],e=o}t[e]=i,n[e]=a,this.siftDown_(o,e)}siftDown_(e,t){let n=this.elements_,r=this.priorities_,i=n[t],a=r[t];for(;t>e;){let e=this.getParentIndex_(t);if(r[e]>a)n[t]=n[e],r[t]=r[e],t=e;else break}n[t]=i,r[t]=a}reprioritize(){let e=this.priorityFunction_,t=this.elements_,n=this.priorities_,r=0,i=t.length,a,o,s;for(o=0;o<i;++o)a=t[o],s=e(a),s==1/0?delete this.queuedElements_[this.keyFunction_(a)]:(n[r]=s,t[r++]=a);t.length=r,n.length=r,this.heapify_()}},ai=class extends ii{constructor(e,t){super(t=>e.apply(null,t),e=>e[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){let t=super.enqueue(e);return t&&e[0].addEventListener(u.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){let t=e.target,n=t.getState();if(n===Z.LOADED||n===Z.ERROR||n===Z.EMPTY){n!==Z.ERROR&&t.removeEventListener(u.CHANGE,this.boundHandleTileChange_);let e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;){let e=this.dequeue()[0],t=e.getKey();e.getState()===Z.IDLE&&!(t in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[t]=!0,++this.tilesLoading_,++n,e.load())}}};function oi(e,t,n,r,i){if(!e||!(n in e.wantedTiles)||!e.wantedTiles[n][t.getKey()])return 1/0;let a=e.viewState.center,o=r[0]-a[0],s=r[1]-a[1];return 65536*Math.log(i)+Math.sqrt(o*o+s*s)/i}function si(e,t,n){if(!(n in e))return e[n]=new Set([t]),!0;let r=e[n],i=r.has(t);return i||r.add(t),!i}function ci(e,t,n){let r=e[n];return r?r.delete(t):!1}function li(e,t){let n=e.layerStatesArray[e.layerIndex];n.extent&&(t=se(t,Ot(n.extent,e.viewState.projection)));let r=n.layer.getRenderSource();if(!r.getWrapX()){let n=r.getTileGridForProjection(e.viewState.projection).getExtent();n&&(t=se(t,n))}return t}var ui=class extends dn{constructor(e,t){super(e),t||={},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=S(),this.tempTileRange_=new lr(0,0,0,0),this.tempTileCoord_=tr(0,0,0);let n=t.cacheSize===void 0?512:t.cacheSize;this.tileCache_=new er(n),this.sourceTileCache_=null,this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||=new er(512),this.sourceTileCache_}getOrCreateTile(e,t,n,r){let i=this.tileCache_,a=this.getLayer().getSource(),o=rr(a,a.getKey(),e,t,n),s;if(i.containsKey(o))s=i.get(o);else{let c=r.viewState.projection,l=a.getProjection();if(s=a.getTile(e,t,n,r.pixelRatio,c,!l||Jt(l,c)?void 0:this.getSourceTileCache()),!s)return null;i.set(o,s)}return s}getTile(e,t,n,r){return this.getOrCreateTile(e,t,n,r)||null}getData(e){let t=this.frameState;if(!t)return null;let r=this.getLayer(),i=jn(t.pixelToCoordinateTransform,e.slice()),a=r.getExtent();if(a&&!n(a,i))return null;let o=t.viewState,s=r.getRenderSource(),c=s.getTileGridForProjection(o.projection),l=s.getTilePixelRatio(t.pixelRatio);for(let e=c.getZForResolution(o.resolution);e>=c.getMinZoom();--e){let n=c.getTileCoordForCoordAndZ(i,e),r=this.getTile(e,n[1],n[2],t);if(!r||r.getState()!==Z.LOADED)continue;let a=c.getOrigin(e),u=H(c.getTileSize(e)),d=c.getResolution(e),f;if(r instanceof Mr||r instanceof Wr)f=r.getImage();else if(r instanceof ri){if(f=ei(r.getData()),!f)continue}else continue;let p=Math.floor(l*((i[0]-a[0])/d-n[1]*u[0])),m=Math.floor(l*((a[1]-i[1])/d-n[2]*u[1])),h=Math.round(l*s.getGutterForProjection(o.projection));return this.getImageData(f,p+h,m+h)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let n=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=n,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,n,r,i){let a=e.viewState,o=this.getLayer(),s=o.getRenderSource(),c=s.getTileGridForProjection(a.projection),l=A(s);l in e.wantedTiles||(e.wantedTiles[l]={});let u=e.wantedTiles[l],d=o.getMapInternal(),f=Math.max(n-i,c.getMinZoom(),c.getZForResolution(Math.min(o.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):c.getResolution(0)),s.zDirection)),p=a.rotation,m=p?w(a.center,a.resolution,p,e.size):void 0;for(let i=n;i>=f;--i){let n=c.getTileRangeForExtentAndZ(t,i,this.tempTileRange_),a=c.getResolution(i);for(let t=n.minX;t<=n.maxX;++t)for(let o=n.minY;o<=n.maxY;++o){if(p&&!c.tileCoordIntersectsViewport([i,t,o],m))continue;let n=this.getTile(i,t,o,e);if(!n||!si(r,n,i))continue;let s=n.getKey();if(u[s]=!0,n.getState()===Z.IDLE&&!e.tileQueue.isKeyQueued(s)){let r=tr(i,t,o,this.tempTileCoord_);e.tileQueue.enqueue([n,l,c.getTileCoordCenter(r),a])}}}}findStaleTile_(e,t){let n=this.tileCache_,r=e[0],i=e[1],a=e[2],o=this.getStaleKeys();for(let e=0;e<o.length;++e){let s=rr(this.getLayer().getSource(),o[e],r,i,a);if(n.containsKey(s)){let e=n.peek(s);if(e.getState()===Z.LOADED)return e.endTransition(A(this)),si(t,e,r),!0}}return!1}findAltTiles_(e,t,n,r){let i=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!i)return!1;let a=!0,o=this.tileCache_,s=this.getLayer().getRenderSource(),c=s.getKey();for(let e=i.minX;e<=i.maxX;++e)for(let t=i.minY;t<=i.maxY;++t){let i=rr(s,c,n,e,t),l=!1;if(o.containsKey(i)){let e=o.peek(i);e.getState()===Z.LOADED&&(si(r,e,n),l=!0)}l||(a=!1)}return a}renderFrame(t,n){this.renderComplete=!0;let r=t.layerStatesArray[t.layerIndex],i=t.viewState,a=i.projection,o=i.resolution,s=i.center,l=t.pixelRatio,u=this.getLayer(),d=u.getSource(),f=d.getTileGridForProjection(a),p=f.getZForResolution(o,d.zDirection),m=f.getResolution(p),h=d.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==h&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=h):this.renderedSourceKey_=h;let g=t.extent,_=d.getTilePixelRatio(l);this.prepareContainer(t,n);let v=this.context.canvas.width,y=this.context.canvas.height,b=r.extent&&Ot(r.extent,a);b&&(g=se(g,Ot(r.extent,a)));let x=m*v/2/_,S=m*y/2/_,C=[s[0]-x,s[1]-S,s[0]+x,s[1]+S],w={};this.renderedTiles.length=0;let T=u.getPreload();if(t.nextExtent&&this.enqueueTilesForNextExtent()){let e=f.getZForResolution(i.nextResolution,d.zDirection),n=li(t,t.nextExtent);this.enqueueTiles(t,n,e,w,T)}let ee=li(t,g);if(this.enqueueTiles(t,ee,p,w,0),T>0&&setTimeout(()=>{this.enqueueTiles(t,ee,p-1,w,T-1)},0),!(p in w))return this.container;let te=A(this),E=t.time;for(let e of w[p]){let n=e.getState();if(n===Z.EMPTY)continue;let r=e.tileCoord;if(n===Z.LOADED&&e.getAlpha(te,E)===1){e.endTransition(te);continue}if(n!==Z.ERROR&&(this.renderComplete=!1),this.findStaleTile_(r,w)){ci(w,e,p),t.animate=!0;continue}if(this.findAltTiles_(f,r,p+1,w))continue;let i=f.getMinZoom();for(let e=p-1;e>=i&&!this.findAltTiles_(f,r,e,w);--e);}let D=m/o*l/_,O=this.getRenderContext(t);In(this.tempTransform,v/2,y/2,D,D,0,-v/2,-y/2),r.extent&&this.clipUnrotated(O,t,b),d.getInterpolate()||(O.imageSmoothingEnabled=!1),this.preRender(O,t);let ne=Object.keys(w).map(Number);ne.sort(c);let k,re=[],ie=[];for(let n=ne.length-1;n>=0;--n){let r=ne[n],i=d.getTilePixelSize(r,l,a),o=f.getResolution(r)/m,s=i[0]*o*D,c=i[1]*o*D,u=f.getTileCoordForCoordAndZ(e(C),r),p=f.getTileCoordExtent(u),h=jn(this.tempTransform,[_*(p[0]-C[0])/m,_*(C[3]-p[3])/m]),g=_*d.getGutterForProjection(a);for(let e of w[r]){if(e.getState()!==Z.LOADED)continue;let n=e.tileCoord,i=u[1]-n[1],a=Math.round(h[0]-(i-1)*s),o=u[2]-n[2],l=Math.round(h[1]-(o-1)*c),f=Math.round(h[0]-i*s),p=Math.round(h[1]-o*c),m=a-f,_=l-p,v=ne.length===1,y=!1;k=[f,p,f+m,p,f+m,p+_,f,p+_];for(let e=0,t=re.length;e<t;++e)if(!v&&r<ie[e]){let t=re[e];Ae([f,p,f+m,p+_],[t[0],t[3],t[4],t[7]])&&(y||=(O.save(),!0),O.beginPath(),O.moveTo(k[0],k[1]),O.lineTo(k[2],k[3]),O.lineTo(k[4],k[5]),O.lineTo(k[6],k[7]),O.moveTo(t[6],t[7]),O.lineTo(t[4],t[5]),O.lineTo(t[2],t[3]),O.lineTo(t[0],t[1]),O.clip())}re.push(k),ie.push(r),this.drawTile(e,t,f,p,m,_,g,v),y&&O.restore(),this.renderedTiles.unshift(e),this.updateUsedTiles(t.usedTiles,d,e)}}return this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!qe(this.renderedExtent_,C),this.renderedExtent_=C,this.renderedPixelRatio=l,this.postRender(this.context,t),r.extent&&O.restore(),O.imageSmoothingEnabled=!0,this.renderComplete&&t.postRenderFunctions.push((e,t)=>{let n=A(d),r=t.wantedTiles[n],i=r?Object.keys(r).length:0;this.updateCacheSize(i),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()}),this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,n,r,i,a,o,s){let c;if(e instanceof ri){if(c=ei(e.getData()),!c)throw Error(`Rendering array data is not yet supported`)}else c=this.getTileImage(e);if(!c)return;let l=this.getRenderContext(t),u=A(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(s?e.getAlpha(u,t.time):1),p=f!==l.globalAlpha;p&&(l.save(),l.globalAlpha=f),l.drawImage(c,o,o,c.width-2*o,c.height-2*o,n,r,i,a),p&&l.restore(),f===d.opacity?s&&e.endTransition(u):t.animate=!0}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,n){let r=A(t);r in e||(e[r]={}),e[r][n.getKey()]=!0}},di={PRELOAD:`preload`,USE_INTERIM_TILES_ON_ERROR:`useInterimTilesOnError`},fi=class extends sn{constructor(e){e||={};let t=Object.assign({},e),n=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(e.preload===void 0?0:e.preload),this.setUseInterimTilesOnError(e.useInterimTilesOnError===void 0?!0:e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(di.PRELOAD)}setPreload(e){this.set(di.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(di.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(di.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}},pi=class extends fi{constructor(e){super(e)}createRenderer(){return new ui(this,{cacheSize:this.getCacheSize()})}};function mi(e,t,n){let r=[],i=e(0),a=e(1),o=t(i),s=t(a),c=[a,i],l=[s,o],u=[1,0],d={},f=1e5,p,m,h,g,_,v;for(;--f>0&&u.length>0;)h=u.pop(),i=c.pop(),o=l.pop(),v=h.toString(),v in d||(r.push(o[0],o[1]),d[v]=!0),g=u.pop(),a=c.pop(),s=l.pop(),_=(h+g)/2,p=e(_),m=t(p),It(m[0],m[1],o[0],o[1],s[0],s[1])<n?(r.push(s[0],s[1]),v=g.toString(),d[v]=!0):(u.push(g,_,_,h),l.push(s,m,m,o),c.push(a,p,p,i));return r}function hi(e,t,n,r,i){return mi(function(r){return[e,t+(n-t)*r]},St(U(`EPSG:4326`),r),i)}function gi(e,t,n,r,i){return mi(function(r){return[t+(n-t)*r,e]},St(U(`EPSG:4326`),r),i)}function _i(e){if(!(e.context instanceof CanvasRenderingContext2D))throw Error(`Only works for render events from Canvas 2D layers`);let t=e.inversePixelTransform[0],n=e.inversePixelTransform[1],r=Math.sqrt(t*t+n*n),i=e.frameState,a=Et(e.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=Tn(i.viewState.resolution,r),s,c=zt();return c&&(s=_n(c,i.viewState.projection)),new on(e.context,r,i.extent,a,i.viewState.rotation,o,s)}var vi=new tn({color:`rgba(0,0,0,0.2)`}),yi=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600],bi=class extends En{constructor(e){e||={};let t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize===void 0?100:e.targetSize,this.maxLines_=e.maxLines===void 0?100:e.maxLines,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle===void 0?vi:e.strokeStyle,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?Gt.bind(this,`EW`):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?Gt.bind(this,`NS`):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new hn({text:e.lonLabelStyle===void 0?new wn({font:`12px Calibri,sans-serif`,textBaseline:`bottom`,fill:new Sn({color:`rgba(0,0,0,1)`}),stroke:new tn({color:`rgba(255,255,255,1)`,width:3})}):e.lonLabelStyle.clone()}),this.lonLabelStyle_=e=>{let t=e.get(`graticule_label`);return this.lonLabelStyleBase_.getText().setText(t),this.lonLabelStyleBase_},this.latLabelStyleBase_=new hn({text:e.latLabelStyle===void 0?new wn({font:`12px Calibri,sans-serif`,textAlign:`right`,fill:new Sn({color:`rgba(0,0,0,1)`}),stroke:new tn({color:`rgba(255,255,255,1)`,width:3})}):e.latLabelStyle.clone()}),this.latLabelStyle_=e=>{let t=e.get(`graticule_label`);return this.latLabelStyleBase_.getText().setText(t),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener($t.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals===void 0?yi:e.intervals,this.setSource(new rn({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new J,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new hn({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let n=e.slice();return this.projection_&&this.getSource().getWrapX()&&Le(n,this.projection_),this.loadedExtent_&&(O(this.loadedExtent_,n,t)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(e,t,n){this.loadedExtent_=e;let r=this.getSource(),i=se(this.getExtent()||[-1/0,-1/0,1/0,1/0],e);if(this.renderedExtent_&&qe(this.renderedExtent_,i)&&this.renderedResolution_===t||(this.renderedExtent_=i,this.renderedResolution_=t,be(i)))return;let a=Ne(i),o=t*t/4;(!this.projection_||!Jt(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(i,a,t,o);let s=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(s+=this.meridians_.length),this.parallelsLabels_&&(s+=this.parallels_.length);let c;for(;s>this.featurePool_.length;)c=new Zt,this.featurePool_.push(c);let l=r.getFeaturesCollection();l.clear();let u=0,d,f;for(d=0,f=this.meridians_.length;d<f;++d)c=this.featurePool_[u++],c.setGeometry(this.meridians_[d]),c.setStyle(this.lineStyle_),l.push(c);for(d=0,f=this.parallels_.length;d<f;++d)c=this.featurePool_[u++],c.setGeometry(this.parallels_[d]),c.setStyle(this.lineStyle_),l.push(c)}addMeridian_(e,t,n,r,i,a){let o=this.getMeridian_(e,t,n,r,a);if(Ae(o.getExtent(),i)){if(this.meridiansLabels_){let t=this.lonLabelFormatter_(e);a in this.meridiansLabels_?this.meridiansLabels_[a].text=t:this.meridiansLabels_[a]={geom:new Pt([]),text:t}}this.meridians_[a++]=o}return a}addParallel_(e,t,n,r,i,a){let o=this.getParallel_(e,t,n,r,a);if(Ae(o.getExtent(),i)){if(this.parallelsLabels_){let t=this.latLabelFormatter_(e);a in this.parallelsLabels_?this.parallelsLabels_[a].text=t:this.parallelsLabels_[a]={geom:new Pt([]),text:t}}this.parallels_[a++]=o}return a}drawLabels_(e){let t=e.frameState.viewState.rotation,n=e.frameState.viewState.resolution,r=e.frameState.size,i=e.frameState.extent,a=Ne(i),o=i;if(t){let e=r[0]*n,t=r[1]*n;o=[a[0]-e/2,a[1]-t/2,a[0]+e/2,a[1]+t/2]}let s=0,c=0,l=this.latLabelPosition_<.5,u=this.projection_.getExtent(),d=N(u);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!xe(u,i)){s=Math.floor((i[0]-u[0])/d),c=Math.ceil((i[2]-u[2])/d);let e=Math.abs(t)>Math.PI/2;l=l!==e}let f=_i(e);for(let e=s;e<=c;++e){let n=this.meridians_.length+this.parallels_.length,r,u,p,m;if(this.meridiansLabels_)for(u=0,p=this.meridiansLabels_.length;u<p;++u){let s=this.meridians_[u];if(!t&&e===0)m=this.getMeridianPoint_(s,i,u);else{let n=s.clone();n.translate(e*d,0),n.rotate(-t,a),m=this.getMeridianPoint_(n,o,u),m.rotate(t,a)}r=this.featurePool_[n++],r.setGeometry(m),r.set(`graticule_label`,this.meridiansLabels_[u].text),f.drawFeature(r,this.lonLabelStyle_(r))}if(this.parallelsLabels_&&(e===s&&l||e===c&&!l))for(u=0,p=this.parallels_.length;u<p;++u){let s=this.parallels_[u];if(!t&&e===0)m=this.getParallelPoint_(s,i,u);else{let n=s.clone();n.translate(e*d,0),n.rotate(-t,a),m=this.getParallelPoint_(n,o,u),m.rotate(t,a)}r=this.featurePool_[n++],r.setGeometry(m),r.set(`graticule_label`,this.parallelsLabels_[u].text),f.drawFeature(r,this.latLabelStyle_(r))}}}createGraticule_(e,t,r,i){let a=this.getInterval_(r);if(a==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1,s=this.projection_.getExtent(),c=N(s);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!xe(s,e)&&(N(e)>=c?(e[0]=s[0],e[2]=s[2]):o=!0);let l=[G(t[0],this.minX_,this.maxX_),G(t[1],this.minY_,this.maxY_)],u=this.toLonLatTransform_(l);isNaN(u[1])&&(u[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let d=G(u[0],this.minLon_,this.maxLon_),f=G(u[1],this.minLat_,this.maxLat_),p=this.maxLines_,m,h,g,_,v=e;o||(v=[G(e[0],this.minX_,this.maxX_),G(e[1],this.minY_,this.maxY_),G(e[2],this.minX_,this.maxX_),G(e[3],this.minY_,this.maxY_)]);let y=Ue(v,this.toLonLatTransform_,void 0,8),b=y[3],x=y[2],S=y[1],C=y[0];if(o||(n(v,this.bottomLeft_)&&(C=this.minLon_,S=this.minLat_),n(v,this.bottomRight_)&&(x=this.maxLon_,S=this.minLat_),n(v,this.topLeft_)&&(C=this.minLon_,b=this.maxLat_),n(v,this.topRight_)&&(x=this.maxLon_,b=this.maxLat_),b=G(b,f,this.maxLat_),x=G(x,d,this.maxLon_),S=G(S,this.minLat_,f),C=G(C,this.minLon_,d)),d=Math.floor(d/a)*a,_=G(d,this.minLon_,this.maxLon_),h=this.addMeridian_(_,S,b,i,e,0),m=0,o)for(;(_-=a)>=C&&m++<p;)h=this.addMeridian_(_,S,b,i,e,h);else for(;_!=this.minLon_&&m++<p;)_=Math.max(_-a,this.minLon_),h=this.addMeridian_(_,S,b,i,e,h);if(_=G(d,this.minLon_,this.maxLon_),m=0,o)for(;(_+=a)<=x&&m++<p;)h=this.addMeridian_(_,S,b,i,e,h);else for(;_!=this.maxLon_&&m++<p;)_=Math.min(_+a,this.maxLon_),h=this.addMeridian_(_,S,b,i,e,h);for(this.meridians_.length=h,this.meridiansLabels_&&(this.meridiansLabels_.length=h),f=Math.floor(f/a)*a,g=G(f,this.minLat_,this.maxLat_),h=this.addParallel_(g,C,x,i,e,0),m=0;g!=this.minLat_&&m++<p;)g=Math.max(g-a,this.minLat_),h=this.addParallel_(g,C,x,i,e,h);for(g=G(f,this.minLat_,this.maxLat_),m=0;g!=this.maxLat_&&m++<p;)g=Math.min(g+a,this.maxLat_),h=this.addParallel_(g,C,x,i,e,h);this.parallels_.length=h,this.parallelsLabels_&&(this.parallelsLabels_.length=h)}getInterval_(e){let t=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1],r=-1,i=(this.targetSize_*e)**2,a=[],o=[];for(let e=0,s=this.intervals_.length;e<s;++e){let s=G(this.intervals_[e]/2,0,90),c=G(n,-90+s,90-s);if(a[0]=t-s,a[1]=c-s,o[0]=t+s,o[1]=c+s,this.fromLonLatTransform_(a,a),this.fromLonLatTransform_(o,o),(o[0]-a[0])**2+(o[1]-a[1])**2<=i)break;r=this.intervals_[e]}return r}getMeridian_(e,t,n,r,i){let a=hi(e,t,n,this.projection_,r),o=this.meridians_[i];return o?(o.setFlatCoordinates(`XY`,a),o.changed()):(o=new Rn(a,`XY`),this.meridians_[i]=o),o}getMeridianPoint_(e,t,n){let r=e.getFlatCoordinates(),i=1,a=r.length-1;r[i]>r[a]&&(i=a,a=1);let o=Math.max(t[1],r[i]),s=Math.min(t[3],r[a]),c=G(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,o,s),l=[r[i-1]+(r[a-1]-r[i-1])*(c-r[i])/(r[a]-r[i]),c],u=this.meridiansLabels_[n].geom;return u.setCoordinates(l),u}getMeridians(){return this.meridians_}getParallel_(e,t,n,r,i){let a=gi(e,t,n,this.projection_,r),o=this.parallels_[i];return o?(o.setFlatCoordinates(`XY`,a),o.changed()):o=new Rn(a,`XY`),o}getParallelPoint_(e,t,n){let r=e.getFlatCoordinates(),i=0,a=r.length-2;r[i]>r[a]&&(i=a,a=0);let o=Math.max(t[0],r[i]),s=Math.min(t[2],r[a]),c=G(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,o,s),l=[c,r[i+1]+(r[a+1]-r[i+1])*(c-r[i])/(r[a]-r[i])],u=this.parallelsLabels_[n].geom;return u.setCoordinates(l),u}getParallels(){return this.parallels_}updateProjectionInfo_(e){let t=U(`EPSG:4326`),n=e.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];let r=St(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=r;else{let e=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(t,n,i){i||=2;let a=r(t,n,i);for(let t=0,n=a.length;t<n;t+=i)a[t]<e&&(a[t]+=360);return a}}this.fromLonLatTransform_=St(t,e);let i=Ue([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=i[0],this.maxX_=i[2],this.minY_=i[1],this.maxY_=i[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Ne(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}},xi={ADDLAYER:`addlayer`,REMOVELAYER:`removelayer`},Si=class extends He{constructor(e,t){super(e),this.layer=t}},Ci={LAYERS:`layers`},wi=class e extends Cn{constructor(e){e||={};let t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ci.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new J(n.slice(),{unique:!0}):K(typeof n.getArray==`function`,"Expected `layers` to be an array or a `Collection`"):n=new J(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(j),this.layersListenerKeys_.length=0;let e=this.getLayers();for(let t in this.layersListenerKeys_.push(M(e,W.ADD,this.handleLayersAdd_,this),M(e,W.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(j);Ke(this.listenerKeys_);let t=e.getArray();for(let e=0,n=t.length;e<n;e++){let n=t[e];this.registerLayerListeners_(n),this.dispatchEvent(new Si(xi.ADDLAYER,n))}this.changed()}registerLayerListeners_(t){let n=[M(t,h.PROPERTYCHANGE,this.handleLayerChange_,this),M(t,u.CHANGE,this.handleLayerChange_,this)];t instanceof e&&n.push(M(t,xi.ADDLAYER,this.handleLayerGroupAdd_,this),M(t,xi.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[A(t)]=n}handleLayerGroupAdd_(e){this.dispatchEvent(new Si(xi.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Si(xi.REMOVELAYER,e.layer))}handleLayersAdd_(e){let t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Si(xi.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){let t=e.element,n=A(t);this.listenerKeys_[n].forEach(j),delete this.listenerKeys_[n],this.dispatchEvent(new Si(xi.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(Ci.LAYERS)}setLayers(e){let t=this.getLayers();if(t){let e=t.getArray();for(let t=0,n=e.length;t<n;++t)this.dispatchEvent(new Si(xi.REMOVELAYER,e[t]))}this.set(Ci.LAYERS,e)}getLayersArray(e){return e=e===void 0?[]:e,this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){let t=e===void 0?[]:e,n=t.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(t)});let r=this.getLayerState(),i=r.zIndex;!e&&r.zIndex===void 0&&(i=0);for(let e=n,a=t.length;e<a;e++){let n=t[e];n.opacity*=r.opacity,n.visible=n.visible&&r.visible,n.maxResolution=Math.min(n.maxResolution,r.maxResolution),n.minResolution=Math.max(n.minResolution,r.minResolution),n.minZoom=Math.max(n.minZoom,r.minZoom),n.maxZoom=Math.min(n.maxZoom,r.maxZoom),r.extent!==void 0&&(n.extent===void 0?n.extent=r.extent:n.extent=se(n.extent,r.extent)),n.zIndex===void 0&&(n.zIndex=i)}return t}getSourceState(){return`ready`}},Ti=class extends Te{constructor(e){super();let t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents=`auto`),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let e=0,t=this.listenerKeys.length;e<t;++e)j(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=e,e){let t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==a&&this.listenerKeys.push(M(e,Y.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e==`string`?document.getElementById(e):e}},Ei=class extends Ti{constructor(e){e||={},super({element:document.createElement(`div`),render:e.render,target:e.target}),this.ulElement_=document.createElement(`ul`),this.collapsed_=e.collapsed===void 0?!0:e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible===void 0?!0:e.collapsible,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;let t=e.className===void 0?`ol-attribution`:e.className,n=e.tipLabel===void 0?`Attributions`:e.tipLabel,r=e.expandClassName===void 0?t+`-expand`:e.expandClassName,i=e.collapseLabel===void 0?``:e.collapseLabel,a=e.collapseClassName===void 0?t+`-collapse`:e.collapseClassName;typeof i==`string`?(this.collapseLabel_=document.createElement(`span`),this.collapseLabel_.textContent=i,this.collapseLabel_.className=a):this.collapseLabel_=i;let o=e.label===void 0?`i`:e.label;typeof o==`string`?(this.label_=document.createElement(`span`),this.label_.textContent=o,this.label_.className=r):this.label_=o;let s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement(`button`),this.toggleButton_.setAttribute(`type`,`button`),this.toggleButton_.setAttribute(`aria-expanded`,String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(s),this.toggleButton_.addEventListener(u.CLICK,this.handleClick_.bind(this),!1);let c=t+` `+de+` `+Oe+(this.collapsed_&&this.collapsible_?` `+Re:``)+(this.collapsible_?``:` ol-uncollapsible`),l=this.element;l.className=c,l.appendChild(this.toggleButton_),l.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){let t=this.getMap().getAllLayers(),n=new Set(t.flatMap(t=>t.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(e=>n.add(e)):n.add(this.attributions_)),!this.overrideCollapsible_){let e=!t.some(e=>e.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(e)}return Array.from(n)}async updateElement_(e){if(!e){this.renderedVisible_&&=(this.element.style.display=`none`,!1);return}let t=await Promise.all(this.collectSourceAttributions_(e).map(e=>ne(()=>e))),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?``:`none`,this.renderedVisible_=n),!Ce(t,this.renderedAttributions_)){ye(this.ulElement_);for(let e=0,n=t.length;e<n;++e){let n=document.createElement(`li`);n.innerHTML=t[e],this.ulElement_.appendChild(n)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Re),this.collapsed_?le(this.collapseLabel_,this.label_):le(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute(`aria-expanded`,String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle(`ol-uncollapsible`),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},Di=class extends Ti{constructor(e){e||={},super({element:document.createElement(`div`),render:e.render,target:e.target});let t=e.className===void 0?`ol-rotate`:e.className,n=e.label===void 0?``:e.label,r=e.compassClassName===void 0?`ol-compass`:e.compassClassName;this.label_=null,typeof n==`string`?(this.label_=document.createElement(`span`),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));let i=e.tipLabel?e.tipLabel:`Reset rotation`,a=document.createElement(`button`);a.className=t+`-reset`,a.setAttribute(`type`,`button`),a.title=i,a.appendChild(this.label_),a.addEventListener(u.CLICK,this.handleClick_.bind(this),!1);let o=t+` `+de+` `+Oe,s=this.element;s.className=o,s.appendChild(a),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration===void 0?250:e.duration,this.autoHide_=e.autoHide===void 0?!0:e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Pe)}handleClick_(e){e.preventDefault(),this.callResetNorth_===void 0?this.resetNorth_():this.callResetNorth_()}resetNorth_(){let e=this.getMap().getView();if(!e)return;let t=e.getRotation();t!==void 0&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:qt}):e.setRotation(0))}render(e){let t=e.frameState;if(!t)return;let n=t.viewState.rotation;if(n!=this.rotation_){let e=`rotate(`+n+`rad)`;if(this.autoHide_){let e=this.element.classList.contains(Pe);!e&&n===0?this.element.classList.add(Pe):e&&n!==0&&this.element.classList.remove(Pe)}this.label_.style.transform=e}this.rotation_=n}},Oi=class extends Ti{constructor(e){e||={},super({element:document.createElement(`div`),target:e.target});let t=e.className===void 0?`ol-zoom`:e.className,n=e.delta===void 0?1:e.delta,r=e.zoomInClassName===void 0?t+`-in`:e.zoomInClassName,i=e.zoomOutClassName===void 0?t+`-out`:e.zoomOutClassName,a=e.zoomInLabel===void 0?`+`:e.zoomInLabel,o=e.zoomOutLabel===void 0?``:e.zoomOutLabel,s=e.zoomInTipLabel===void 0?`Zoom in`:e.zoomInTipLabel,c=e.zoomOutTipLabel===void 0?`Zoom out`:e.zoomOutTipLabel,l=document.createElement(`button`);l.className=r,l.setAttribute(`type`,`button`),l.title=s,l.appendChild(typeof a==`string`?document.createTextNode(a):a),l.addEventListener(u.CLICK,this.handleClick_.bind(this,n),!1);let d=document.createElement(`button`);d.className=i,d.setAttribute(`type`,`button`),d.title=c,d.appendChild(typeof o==`string`?document.createTextNode(o):o),d.addEventListener(u.CLICK,this.handleClick_.bind(this,-n),!1);let f=t+` `+de+` `+Oe,p=this.element;p.className=f,p.appendChild(l),p.appendChild(d),this.duration_=e.duration===void 0?250:e.duration}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){let t=this.getMap().getView();if(!t)return;let n=t.getZoom();if(n!==void 0){let r=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:r,duration:this.duration_,easing:qt})):t.setZoom(r)}}};function ki(e){e||={};let t=new J;return(e.zoom===void 0||e.zoom)&&t.push(new Oi(e.zoomOptions)),(e.rotate===void 0||e.rotate)&&t.push(new Di(e.rotateOptions)),(e.attribution===void 0||e.attribution)&&t.push(new Ei(e.attributionOptions)),t}var Ai={POINTERMOVE:`pointermove`,POINTERDOWN:`pointerdown`,POINTERUP:`pointerup`,POINTEROVER:`pointerover`,POINTEROUT:`pointerout`,POINTERENTER:`pointerenter`,POINTERLEAVE:`pointerleave`,POINTERCANCEL:`pointercancel`},ji=`projection`,Mi=`coordinateFormat`,Ni=class extends Ti{constructor(e){e||={};let t=document.createElement(`div`);t.className=e.className===void 0?`ol-mouse-position`:e.className,super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(ji,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:`&#160;`,this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Mi)}getProjection(){return this.get(ji)}handleMouseMove(e){let t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){let t=e.getViewport();this.listenerKeys.push(M(t,Ai.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(M(t,Ai.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Mi,e)}setProjection(e){this.set(ji,U(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){let e=this.getProjection();e?this.transform_=_n(this.mapProjection_,e):this.transform_=Bt}let n=this.getMap().getCoordinateFromPixelInternal(e);if(n){let e=zt();e&&(this.transform_=_n(this.mapProjection_,e)),this.transform_(n,n),this.wrapX_&&Yt(n,e||this.getProjection()||this.mapProjection_);let r=this.getCoordinateFormat();t=r?r(n):n.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){let t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}},Pi=`units`,Fi=[1,2,5],Ii=25.4/.28,Li=class extends Ti{constructor(e){e||={};let t=document.createElement(`div`);t.style.pointerEvents=`none`,super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;let n=e.className===void 0?e.bar?`ol-scale-bar`:`ol-scale-line`:e.className;this.innerElement_=document.createElement(`div`),this.innerElement_.className=n+`-inner`,this.element.className=n+` `+de,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth===void 0?64:e.minWidth,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_=``,this.addChangeListener(Pi,this.handleUnitsChanged_),this.setUnits(e.units||`metric`),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(Pi)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(Pi,e)}setDpi(e){this.dpi_=e}updateElement_(){let e=this.viewState_;if(!e){this.renderedVisible_&&=(this.element.style.display=`none`,!1);return}let t=e.center,n=e.projection,r=this.getUnits(),i=r==`degrees`?`degrees`:`m`,a=yn(n,e.resolution,t,i),o=this.minWidth_*(this.dpi_||Ii)/Ii,s=this.maxWidth_===void 0?void 0:this.maxWidth_*(this.dpi_||Ii)/Ii,c=o*a,l=``;if(r==`degrees`){let e=Ft.degrees;c*=e,c<e/60?(l=``,a*=3600):c<e?(l=``,a*=60):l=``}else if(r==`imperial`)c<.9144?(l=`in`,a/=.0254):c<1609.344?(l=`ft`,a/=.3048):(l=`mi`,a/=1609.344);else if(r==`nautical`)a/=1852,l=`NM`;else if(r==`metric`)c<1e-6?(l=`nm`,a*=1e9):c<.001?(l=`m`,a*=1e6):c<1?(l=`mm`,a*=1e3):c<1e3?l=`m`:(l=`km`,a/=1e3);else if(r==`us`)c<.9144?(l=`in`,a*=39.37):c<1609.344?(l=`ft`,a/=.30480061):(l=`mi`,a/=1609.3472);else throw Error(`Invalid units`);let u=3*Math.floor(Math.log(o*a)/Math.log(10)),d,f,p,m=0,h,g;for(;;){p=Math.floor(u/3);let e=10**p;if(d=Fi[(u%3+3)%3]*e,f=Math.round(d/a),isNaN(f)){this.element.style.display=`none`,this.renderedVisible_=!1;return}if(s!==void 0&&f>=s){d=m,f=h,p=g;break}else if(f>=o)break;m=d,h=f,g=p,++u}let _=this.scaleBar_?this.createScaleBar(f,d,l):d.toFixed(p<0?-p:0)+` `+l;this.renderedHTML_!=_&&(this.innerElement_.innerHTML=_,this.renderedHTML_=_),this.renderedWidth_!=f&&(this.innerElement_.style.width=f+`px`,this.renderedWidth_=f),this.renderedVisible_||=(this.element.style.display=``,!0)}createScaleBar(e,t,n){let r=this.getScaleForResolution(),i=r<1?Math.round(1/r).toLocaleString()+` : 1`:`1 : `+Math.round(r).toLocaleString(),a=this.scaleBarSteps_,o=e/a,s=[this.createMarker(`absolute`)];for(let r=0;r<a;++r){let i=r%2==0?`ol-scale-singlebar-odd`:`ol-scale-singlebar-even`;s.push(`<div><div class="ol-scale-singlebar ${i}" style="width: ${o}px;"></div>`+this.createMarker(`relative`)+(r%2==0||a===2?this.createStepText(r,e,!1,t,n):``)+`</div>`)}return s.push(this.createStepText(a,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+i+`</div>`:``)+s.join(``)}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e===`absolute`?3:-10}px;"></div>`}createStepText(e,t,n,r,i){let a=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?``:` `+i),o=e===0?-3:t/this.scaleBarSteps_*-1,s=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${o}px;text-align: ${e===0?`left`:`center`};min-width: ${s}px;left: ${n?t+`px`:`unset`};">`+a+`</div>`}getScaleForResolution(){let e=yn(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,`m`),t=this.dpi_||Ii;return e*(1e3/25.4)*t}render(e){let t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}},Q={SINGLECLICK:`singleclick`,CLICK:u.CLICK,DBLCLICK:u.DBLCLICK,POINTERDRAG:`pointerdrag`,POINTERMOVE:`pointermove`,POINTERDOWN:`pointerdown`,POINTERUP:`pointerup`,POINTEROVER:`pointerover`,POINTEROUT:`pointerout`,POINTERENTER:`pointerenter`,POINTERLEAVE:`pointerleave`,POINTERCANCEL:`pointercancel`},Ri={ACTIVE:`active`},zi=class extends Te{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ri.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Ri.ACTIVE,e)}setMap(e){this.map_=e}};function Bi(e,t,n){let r=e.getCenterInternal();if(r){let i=[r[0]+t[0],r[1]+t[1]];e.animateInternal({duration:n===void 0?250:n,easing:kt,center:e.getConstrainedCenter(i)})}}function Vi(e,t,n,r){let i=e.getZoom();if(i===void 0)return;let a=e.getConstrainedZoom(i+t),o=e.getResolutionForZoom(a);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:o,anchor:n,duration:r===void 0?250:r,easing:qt})}var Hi=zi,Ui=class extends Hi{constructor(e){super(),e||={},this.delta_=e.delta?e.delta:1,this.duration_=e.duration===void 0?250:e.duration}handleEvent(e){let t=!1;if(e.type==Q.DBLCLICK){let n=e.originalEvent,r=e.map,i=e.coordinate,a=n.shiftKey?-this.delta_:this.delta_;Vi(r.getView(),a,i,this.duration_),n.preventDefault(),t=!0}return!t}};function Wi(e){let t=arguments;return function(e){let n=!0;for(let r=0,i=t.length;r<i&&(n&&=t[r](e),n);++r);return n}}const Gi=function(e){let t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Ki=function(e){let t=e.map.getTargetElement(),n=t.getRootNode(),r=e.map.getOwnerDocument().activeElement;return n instanceof ShadowRoot?n.host.contains(r):t.contains(r)},qi=function(e){let t=e.map.getTargetElement(),n=t.getRootNode();return(n instanceof ShadowRoot?n.host:t).hasAttribute(`tabindex`)?Ki(e):!0},Ji=D,Yi=function(e){let t=e.originalEvent;return`pointerId`in t&&t.button==0&&!(te&&fe&&t.ctrlKey)},Xi=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Zi=function(e){let t=e.originalEvent;return fe?t.metaKey:t.ctrlKey},Qi=function(e){let t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},$i=function(e){let t=e.originalEvent,n=t.target.tagName;return n!==`INPUT`&&n!==`SELECT`&&n!==`TEXTAREA`&&!t.target.isContentEditable},ea=function(e){let t=e.originalEvent;return`pointerId`in t&&t.pointerType==`mouse`},ta=function(e){let t=e.originalEvent;return`pointerId`in t&&t.isPrimary&&t.button===0};var na=class extends C{constructor(e){super(),this.geometry_=null,this.element_=document.createElement(`div`),this.element_.style.position=`absolute`,this.element_.style.pointerEvents=`auto`,this.element_.className=`ol-box `+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let e=this.startPixel_,t=this.endPixel_,n=this.element_.style;n.left=Math.min(e[0],t[0])+`px`,n.top=Math.min(e[1],t[1])+`px`,n.width=Math.abs(t[0]-e[0])+`px`,n.height=Math.abs(t[1]-e[1])+`px`}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let e=this.element_.style;e.left=`inherit`,e.top=`inherit`,e.width=`inherit`,e.height=`inherit`}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;let e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Ht([n])}getGeometry(){return this.geometry_}},ra=class extends Hi{constructor(e){e||={},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence)e.type==Q.POINTERDRAG?(this.handleDragEvent(e),e.originalEvent.preventDefault()):e.type==Q.POINTERUP&&(this.handlingDownUpSequence=this.handleUpEvent(e)&&this.targetPointers.length>0);else if(e.type==Q.POINTERDOWN){let n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Q.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}};function ia(e){let t=e.length,n=0,r=0;for(let i=0;i<t;i++)n+=e[i].clientX,r+=e[i].clientY;return{clientX:n/t,clientY:r/t}}var aa=ra,oa={BOXSTART:`boxstart`,BOXDRAG:`boxdrag`,BOXEND:`boxend`,BOXCANCEL:`boxcancel`},sa=class extends He{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}},ca=class extends aa{constructor(e){super(),this.on,this.once,this.un,e??={},this.box_=new na(e.className||`ol-dragbox`),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??Yi,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){let r=n[0]-t[0],i=n[1]-t[1];return r*r+i*i>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new sa(oa.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;let t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new sa(t?oa.BOXEND:oa.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new sa(oa.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&=(this.dispatchEvent(new sa(oa.BOXCANCEL,this.startPixel_,null)),null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&=(this.dispatchEvent(new sa(oa.BOXCANCEL,this.startPixel_,null)),null)),super.setMap(e)}},la=class extends aa{constructor(e){super({stopDown:Ge}),e||={},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let t=e.condition?e.condition:Wi(Xi,ta);this.condition_=e.onFocusOnly?Wi(qi,t):t,this.noKinetic_=!1}handleDragEvent(e){let t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());let n=this.targetPointers,r=t.getEventPixel(ia(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){let t=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],n=e.map.getView();wt(t,n.getResolution()),Ln(t,n.getRotation()),n.adjustCenterInternal(t)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){let t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let e=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),i=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(i),o=t.getCoordinateFromPixelInternal([a[0]-e*Math.cos(r),a[1]-e*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(o),duration:500,easing:qt})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){let t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},ua=class extends aa{constructor(e){e||={},super({stopDown:Ge}),this.condition_=e.condition?e.condition:Gi,this.lastAngle_=void 0,this.duration_=e.duration===void 0?250:e.duration}handleDragEvent(e){if(!ea(e))return;let t=e.map,n=t.getView();if(n.getConstraints().rotation===pn)return;let r=t.getSize(),i=e.pixel,a=Math.atan2(r[1]/2-i[1],i[0]-r[0]/2);if(this.lastAngle_!==void 0){let e=a-this.lastAngle_;n.adjustRotationInternal(-e)}this.lastAngle_=a}handleUpEvent(e){return ea(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return ea(e)&&Yi(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},da=class extends ca{constructor(e){e||={};let t=e.condition?e.condition:Qi;super({condition:t,className:e.className||`ol-dragzoom`,minArea:e.minArea}),this.duration_=e.duration===void 0?200:e.duration,this.out_=e.out===void 0?!1:e.out}onBoxEnd(e){let t=this.getMap().getView(),n=this.getGeometry();if(this.out_){let e=t.rotatedExtentForGeometry(n),r=t.getResolutionForExtentInternal(e),i=t.getResolution()/r;n=n.clone(),n.scale(i*i)}t.fitInternal(n,{duration:this.duration_,easing:qt})}},fa=class extends He{constructor(e,t,n){super(e),this.map=t,this.frameState=n===void 0?null:n}},pa=class extends fa{constructor(e,t,n,r,i,a){super(e,t,i),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r===void 0?!1:r,this.activePointers=a}get pixel(){return this.pixel_||=this.map.getEventPixel(this.originalEvent),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||=this.map.getCoordinateFromPixel(this.pixel),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),`preventDefault`in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),`stopPropagation`in this.originalEvent&&this.originalEvent.stopPropagation()}},ma={LEFT:`ArrowLeft`,UP:`ArrowUp`,RIGHT:`ArrowRight`,DOWN:`ArrowDown`},ha=class extends Hi{constructor(e){super(),e||={},this.defaultCondition_=function(e){return Xi(e)&&$i(e)},this.condition_=e.condition===void 0?this.defaultCondition_:e.condition,this.duration_=e.duration===void 0?100:e.duration,this.pixelDelta_=e.pixelDelta===void 0?128:e.pixelDelta}handleEvent(e){let t=!1;if(e.type==u.KEYDOWN){let n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==ma.DOWN||r==ma.LEFT||r==ma.RIGHT||r==ma.UP)){let i=e.map.getView(),a=i.getResolution()*this.pixelDelta_,o=0,s=0;r==ma.DOWN?s=-a:r==ma.LEFT?o=-a:r==ma.RIGHT?o=a:s=a;let c=[o,s];Ln(c,i.getRotation()),Bi(i,c,this.duration_),n.preventDefault(),t=!0}}return!t}},ga=class extends Hi{constructor(e){super(),e||={},this.condition_=e.condition?e.condition:function(e){return!Zi(e)&&$i(e)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration===void 0?100:e.duration}handleEvent(e){let t=!1;if(e.type==u.KEYDOWN||e.type==u.KEYPRESS){let n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r===`+`||r===`-`)){let i=e.map,a=r===`+`?this.delta_:-this.delta_;Vi(i.getView(),a,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}},_a=40,va=300,ya=class extends Hi{constructor(e){e||={},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta===void 0?1:e.maxDelta,this.duration_=e.duration===void 0?250:e.duration,this.timeout_=e.timeout===void 0?80:e.timeout,this.useAnchor_=e.useAnchor===void 0?!0:e.useAnchor,this.constrainResolution_=e.constrainResolution===void 0?!1:e.constrainResolution;let t=e.condition?e.condition:Ji;this.condition_=e.onFocusOnly?Wi(qi,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==u.WHEEL)return!0;let t=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r=n.deltaY;switch(n.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=_a;break;case WheelEvent.DOM_DELTA_PAGE:r*=va;break;default:}if(r===0)return!1;this.lastDelta_=r;let i=Date.now();this.startTime_===void 0&&(this.startTime_=i),(!this.mode_||i-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?`trackpad`:`wheel`);let a=t.getView();if(this.mode_===`trackpad`&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=i,!1;this.totalDelta_+=r;let o=Math.max(this.timeout_-(i-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),o),!1}handleWheelZoom_(e){let t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-G(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Vi(t,n,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},ba=class extends aa{constructor(e){e||={};let t=e;t.stopDown||=Ge,super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold===void 0?.3:e.threshold,this.duration_=e.duration===void 0?250:e.duration}handleDragEvent(e){let t=0,n=this.targetPointers[0],r=this.targetPointers[1],i=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){let e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=e}this.lastAngle_=i;let a=e.map,o=a.getView();o.getConstraints().rotation!==pn&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(ia(this.targetPointers))),this.rotating_&&(a.render(),o.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){let t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},xa=class extends aa{constructor(e){e||={};let t=e;t.stopDown||=Ge,super(t),this.anchor_=null,this.duration_=e.duration===void 0?400:e.duration,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1,n=this.targetPointers[0],r=this.targetPointers[1],i=n.clientX-r.clientX,a=n.clientY-r.clientY,o=Math.sqrt(i*i+a*a);this.lastDistance_!==void 0&&(t=this.lastDistance_/o),this.lastDistance_=o;let s=e.map,c=s.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(ia(this.targetPointers))),s.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){let t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){let t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},Sa=class{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;let e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;let r=this.points_[t+2]-this.points_[n+2];if(r<1e3/60)return!1;let i=this.points_[t]-this.points_[n],a=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(a,i),this.initialVelocity_=Math.sqrt(i*i+a*a)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}};function Ca(e){e||={};let t=new J,n=new Sa(-.005,.05,100);return(e.altShiftDragRotate===void 0||e.altShiftDragRotate)&&t.push(new ua),(e.doubleClickZoom===void 0||e.doubleClickZoom)&&t.push(new Ui({delta:e.zoomDelta,duration:e.zoomDuration})),(e.dragPan===void 0||e.dragPan)&&t.push(new la({onFocusOnly:e.onFocusOnly,kinetic:n})),(e.pinchRotate===void 0||e.pinchRotate)&&t.push(new ba),(e.pinchZoom===void 0||e.pinchZoom)&&t.push(new xa({duration:e.zoomDuration})),(e.keyboard===void 0||e.keyboard)&&(t.push(new ha),t.push(new ga({delta:e.zoomDelta,duration:e.zoomDuration}))),(e.mouseWheelZoom===void 0||e.mouseWheelZoom)&&t.push(new ya({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(e.shiftDragZoom===void 0||e.shiftDragZoom)&&t.push(new da({duration:e.zoomDuration})),t}var wa=class extends ue{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;let n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=M(n,Ai.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=M(n,Ai.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(u.TOUCHMOVE,this.boundHandleTouchMove_,We?{passive:!1}:!1)}emulateClick_(e){let t=new pa(Q.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_===void 0?this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let t=new pa(Q.SINGLECLICK,this.map_,e);this.dispatchEvent(t)},250):(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new pa(Q.DBLCLICK,this.map_,e),this.dispatchEvent(t))}updateActivePointers_(e){let t=e,n=t.pointerId;if(t.type==Q.POINTERUP||t.type==Q.POINTERCANCEL){for(let e in delete this.trackedTouches_[n],this.trackedTouches_)if(this.trackedTouches_[e].target!==t.target){delete this.trackedTouches_[e];break}}else (t.type==Q.POINTERDOWN||t.type==Q.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);let t=new pa(Q.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(j),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);let t=new pa(Q.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,`target`,{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){let e=this.map_.getOwnerDocument();this.dragListenerKeys_.push(M(e,Q.POINTERMOVE,this.handlePointerMove_,this),M(e,Q.POINTERUP,this.handlePointerUp_,this),M(this.element_,Q.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==e&&this.dragListenerKeys_.push(M(this.element_.getRootNode(),Q.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;let t=new pa(Q.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;let t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new pa(Q.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){let t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!=`boolean`||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&=(j(this.relayedListenerKey_),null),this.element_.removeEventListener(u.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&=(j(this.pointerdownListenerKey_),null),this.dragListenerKeys_.forEach(j),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},$={LAYERGROUP:`layergroup`,SIZE:`size`,TARGET:`target`,VIEW:`view`},Ta=class extends C{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Be()}calculateMatrices2D(e){let t=e.viewState,n=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;In(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Kt(r,n)}forEachFeatureAtCoordinate(e,t,n,r,i,a,o,s){let c,l=t.viewState;function u(e,t,n,r){return i.call(a,t,e?n:null,r)}let d=l.projection,f=Yt(e.slice(),d),p=[[0,0]];if(d.canWrapX()&&r){let e=N(d.getExtent());p.push([-e,0],[e,0])}let m=t.layerStatesArray,h=m.length,g=[],_=[];for(let r=0;r<p.length;r++)for(let i=h-1;i>=0;--i){let a=m[i],d=a.layer;if(d.hasRenderer()&&ln(a,l)&&o.call(s,d)){let i=d.getRenderer(),o=d.getSource();if(i&&o){let s=o.getWrapX()?f:e,l=u.bind(null,a.managed);_[0]=s[0]+p[r][0],_[1]=s[1]+p[r][1],c=i.forEachFeatureAtCoordinate(_,t,n,l,g)}if(c)return c}}if(g.length===0)return;let v=1/g.length;return g.forEach((e,t)=>e.distanceSq+=t*v),g.sort((e,t)=>e.distanceSq-t.distanceSq),g.some(e=>c=e.callback(e.feature,e.layer,e.geometry)),c}hasFeatureAtCoordinate(e,t,n,r,i,a){return this.forEachFeatureAtCoordinate(e,t,n,r,D,this,i,a)!==void 0}getMap(){return this.map_}renderFrame(e){Be()}scheduleExpireIconCache(e){On.canExpireCache()&&e.postRenderFunctions.push(Ea)}};function Ea(e,t){On.expire()}var Da=Ta,Oa=class extends Da{constructor(e){super(e),this.fontChangeListenerKey_=M(bn,h.PROPERTYCHANGE,e.redrawText,e),this.element_=i?we():document.createElement(`div`);let t=this.element_.style;t.position=`absolute`,t.width=`100%`,t.height=`100%`,t.zIndex=`0`,this.element_.className=de+` ol-layers`;let n=e.getViewport();n&&n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){let n=this.getMap();if(n.hasListener(e)){let r=new kn(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){j(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&=(this.element_.style.display=`none`,!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent($t.PRECOMPOSE,e);let t=e.layerStatesArray.sort((e,t)=>e.zIndex-t.zIndex);t.some(e=>e.layer instanceof xn&&e.layer.getDeclutter())&&(e.declutter={});let n=e.viewState;this.children_.length=0;let r=[],i=null;for(let a=0,o=t.length;a<o;++a){let o=t[a];e.layerIndex=a;let s=o.layer,c=s.getSourceState();if(!ln(o,n)||c!=`ready`&&c!=`undefined`){s.unrender();continue}let l=s.render(e,i);l&&(l!==i&&(this.children_.push(l),i=l),r.push(o))}this.declutter(e,r),ve(this.element_,this.children_);let a=this.getMap().getTargetElement();if(me(a)){let e=a.getContext(`2d`);for(let t of this.children_){let n=t.firstElementChild||t,r=t.style.backgroundColor;if(r&&(!me(n)||n.width>0)&&(e.fillStyle=r,e.fillRect(0,0,a.width,a.height)),me(n)&&n.width>0){let r=t.style.opacity||n.style.opacity;e.globalAlpha=r===``?1:Number(r);let i=n.style.transform;if(i)e.setTransform(...Pn(i));else{let t=parseFloat(n.style.width)/n.width,r=parseFloat(n.style.height)/n.height;e.setTransform(t,0,0,r,0,0)}e.drawImage(n,0,0)}}e.globalAlpha=1,e.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent($t.POSTCOMPOSE,e),this.renderedVisible_||=(this.element_.style.display=``,!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let n=t.length-1;n>=0;--n){let r=t[n],i=r.layer;i.getDeclutter()&&i.renderDeclutter(e,r)}t.forEach(t=>t.layer.renderDeferred(e))}}};function ka(e){if(e instanceof sn){e.setMapInternal(null);return}e instanceof wi&&e.getLayers().forEach(ka)}function Aa(e,t){if(e instanceof sn){e.setMapInternal(t);return}if(e instanceof wi){let n=e.getLayers().getArray();for(let e=0,r=n.length;e<r;++e)Aa(n[e],t)}}var ja=class extends Te{constructor(e){super(),e||={},this.on,this.once,this.un;let t=Ma(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading===void 0?16:e.maxTilesLoading,this.pixelRatio_=e.pixelRatio===void 0?Ve:e.pixelRatio,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=an(),this.pixelToCoordinateTransform_=an(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,i||(this.viewport_=document.createElement(`div`),this.viewport_.className=`ol-viewport`+(`ontouchstart`in window?` ol-touch`:``),this.viewport_.style.position=`relative`,this.viewport_.style.overflow=`hidden`,this.viewport_.style.width=`100%`,this.viewport_.style.height=`100%`,this.overlayContainer_=document.createElement(`div`),this.overlayContainer_.style.position=`absolute`,this.overlayContainer_.style.zIndex=`0`,this.overlayContainer_.style.width=`100%`,this.overlayContainer_.style.height=`100%`,this.overlayContainer_.style.pointerEvents=`none`,this.overlayContainer_.className=`ol-overlaycontainer`,this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement(`div`),this.overlayContainerStopEvent_.style.position=`absolute`,this.overlayContainerStopEvent_.style.zIndex=`0`,this.overlayContainerStopEvent_.style.width=`100%`,this.overlayContainerStopEvent_.style.height=`100%`,this.overlayContainerStopEvent_.style.pointerEvents=`none`,this.overlayContainerStopEvent_.className=`ol-overlaycontainer-stopevent`,this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,i||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=t.controls||(i?new J:ki()),this.interactions=t.interactions||(i?new J:Ca({onFocusOnly:!0})),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ai(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener($.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener($.VIEW,this.handleViewChanged_),this.addChangeListener($.SIZE,this.handleSizeChanged_),this.addChangeListener($.TARGET,this.handleTargetChanged_),this.setProperties(t.values);let n=this;e.view&&!(e.view instanceof q)&&e.view.then(function(e){n.setView(new q(e))}),this.controls.addEventListener(W.ADD,e=>{e.element.setMap(this)}),this.controls.addEventListener(W.REMOVE,e=>{e.element.setMap(null)}),this.interactions.addEventListener(W.ADD,e=>{e.element.setMap(this)}),this.interactions.addEventListener(W.REMOVE,e=>{e.element.setMap(null)}),this.overlays_.addEventListener(W.ADD,e=>{this.addOverlayInternal_(e.element)}),this.overlays_.addEventListener(W.REMOVE,e=>{let t=e.element.getId();t!==void 0&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)}),this.controls.forEach(e=>{e.setMap(this)}),this.interactions.forEach(e=>{e.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){Aa(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){let t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;let r=this.getCoordinateFromPixelInternal(e);n=n===void 0?{}:n;let i=n.hitTolerance===void 0?0:n.hitTolerance,a=n.layerFilter===void 0?D:n.layerFilter,o=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,i,o,t,null,a,null)}getFeaturesAtPixel(e,t){let n=[];return this.forEachFeatureAtPixel(e,function(e){n.push(e)},t),n}getAllLayers(){let e=[];function t(n){n.forEach(function(n){n instanceof wi?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;let n=this.getCoordinateFromPixelInternal(e);t=t===void 0?{}:t;let r=t.layerFilter===void 0?D:t.layerFilter,i=t.hitTolerance===void 0?0:t.hitTolerance,a=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,i,a,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){let t=this.viewport_.getBoundingClientRect(),n=this.getSize(),r=t.width/n[0],i=t.height/n[1],a=`changedTouches`in e?e.changedTouches[0]:e;return[(a.clientX-t.left)/r,(a.clientY-t.top)/i]}getTarget(){return this.get($.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Ut(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){let t=this.frameState_;return t?jn(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){let t=this.overlayIdIndex_[e.toString()];return t===void 0?null:t}getInteractions(){return this.interactions}getLayerGroup(){return this.get($.LAYERGROUP)}setLayers(e){let t=this.getLayerGroup();if(e instanceof J){t.setLayers(e);return}let n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){let n=e[t];if(!n.visible)continue;let r=n.layer.getRenderer();if(r&&!r.ready)return!0;let i=n.layer.getSource();if(i&&i.loading)return!0}return!1}getPixelFromCoordinate(e){let t=At(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){let t=this.frameState_;return t?jn(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get($.SIZE)}getView(){return this.get($.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,r){return oi(this.frameState_,e,t,n,r)}handleBrowserEvent(e,t){t||=e.type;let n=new pa(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;let t=e.originalEvent,n=t.type;if(n===Ai.POINTERDOWN||n===u.WHEEL||n===u.KEYDOWN){let e=this.getOwnerDocument(),n=this.viewport_.getRootNode?this.viewport_.getRootNode():e,r=t.target,i=n instanceof ShadowRoot?n.host===r?n.host.ownerDocument:n:n===e?e.documentElement:n;if(this.overlayContainerStopEvent_.contains(r)||!i.contains(r))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){let t=this.getInteractions().getArray().slice();for(let n=t.length-1;n>=0;n--){let r=t[n];if(!(r.getMap()!==this||!r.getActive()||!this.getTargetElement())&&(!r.handleEvent(e)||e.propagationStopped))break}}}handlePostRender(){let e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){let t=e.viewHints;if(t[Fn.ANIMATING]||t[Fn.INTERACTING]){let t=Date.now()-e.time>8;n=t?0:8,r=t?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener($t.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent($t.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new fa(Y.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new fa(Y.LOADSTART,this,e))));let n=this.postRenderFunctions_;if(e)for(let t=0,r=n.length;t<r;++t)n[t](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)j(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(u.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(u.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!me(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);let e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}let e=this.getTarget(),t=typeof e==`string`?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&=(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),null),this.animationDelayKey_&&=(cancelAnimationFrame(this.animationDelayKey_),void 0);else{if(me(t)||t.appendChild(this.viewport_),this.renderer_||=new Oa(this),!me(t)){for(let e in this.mapBrowserEventHandler_=new wa(this,this.moveTolerance_),Q)this.mapBrowserEventHandler_.addEventListener(Q[e],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(u.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(u.WHEEL,this.boundHandleBrowserEvent_,We?{passive:!1}:!1);let e;if(this.keyboardEventTarget_)e=this.keyboardEventTarget_;else{let n=t.getRootNode();e=n instanceof ShadowRoot?n.host:t}if(this.targetChangeHandlerKeys_=[M(e,u.KEYDOWN,this.handleBrowserEvent,this),M(e,u.KEYPRESS,this.handleBrowserEvent,this)],t instanceof HTMLElement){let e=t.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.observe(e.host),this.resizeObserver_?.observe(t)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&=(j(this.viewPropertyListenerKey_),null),this.viewChangeListenerKey_&&=(j(this.viewChangeListenerKey_),null);let e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=M(e,h.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=M(e,u.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&=(this.layerGroupPropertyListenerKeys_.forEach(j),null);let e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Si(`addlayer`,e)),this.layerGroupPropertyListenerKeys_=[M(e,h.PROPERTYCHANGE,this.render,this),M(e,u.CHANGE,this.render,this),M(e,`addlayer`,this.handleLayerAdd_,this),M(e,`removelayer`,this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;let e=this.frameState_.layerStatesArray;for(let t=0,n=e.length;t<n;++t){let n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){ka(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){let t=this.getSize(),n=this.getView(),r=this.frameState_,i=null;if(t!==void 0&&xt(t)&&n&&n.isDef()){let r=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(i={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:oe(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:r,wantedTiles:{},mapId:A(this),renderTargets:{}},a.nextCenter&&a.nextResolution){let e=isNaN(a.nextRotation)?a.rotation:a.nextRotation;i.nextExtent=oe(a.nextCenter,a.nextResolution,e,t)}}this.frameState_=i,this.renderer_.renderFrame(i),i&&(i.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,i.postRenderFunctions),r&&(!this.previousExtent_||!be(this.previousExtent_)&&!qe(i.extent,this.previousExtent_))&&(this.dispatchEvent(new fa(Y.MOVESTART,this,r)),this.previousExtent_=m(this.previousExtent_)),this.previousExtent_&&!i.viewHints[Fn.ANIMATING]&&!i.viewHints[Fn.INTERACTING]&&!qe(i.extent,this.previousExtent_)&&(this.dispatchEvent(new fa(Y.MOVEEND,this,i)),x(i.extent,this.previousExtent_))),this.dispatchEvent(new fa(Y.POSTRENDER,this,i)),this.renderComplete_=(this.hasListener(Y.LOADSTART)||this.hasListener(Y.LOADEND)||this.hasListener($t.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0)}setLayerGroup(e){let t=this.getLayerGroup();t&&this.handleLayerRemove_(new Si(`removelayer`,t)),this.set($.LAYERGROUP,e)}setSize(e){this.set($.SIZE,e)}setTarget(e){this.set($.TARGET,e)}setView(e){if(!e||e instanceof q){this.set($.VIEW,e);return}this.set($.VIEW,new q);let t=this;e.then(function(e){t.setView(new q(e))})}updateSize(){let e=this.getTargetElement(),t;if(e){let n,r;if(me(e))n=e.width,r=e.height;else{let t=getComputedStyle(e);n=e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),r=e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)}!isNaN(n)&&!isNaN(r)&&(t=[Math.max(0,n),Math.max(0,r)],!xt(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Qt(`No map visible because the map container's width or height are 0.`))}let n=this.getSize();t&&(!n||!Ce(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){let t=this.getView();t&&t.setViewportSize(e)}};function Ma(e){let t=null;e.keyboardEventTarget!==void 0&&(t=typeof e.keyboardEventTarget==`string`?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);let n={},r=e.layers&&typeof e.layers.getLayers==`function`?e.layers:new wi({layers:e.layers});n[$.LAYERGROUP]=r,n[$.TARGET]=e.target,n[$.VIEW]=e.view instanceof q?e.view:new q;let i;e.controls!==void 0&&(Array.isArray(e.controls)?i=new J(e.controls.slice()):(K(typeof e.controls.getArray==`function`,"Expected `controls` to be an array or an `ol/Collection.js`"),i=e.controls));let a;e.interactions!==void 0&&(Array.isArray(e.interactions)?a=new J(e.interactions.slice()):(K(typeof e.interactions.getArray==`function`,"Expected `interactions` to be an array or an `ol/Collection.js`"),a=e.interactions));let o;return e.overlays===void 0?o=new J:Array.isArray(e.overlays)?o=new J(e.overlays.slice()):(K(typeof e.overlays.getArray==`function`,"Expected `overlays` to be an array or an `ol/Collection.js`"),o=e.overlays),{controls:i,interactions:a,keyboardEventTarget:t,overlays:o,values:n}}var Na=ja,Pa=class{#e=`https://t{0-7}.tianditu.gov.cn/`;#t=`e1f2618711e8858b50bb0a1d4a715fa9`;#n={vec:[`vec`,`cva`],img:[`img`,`cia`]};createTileLayerGroup(e,t){return new wi({layers:this.#n[e].map(e=>this.createTileLayer(e)),visible:t,properties:{name:e}})}createTileLayer(e){return new pi({source:this.createXYZSource(e)})}createXYZSource(e){return new $r({url:this.#e+e+`_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=`+e+`&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=`+this.#t,tileGrid:Fa(U(`EPSG:3857`))})}};function Fa(t){let n=t.getExtent(),r=e(n),i=N(n),a=Array(18),o=Array(18);for(let e=0;e<18;++e)a[e]=i/(256*2**e),o[e]=e;return new fr({origin:r,resolutions:a,matrixIds:o})}var Ia={class:`graticule-switch`},La=gt({__name:`index`,props:{defaultTdtLyrType:{type:String,default:`vec`}},emits:[`mapCreated`,`mapClick`],setup(e,{emit:t}){let n,r,i,a,o,s=tt(),c=null,l=null,u=tt(null),d=[73.62,16.7,134.77,53.56],f=t,p=e,m=tt(p.defaultTdtLyrType),h=[{label:``,value:`vec`},{label:``,value:`img`}],g=tt(!0),_=new bi({strokeStyle:new tn({color:`rgba(255,120,0,0.9)`,width:2,lineDash:[.5,4]}),showLabels:!0,visible:g.value,lonLabelPosition:.05}),v=tt(null);Ye(async()=>{i=new Pa,y(),b()}),vt(()=>{Me(c),Me(l),c=null,l=null,n=null});function y(){a=i.createTileLayerGroup(`vec`,p.defaultTdtLyrType===`vec`),o=i.createTileLayerGroup(`img`,p.defaultTdtLyrType===`img`),r=new Ei({attributions:`<span> & NavInfoGS20251508</span>`});let e=ki({attribution:!1,rotate:!1,zoom:!1}).extend([r,new Li,new Ni({target:v.value,coordinateFormat:e=>(u.value||=e,Rt(6)(e))})]),t=new q({center:[(d[0]+d[2])/2,(d[1]+d[3])/2],zoom:3,maxZoom:28,projection:`EPSG:4326`}),c=new En({source:new rn({wrapX:!1}),style:new hn({fill:new Sn({color:`rgba(0, 255, 255, 0.1)`}),stroke:new tn({color:`rgb(0, 255, 255)`,width:2})}),properties:{name:`highlight`},zIndex:100});n=new Na({target:s.value,layers:[a,o,c,_],view:t,controls:e,interactions:Ca({doubleClickZoom:!1})}),f(`mapCreated`,n)}function b(){x(),l=n.on(`change:size`,x),c=n.on(`singleclick`,S)}function x(){let e=n.getSize()[0]<600;r.setCollapsible(e),r.setCollapsed(e)}function S(e){f(`mapClick`,e)}function C(e){e===`vec`?(a.setVisible(!0),o.setVisible(!1)):(a.setVisible(!1),o.setVisible(!0))}function w(e){e?_.setVisible(!0):_.setVisible(!1)}return(e,t)=>{let n=$n,r=qn;return I(),L(`div`,{class:`map`,ref_key:`mapDivRef`,ref:s},[st(n,{class:`map-switch`,modelValue:R(m),"onUpdate:modelValue":t[0]||=e=>et(m)?m.value=e:null,options:h,onChange:C},null,8,[`modelValue`]),P(`div`,Ia,[t[2]||=P(`div`,null,``,-1),st(r,{size:`small`,width:`40px`,modelValue:R(g),"onUpdate:modelValue":t[1]||=e=>et(g)?g.value=e:null,"inline-prompt":``,"active-text":``,"inactive-text":``,onChange:w},null,8,[`modelValue`])]),Xe(P(`div`,{class:`realtime-coordinates`,ref_key:`realtimeCoordinatesRef`,ref:v},`  `,512),[[pt,R(u)]])],512)}}},[[`__scopeId`,`data-v-5662c511`]]);export{La as t};