import{Ut as e,Vt as t,Wt as n,q as r,un as i,wn as a}from"./css-BS0Ea-4C.js";import{A as o,C as s,H as c,S as l,V as u,W as d,X as f,Y as p,_ as m,et as h,ft as g,g as _,k as v,m as y,n as b,nt as x,o as S,q as C,r as w,st as T,t as E,ut as D,y as O}from"./index-D36mqg_C.js";import{a as k,f as A,n as j}from"./common-Ki1Nmktx.js";import"./Vector-uJx6Snu6.js";import{t as M}from"./ProjectionZones-8aeoWEiZ.js";import{t as N}from"./AdministrativeDivisions-vfH8SqkZ.js";import"./vnode-1-Nf5dw2.js";import{t as P}from"./OlPopup-Cw_JaqL8.js";import"./fold-B6UZYIk5.js";import{t as F}from"./TdtMap-Dxafwv0Y.js";import"./LineString-CwIzljCo.js";import"./MapEventType-V8bC502L.js";import"./ZonesRender-C2WzHwjc.js";function I(e,t){let r,i=p(!1),a=C({...e,originalPosition:``,originalOverflow:``,visible:!1});function o(e){a.text=e}function s(){let e=a.parent,t=v.ns;if(!e.vLoadingAddClassList){let r=e.getAttribute(`loading-number`);r=Number.parseInt(r)-1,r?e.setAttribute(`loading-number`,r.toString()):(n(e,t.bm(`parent`,`relative`)),e.removeAttribute(`loading-number`)),n(e,t.bm(`parent`,`hidden`))}l(),g.unmount()}function l(){var e;(e=v.$el?.parentNode)==null||e.removeChild(v.$el)}function d(){var t;e.beforeClose&&!e.beforeClose()||(i.value=!0,clearTimeout(r),r=setTimeout(f,400),a.visible=!1,(t=e.closed)==null||t.call(e))}function f(){if(!i.value)return;let e=a.parent;i.value=!1,e.vLoadingAddClassList=void 0,s()}let g=w(m({name:`ElLoading`,setup(e,{expose:t}){let{ns:n,zIndex:r}=A(`loading`);return t({ns:n,zIndex:r}),()=>{let e=a.spinner||a.svg,t=O(`svg`,{class:`circular`,viewBox:a.svgViewBox?a.svgViewBox:`0 0 50 50`,...e?{innerHTML:e}:{}},[O(`circle`,{class:`path`,cx:`25`,cy:`25`,r:`20`,fill:`none`})]),r=a.text?O(`p`,{class:n.b(`text`)},[a.text]):void 0;return O(b,{name:n.b(`fade`),onAfterLeave:f},{default:u(()=>[c(_(`div`,{style:{backgroundColor:a.background||``},class:[n.b(`mask`),a.customClass,n.is(`fullscreen`,a.fullscreen)]},[O(`div`,{class:n.b(`spinner`)},[t,r])]),[[S,a.visible]])])})}}}));Object.assign(g._context,t??{});let v=g.mount(document.createElement(`div`));return{...h(a),setText:o,removeElLoadingChild:l,close:d,handleAfterLeave:f,vm:v,get $el(){return v.$el}}}var L=void 0,R=function(e={},t){if(!i)return;let n=z(e);if(n.fullscreen&&L)return L;let r=I({...n,closed:()=>{var e;(e=n.closed)==null||e.call(n),n.fullscreen&&(L=void 0)}},t??R._context);B(n,n.parent,r),V(n,n.parent,r),n.parent.vLoadingAddClassList=()=>V(n,n.parent,r);let a=n.parent.getAttribute(`loading-number`);return a=a?`${Number.parseInt(a)+1}`:`1`,n.parent.setAttribute(`loading-number`,a),n.parent.appendChild(r.$el),s(()=>r.visible.value=n.visible),n.fullscreen&&(L=r),r},z=e=>{let t;return t=g(e.target)?document.querySelector(e.target)??document.body:e.target||document.body,{parent:t===document.body||e.body?document.body:t,background:e.background||``,svg:e.svg||``,svgViewBox:e.svgViewBox||``,spinner:e.spinner||!1,text:e.text||``,fullscreen:t===document.body&&(e.fullscreen??!0),lock:e.lock??!1,customClass:e.customClass||``,visible:e.visible??!0,beforeClose:e.beforeClose,closed:e.closed,target:t}},B=async(t,n,r)=>{let{nextZIndex:i}=r.vm.zIndex||r.vm._.exposed.zIndex,a={};if(t.fullscreen)r.originalPosition.value=e(document.body,`position`),r.originalOverflow.value=e(document.body,`overflow`),a.zIndex=i();else if(t.parent===document.body){r.originalPosition.value=e(document.body,`position`),await s();for(let n of[`top`,`left`]){let r=n===`top`?`scrollTop`:`scrollLeft`;a[n]=`${t.target.getBoundingClientRect()[n]+document.body[r]+document.documentElement[r]-Number.parseInt(e(document.body,`margin-${n}`),10)}px`}for(let e of[`height`,`width`])a[e]=`${t.target.getBoundingClientRect()[e]}px`}else r.originalPosition.value=e(n,`position`);for(let[e,t]of Object.entries(a))r.$el.style[e]=t},V=(e,r,i)=>{let a=i.vm.ns||i.vm._.exposed.ns;[`absolute`,`fixed`,`sticky`].includes(i.originalPosition.value)?n(r,a.bm(`parent`,`relative`)):t(r,a.bm(`parent`,`relative`)),e.fullscreen&&e.lock?t(r,a.bm(`parent`,`hidden`)):n(r,a.bm(`parent`,`hidden`))};R._context=null;var H=Symbol(`ElLoading`),U=e=>`element-loading-${T(e)}`,W=(e,t)=>{let n=t.instance,r=e=>D(t.value)?t.value[e]:void 0,i=e=>p(g(e)&&n?.[e]||e),a=t=>i(r(t)||e.getAttribute(U(t))),o=r(`fullscreen`)??t.modifiers.fullscreen,s={text:a(`text`),svg:a(`svg`),svgViewBox:a(`svgViewBox`),spinner:a(`spinner`),background:a(`background`),customClass:a(`customClass`),fullscreen:o,target:r(`target`)??(o?void 0:e),body:r(`body`)??t.modifiers.body,lock:r(`lock`)??t.modifiers.lock},c=R(s);c._context=K._context,e[H]={options:s,instance:c}},G=(e,t)=>{for(let n of Object.keys(e))d(e[n])&&(e[n].value=t[n])},K={mounted(e,t){t.value&&W(e,t)},updated(e,t){let n=e[H];if(!t.value){n?.instance.close(),e[H]=null;return}n?G(n.options,D(t.value)?t.value:{text:e.getAttribute(U(`text`)),svg:e.getAttribute(U(`svg`)),svgViewBox:e.getAttribute(U(`svgViewBox`)),spinner:e.getAttribute(U(`spinner`)),background:e.getAttribute(U(`background`)),customClass:e.getAttribute(U(`customClass`))}):W(e,t)},unmounted(e){var t;(t=e[H])==null||t.instance.close(),e[H]=null}};K._context=null;var q={class:`wrap`,"element-loading-text":`拼命加载中...`,"element-loading-background":`rgba(122, 122, 122, 0.8)`},J=E({__name:`OneMap`,setup(e){let t=p(``),n=p([]),i=p([0,-10]),a=p([{key:`label`,val:`投影名称`,unit:null},{key:`code`,val:`EPSG`,unit:null},{key:`bounds`,val:`投影范围`,unit:null}]),s=p({}),u=p(null),d=null,m=p(!1),h=f({map:null});o(`state`,h),o(`isMapCreated`,m);let g=p(!0);function b(e){h.map=e,m.value=!0,d=k(e,`highlight`).getSource()}function S(e){let t=e.coordinate,n=h.map.forEachFeatureAtPixel(e.pixel,e=>e);if(n){if(t){j(d);let e=n.clone();e.setStyle(void 0),d.addFeature(e)}w(n.getProperties(),t)}}function C(e){w(e)}function w(e,i){Object.keys(e).includes(`bounds`)&&(s.value=e,t.value=e.label,n.value=i||r(e.bounds))}function T(){j(d)}function E(){u.value?.close()}function D(){g.value=!1}return(e,r)=>{let o=F,d=M,f=N,p=P,m=K;return c((v(),y(`div`,q,[_(o,{onMapCreated:b,onMapClick:S}),_(d,l(e.$attrs,{onPopup:C,onClosePopup:E}),null,16),_(f,{onDataLoaded:D}),_(p,{ref_key:`popup`,ref:u,title:x(t),position:x(n),offset:x(i),propeties:x(a),popupInfo:x(s),onClose:T},null,8,[`title`,`position`,`offset`,`propeties`,`popupInfo`])])),[[m,x(g),void 0,{lock:!0}]])}}},[[`__scopeId`,`data-v-40ff7e2d`]]);export{J as default};